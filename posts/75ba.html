<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>ByteByteGo 简报翻译【1】：Netflix 如何管理 2.38 亿会员？ · Cytrogen 的个人博客</title><meta name="description" content="本文是 ByteByteGo 简报的中文翻译，深入探讨了 Netflix 是如何设计其系统架构来管理全球 2.38 亿会员的。文章详细解析了 Netflix 会员平台的演进过程，从早期的轻量级库到如今由十几个微服务构成的高可用分布式系统。内容涵盖其技术选型（如 CockroachDB、Cassandra、Kafka），并重点介绍了用户注册流程和基于变更数据捕获（CDC）的会员历史追踪机制。通过本文，可以一窥世界顶尖流媒体服务背后，支撑其核心订阅业务的系统设计与实践。"><link rel="icon" href="../favicon.png"><link rel="stylesheet" href="../css/hermes.css"><link rel="search" type="application/opensearchdescription+xml" href="https://cytrogen.icu/atom.xml" title="Cytrogen 的个人博客"><script src="https://kit.fontawesome.com/0011a09a95.js" crossorigin="anonymous"></script><script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="atom.xml" title="Cytrogen 的个人博客" type="application/atom+xml">
</head><body><div class="wrap"><header><a class="logo-link" href="../index.html"><img src="../favicon.png" alt="logo"></a><nav class="site-nav"><div class="nav-main"><div class="nav-primary"><ul class="nav-list hidden-mobile"><li class="nav-item"><a class="nav-link" href="../index.html">首页</a></li></ul><div class="nav-tools"><div class="language-menu"><button class="language-toggle" type="button"><i class="fas fa-globe"></i><span>中文</span></button><div class="language-dropdown hidden"></div></div><button id="search-btn" type="button" aria-label="nav.search"><i class="fas fa-search"></i></button></div><div class="nav-controls"><div class="more-menu hidden-mobile"><button class="more-toggle" type="button"><span>更多</span><i class="fas fa-chevron-down"></i></button><div class="more-dropdown hidden"><ul class="dropdown-list"><li class="dropdown-item"><a class="nav-link" href="../archives">归档</a></li><li class="dropdown-item"><a class="nav-link" href="../categories">分类</a></li><li class="dropdown-item"><a class="nav-link" href="../tags">标签</a></li><li class="dropdown-item"><a class="nav-link" href="../about">关于</a></li><li class="dropdown-item"><a class="nav-link" href="../friends">友链</a></li><li class="dropdown-item"><a class="nav-link" href="../atom.xml">RSS订阅</a></li><li class="dropdown-item"><a class="dropdown-link" href="https://portfolio.cytrogen.icu" target="_blank" rel="noopener noreferrer">作品集<i class="fas fa-external-link-alt"></i></a></li><li class="dropdown-item"><a class="dropdown-link" href="https://github.com/cytrogen" target="_blank" rel="noopener noreferrer">GitHub<i class="fas fa-external-link-alt"></i></a></li></ul></div></div><button class="hamburger-menu hidden-desktop" type="button" aria-label="nav.menu"><i class="fas fa-bars"></i></button></div></div></div><div class="search-overlay hidden" id="search-popup"><button class="search-close" id="search-close" type="button" aria-label="search.close"><i class="fas fa-times"></i></button><div class="search-container"><div class="search-input-wrapper"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..."></div><div class="search-result" id="local-search-result"></div></div></div><div class="mobile-menu-container"><div class="menu-header"><button class="menu-close" type="button" aria-label="关闭"><i class="fas fa-times"></i></button></div><div class="menu-content"><ul class="nav-list"><li class="nav-item"><a class="nav-link" href="../index.html">首页</a></li><li class="nav-item"><a class="nav-link" href="../archives">归档</a></li><li class="nav-item"><a class="nav-link" href="../categories">分类</a></li><li class="nav-item"><a class="nav-link" href="../tags">标签</a></li><li class="nav-item"><a class="nav-link" href="../about">关于</a></li><li class="nav-item"><a class="nav-link" href="../friends">友链</a></li><li class="nav-item"><a class="nav-link" href="../atom.xml">RSS订阅</a></li><li class="nav-item"><a class="nav-link" href="https://portfolio.cytrogen.icu" target="_blank" rel="noopener noreferrer">作品集<i class="fas fa-external-link-alt"></i></a></li><li class="nav-item"><a class="nav-link" href="https://github.com/cytrogen" target="_blank" rel="noopener noreferrer">GitHub<i class="fas fa-external-link-alt"></i></a></li></ul></div></div></nav></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">ByteByteGo 简报翻译【1】：Netflix 如何管理 2.38 亿会员？</h1><div class="post-info">6/28/2024</div><div class="post-content"><p>开了个新坑，近期从 Instagram 的广告上得知了 ByteByteGo，并且订阅了他们的简报（Newsletter）服务，基本上隔个两三天就会收到他们的简报邮件。其中有些简报让我非常感兴趣，故分享。</p>
<p><strong>2024 年 06 月 25 日</strong>：Netflix 如何管理 2.38 亿会员？<em>（How Netflix Manages 238 Million Memberships?）</em></p>
<span id="more"></span>
<div class="danger">
<p>如果侵权，请联系我删除！</p>
</div>
<h1 id="简报内容"><a class="markdownIt-Anchor" href="#简报内容"></a> 简报内容</h1>
<p><em>免责声明：本文章中的细节来自 Netflix 工程团队的文章/演讲。所有架构细节均归功于 Netflix 工程团队。原文链接见文末参考文献部分。我们尝试分析了这些细节，并提供了我们的意见。如果您发现任何不准确或遗漏之处，请留下评论，我们将尽力修正。</em></p>
<p>作为一家基于订阅的流媒体服务公司，Netflix 的主要收入来源是会员业务。目前，Netflix 在全球拥有 2.38 亿名会员，有效管理会员对公司的成功和持续增长至关重要。</p>
<p>Netflix 的会员平台在处理用户订阅的整个生命周期中发挥着至关重要的作用。</p>
<p>会员生命周期由不同阶段和场景组成：</p>
<ul>
<li>注册： 用户可直接或通过 T-Mobile 等合作伙伴渠道注册 Netflix 服务，开始 Netflix 之旅。</li>
<li>计划变更： 现有会员可根据自己的喜好和需求修改订阅计划。</li>
<li>续订： 作为一项订阅服务，Netflix 会自动尝试使用与用户账户相关联的付款方式为用户续订计划。</li>
<li>付款问题： 如果支付网关出现问题或资金不足，用户的账户可能会被暂停或给予宽限期来解决问题。</li>
<li>会员资格暂停或取消： 用户可以选择暂时中止会员资格或永久取消订阅。</li>
</ul>
<p>在下面的章节中，我们将探讨 Netflix 工程团队为支持其会员平台的各种功能和可扩展性而做出的架构决策。</p>
<h2 id="netflix-会员平台的高级架构"><a class="markdownIt-Anchor" href="#netflix-会员平台的高级架构"></a> Netflix 会员平台的高级架构</h2>
<p>在深入了解 Netflix 会员制平台的细节之前，让我们先回顾一下该公司最初的定价架构是如何设计的。</p>
<p>早期，Netflix 的定价模型相对简单，只需管理少量计划和支持基本功能。</p>
<p>为了满足这些最初的要求，Netflix 采用了轻量级的内存库。事实证明，这种方法相当高效，因为定价系统的范围有限，因此设计简单、精简。</p>
<p>下图展示了这一基本架构：</p>
<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewbox="-8 -50 450 94" style="max-width: 450px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-1753397108832"><style>#mermaid-1753397108832{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1753397108832 .error-icon{fill:#552222;}#mermaid-1753397108832 .error-text{fill:#552222;stroke:#552222;}#mermaid-1753397108832 .edge-thickness-normal{stroke-width:2px;}#mermaid-1753397108832 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1753397108832 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1753397108832 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1753397108832 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1753397108832 .marker{fill:#333333;stroke:#333333;}#mermaid-1753397108832 .marker.cross{stroke:#333333;}#mermaid-1753397108832 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1753397108832 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-1753397108832 .cluster-label text{fill:#333;}#mermaid-1753397108832 .cluster-label span,#mermaid-1753397108832 p{color:#333;}#mermaid-1753397108832 .label text,#mermaid-1753397108832 span,#mermaid-1753397108832 p{fill:#333;color:#333;}#mermaid-1753397108832 .node rect,#mermaid-1753397108832 .node circle,#mermaid-1753397108832 .node ellipse,#mermaid-1753397108832 .node polygon,#mermaid-1753397108832 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1753397108832 .flowchart-label text{text-anchor:middle;}#mermaid-1753397108832 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-1753397108832 .node .label{text-align:center;}#mermaid-1753397108832 .node.clickable{cursor:pointer;}#mermaid-1753397108832 .arrowheadPath{fill:#333333;}#mermaid-1753397108832 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1753397108832 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1753397108832 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1753397108832 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1753397108832 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-1753397108832 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1753397108832 .cluster text{fill:#333;}#mermaid-1753397108832 .cluster span,#mermaid-1753397108832 p{color:#333;}#mermaid-1753397108832 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1753397108832 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-1753397108832 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerheight="12" markerwidth="12" markerunits="userSpaceOnUse" refy="5" refx="6" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397108832_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/></marker><marker orient="auto" markerheight="12" markerwidth="12" markerunits="userSpaceOnUse" refy="5" refx="4.5" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397108832_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5" refx="11" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397108832_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5" refx="-1" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397108832_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5.2" refx="12" viewbox="0 0 11 11" class="marker cross flowchart" id="mermaid-1753397108832_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5.2" refx="-1" viewbox="0 0 11 11" class="marker cross flowchart" id="mermaid-1753397108832_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><g class="root"><g class="clusters"/><g class="edgePaths"><path marker-end="url(#mermaid-1753397108832_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" id="L-A-B-0" d="M95.5,18L99.667,18C103.833,18,112.167,18,119.617,18C127.067,18,133.633,18,136.917,18L140.2,18"/><path marker-end="url(#mermaid-1753397108832_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" id="L-B-C-0" d="M224.5,18L228.667,18C232.833,18,241.167,18,248.617,18C256.067,18,262.633,18,265.917,18L269.2,18"/></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(47.75, 18)" data-id="A" data-node="true" id="flowchart-A-0" class="node default default flowchart-label"><rect height="36" width="95.5" y="-18" x="-47.75" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-40.25, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="80.5"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Netflix服务</span></div></foreignObject></g></g><g transform="translate(185, 18)" data-id="B" data-node="true" id="flowchart-B-1" class="node default default flowchart-label"><rect height="36" width="79" y="-18" x="-39.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-32, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="64"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">会员服务</span></div></foreignObject></g></g><g transform="translate(354.25, 18)" data-id="C" data-node="true" id="flowchart-C-3" class="node default default flowchart-label"><rect height="36" width="159.5" y="-18" x="-79.75" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-72.25, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="144.5"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Netflix计划和定价库</span></div></foreignObject></g></g></g></g></g><text class="flowchartTitleText" y="-25" x="217">Netflix定价服务初步设计</text></svg>
<p>随着 Netflix 全球业务的扩展和产品的多样化，最初为定价架构提供服务的轻量级内存库变得不敷使用。</p>
<p>定价目录的复杂性和范围不断扩大，其在多个应用程序中的重要性也与日俱增，这给运营带来了挑战。该库的规模和依赖性使其难以维护和扩展，因此有必要过渡到更强大和可扩展的架构。</p>
<p>下图显示了 Netflix 现代会员制平台的高层架构：</p>
<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewbox="-8 -50 948.2265625 701.0204467773438" style="max-width: 948.2265625px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-1753397110249"><style>#mermaid-1753397110249{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1753397110249 .error-icon{fill:#552222;}#mermaid-1753397110249 .error-text{fill:#552222;stroke:#552222;}#mermaid-1753397110249 .edge-thickness-normal{stroke-width:2px;}#mermaid-1753397110249 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1753397110249 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1753397110249 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1753397110249 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1753397110249 .marker{fill:#333333;stroke:#333333;}#mermaid-1753397110249 .marker.cross{stroke:#333333;}#mermaid-1753397110249 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1753397110249 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-1753397110249 .cluster-label text{fill:#333;}#mermaid-1753397110249 .cluster-label span,#mermaid-1753397110249 p{color:#333;}#mermaid-1753397110249 .label text,#mermaid-1753397110249 span,#mermaid-1753397110249 p{fill:#333;color:#333;}#mermaid-1753397110249 .node rect,#mermaid-1753397110249 .node circle,#mermaid-1753397110249 .node ellipse,#mermaid-1753397110249 .node polygon,#mermaid-1753397110249 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1753397110249 .flowchart-label text{text-anchor:middle;}#mermaid-1753397110249 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-1753397110249 .node .label{text-align:center;}#mermaid-1753397110249 .node.clickable{cursor:pointer;}#mermaid-1753397110249 .arrowheadPath{fill:#333333;}#mermaid-1753397110249 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1753397110249 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1753397110249 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1753397110249 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1753397110249 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-1753397110249 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1753397110249 .cluster text{fill:#333;}#mermaid-1753397110249 .cluster span,#mermaid-1753397110249 p{color:#333;}#mermaid-1753397110249 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1753397110249 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-1753397110249 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerheight="12" markerwidth="12" markerunits="userSpaceOnUse" refy="5" refx="6" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397110249_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/></marker><marker orient="auto" markerheight="12" markerwidth="12" markerunits="userSpaceOnUse" refy="5" refx="4.5" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397110249_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5" refx="11" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397110249_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5" refx="-1" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397110249_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5.2" refx="12" viewbox="0 0 11 11" class="marker cross flowchart" id="mermaid-1753397110249_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5.2" refx="-1" viewbox="0 0 11 11" class="marker cross flowchart" id="mermaid-1753397110249_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><g class="root"><g class="clusters"/><g class="edgePaths"><path marker-end="url(#mermaid-1753397110249_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" id="L-A-B-0" d="M63.5,36L63.5,40.167C63.5,44.333,63.5,52.667,71.281,60.614C79.062,68.561,94.624,76.123,102.405,79.903L110.186,83.684"/><path marker-end="url(#mermaid-1753397110249_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" id="L-B-C-0" d="M152,122L152,126.167C152,130.333,152,138.667,153.215,153.268C154.43,167.869,156.861,188.739,158.076,199.173L159.291,209.608"/><path marker-end="url(#mermaid-1753397110249_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-C LE-D" id="L-C-D-0" d="M162,250.873L162,262.185C162,273.497,162,296.121,162,312.989C162,329.858,162,340.97,162,346.526L162,352.083"/><path style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-E" id="L-D-E-0" d="M162,452.383L162,458.822C162,465.262,162,478.141,184.885,494.96C207.77,511.778,253.54,532.536,276.425,542.914L299.31,553.293"/><path marker-end="url(#mermaid-1753397110249_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-F LE-E" id="L-F-E-0" d="M347.141,422.883L347.141,434.239C347.141,445.595,347.141,468.308,347.52,483.02C347.899,497.732,348.657,504.444,349.037,507.8L349.416,511.156"/><path marker-end="url(#mermaid-1753397110249_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-G LE-E" id="L-G-E-0" d="M522.191,422.883L510.778,434.239C499.364,445.595,476.538,468.308,457.483,486.667C438.428,505.026,423.146,519.032,415.504,526.034L407.863,533.037"/><path marker-end="url(#mermaid-1753397110249_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-G LE-H" id="L-G-H-0" d="M542.371,422.883L543.689,434.239C545.008,445.595,547.644,468.308,548.963,490.698C550.281,513.087,550.281,535.154,550.281,546.187L550.281,557.22"/><path marker-end="url(#mermaid-1753397110249_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-I LE-B" id="L-I-B-0" d="M240.5,36L240.5,40.167C240.5,44.333,240.5,52.667,232.719,60.614C224.938,68.561,209.376,76.123,201.595,79.903L193.814,83.684"/><path marker-end="url(#mermaid-1753397110249_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-J LE-B" id="L-J-B-0" d="M425.5,36L425.5,40.167C425.5,44.333,425.5,52.667,392.706,61.989C359.912,71.312,294.324,81.624,261.53,86.78L228.736,91.936"/><path marker-end="url(#mermaid-1753397110249_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-K LE-C" id="L-K-C-0" d="M555.281,112.781L519.234,118.484C483.188,124.187,411.094,135.594,352.525,152.223C293.957,168.853,248.913,190.706,226.392,201.633L203.87,212.559"/><path marker-end="url(#mermaid-1753397110249_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-K LE-L" id="L-K-L-0" d="M648.665,122L657.434,126.167C666.204,130.333,683.742,138.667,692.512,153.262C701.281,167.858,701.281,188.715,701.281,199.144L701.281,209.573"/><path marker-end="url(#mermaid-1753397110249_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-L LE-M" id="L-L-M-0" d="M701.281,250.873L701.281,262.185C701.281,273.497,701.281,296.121,701.281,310.716C701.281,325.312,701.281,331.878,701.281,335.162L701.281,338.445"/><path marker-end="url(#mermaid-1753397110249_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-N LE-C" id="L-N-C-0" d="M821.227,109.362L756.296,115.635C691.365,121.908,561.503,134.454,459.057,152.674C356.61,170.895,281.58,194.79,244.065,206.737L206.55,218.685"/><path marker-end="url(#mermaid-1753397110249_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-N LE-O" id="L-N-O-0" d="M876.727,122L876.727,126.167C876.727,130.333,876.727,138.667,876.727,146.117C876.727,153.567,876.727,160.133,876.727,163.417L876.727,166.7"/></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(63.5, 18)" data-id="A" data-node="true" id="flowchart-A-0" class="node default default flowchart-label"><rect height="36" width="127" y="-18" x="-63.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-56, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="112"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">会员宽限期服务</span></div></foreignObject></g></g><g transform="translate(152, 104)" data-id="B" data-node="true" id="flowchart-B-1" class="node default default flowchart-label"><rect height="36" width="143" y="-18" x="-71.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-64, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="128"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">会员状态管理服务</span></div></foreignObject></g></g><g transform="translate(162, 232.87252044677734)" data-id="C" data-node="true" id="flowchart-C-3" class="node default default flowchart-label"><rect height="36" width="79" y="-18" x="-39.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-32, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="64"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">订阅服务</span></div></foreignObject></g></g><g transform="translate(162, 404.88275146484375)" data-id="D" data-node="true" id="flowchart-D-5" class="node default default flowchart-label"><circle height="87" width="95" r="47.5" ry="0" rx="0" style=""/><g transform="translate(-40, -36)" style="" class="label"><rect/><foreignObject style="width: 80px; height: 72px;" height="72" width="80"><div style="display: table-cell; white-space: nowrap; max-width: 200px;" xmlns="http://www.w3.org/1999/xhtml">
    <span class="nodeLabel markdown-node-label"><p>Cassandra<br/>订阅数据库</p></span></div></foreignObject></g></g><g transform="translate(357.140625, 579.5204620361328)" data-id="E" data-node="true" id="flowchart-E-7" class="node default default flowchart-label"><circle height="87" width="127" r="63.5" ry="0" rx="0" style=""/><g transform="translate(-56, -36)" style="" class="label"><rect/><foreignObject style="width: 112px; height: 72px;" height="72" width="112"><div style="display: table-cell; white-space: nowrap; max-width: 200px;" xmlns="http://www.w3.org/1999/xhtml">
    <span class="nodeLabel markdown-node-label"><p>Cassandra<br/>订阅历史数据库</p></span></div></foreignObject></g></g><g transform="translate(347.140625, 404.88275146484375)" data-id="F" data-node="true" id="flowchart-F-8" class="node default default flowchart-label"><rect height="36" width="175.28125" y="-18" x="-87.640625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-80.140625, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="160.28125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Apache Spark对账工作</span></div></foreignObject></g></g><g transform="translate(540.28125, 404.88275146484375)" data-id="G" data-node="true" id="flowchart-G-10" class="node default default flowchart-label"><rect height="36" width="111" y="-18" x="-55.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-48, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="96"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">订阅历史服务</span></div></foreignObject></g></g><g transform="translate(550.28125, 579.5204620361328)" data-id="H" data-node="true" id="flowchart-H-13" class="node default default flowchart-label"><rect height="34" width="53.875" y="-17" x="-26.9375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-19.4375, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="38.875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">kafka</span></div></foreignObject></g></g><g transform="translate(240.5, 18)" data-id="I" data-node="true" id="flowchart-I-14" class="node default default flowchart-label"><rect height="36" width="127" y="-18" x="-63.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-56, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="112"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">会员捆绑包服务</span></div></foreignObject></g></g><g transform="translate(425.5, 18)" data-id="J" data-node="true" id="flowchart-J-16" class="node default default flowchart-label"><rect height="36" width="143" y="-18" x="-71.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-64, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="128"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">会员应用商店服务</span></div></foreignObject></g></g><g transform="translate(610.78125, 104)" data-id="K" data-node="true" id="flowchart-K-18" class="node default default flowchart-label"><rect height="36" width="111" y="-18" x="-55.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-48, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="96"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">会员定价服务</span></div></foreignObject></g></g><g transform="translate(701.28125, 232.87252044677734)" data-id="L" data-node="true" id="flowchart-L-21" class="node default default flowchart-label"><rect height="36" width="143" y="-18" x="-71.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-64, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="128"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">计划定价目录服务</span></div></foreignObject></g></g><g transform="translate(701.28125, 404.88275146484375)" data-id="M" data-node="true" id="flowchart-M-23" class="node default default flowchart-label"><path transform="translate(-55.5,-61.137711864406775)" d="M 0,11.758474576271185 a 55.5,11.758474576271185 0,0,0 111 0 a 55.5,11.758474576271185 0,0,0 -111 0 l 0,98.75847457627118 a 55.5,11.758474576271185 0,0,0 111 0 l 0,-98.75847457627118" style=""/><g transform="translate(-48, -36)" style="" class="label"><rect/><foreignObject style="width: 96px; height: 72px;" height="72" width="96"><div style="display: table-cell; white-space: nowrap; max-width: 200px;" xmlns="http://www.w3.org/1999/xhtml">
    <span class="nodeLabel markdown-node-label"><p>CockroachDB<br/>计划和定价表</p></span></div></foreignObject></g></g><g transform="translate(876.7265625, 104)" data-id="N" data-node="true" id="flowchart-N-24" class="node default default flowchart-label"><rect height="36" width="111" y="-18" x="-55.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-48, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="96"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">代码兑换服务</span></div></foreignObject></g></g><g transform="translate(876.7265625, 232.87252044677734)" data-id="O" data-node="true" id="flowchart-O-27" class="node default default flowchart-label"><path transform="translate(-53.9453125,-60.87252599798725)" d="M 0,11.581683998658168 a 53.9453125,11.581683998658168 0,0,0 107.890625 0 a 53.9453125,11.581683998658168 0,0,0 -107.890625 0 l 0,98.58168399865816 a 53.9453125,11.581683998658168 0,0,0 107.890625 0 l 0,-98.58168399865816" style=""/><g transform="translate(-46.4453125, -36)" style="" class="label"><rect/><foreignObject style="width: 92.8906px; height: 72px;" height="72" width="92.890625"><div style="display: table-cell; white-space: nowrap; max-width: 200px;" xmlns="http://www.w3.org/1999/xhtml">
    <span class="nodeLabel markdown-node-label"><p>CockroachDB<br/>代码兑换表</p></span></div></foreignObject></g></g></g></g></g><text class="flowchartTitleText" y="-25" x="466.11328125">Netflix会员制服务的架构</text></svg>
<p>会员平台由十几个微服务组成，旨在支持四个九（99.99%）的可用性。</p>
<p>这种高可用性要求源于该平台在各种面向用户的流程中发挥的关键作用。如果任何服务出现宕机，都会直接影响用户体验。</p>
<p>该平台支持多个关键功能：</p>
<ul>
<li>当用户点击 Netflix 上的播放按钮时，会直接呼叫会员系统，以确定与其计划相关的服务质量。用户允许的并发流和支持的设备等因素都在考虑之列。由于 Netflix 每天都要处理数十亿个流媒体请求，因此该流程处理的流量最大。</li>
<li>当用户访问其账户页面时会触发会员流。更改计划、管理额外会员和取消会员资格等操作会直接与会员服务交互。</li>
<li>该平台是任何特定时间点会员总数的权威来源。它发出事件并写入持久存储，Netflix 内部和外部的下游分析系统都会使用该存储。</li>
</ul>
<p>架构图的要点如下：</p>
<ul>
<li>会员平台在全球范围内管理会员计划和定价目录，不同地区的计划和定价目录各不相同。计划定价目录服务处理基于特定地点产品的规则管理。</li>
<li>两个 CockroachDB 数据库用于存储计划定价和代码兑换信息。会员定价服务支持会员操作，如更改计划或添加额外会员。</li>
<li>专门的微服务负责处理与合作伙伴的互动，包括捆绑激活、注册以及与苹果应用商店等平台的集成。</li>
<li>会员数据存储在 Cassandra 数据库中，该数据库支持订阅服务和历史跟踪服务。</li>
<li>该平台不仅满足 2.38 亿活跃会员的需求，还关注前会员和重新加入会员的体验。</li>
<li>该平台生成的数据将提供给下游消费者，以便他们了解注册情况和收入预测。</li>
</ul>
<p>Netflix 选择使用 CockroachDB 和 Cassandra 很有意思。</p>
<p>CockroachDB 具有很强的一致性，适合处理计划定价信息等关键数据，而 Cassandra 则是一种高度可扩展的 NoSQL 数据库，适合处理大量会员数据。</p>
<p>此外，99.99% 的可用性也表明 Cassandra 非常注重弹性和容错性。无论如何，Netflix 以其全面的混乱工程实践而闻名，它可以主动测试系统的弹性。</p>
<h2 id="注册流程"><a class="markdownIt-Anchor" href="#注册流程"></a> 注册流程</h2>
<p>一旦用户开始 Netflix 之旅，他们就会遇到选择计划的选项。</p>
<p>由于货币、定价和可用计划存在地域差异，因此准确呈现计划选择页面至关重要。Netflix 的会员制平台可确保根据用户的位置和设备类型向其展示适当的选项。</p>
<p>下图显示了 Netflix 注册流程的详细步骤以及在流程中触发的服务：</p>
<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewbox="-8 -8 810.734375 766.18994140625" style="max-width: 810.734375px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-1753397111621"><style>#mermaid-1753397111621{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1753397111621 .error-icon{fill:#552222;}#mermaid-1753397111621 .error-text{fill:#552222;stroke:#552222;}#mermaid-1753397111621 .edge-thickness-normal{stroke-width:2px;}#mermaid-1753397111621 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1753397111621 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1753397111621 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1753397111621 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1753397111621 .marker{fill:#333333;stroke:#333333;}#mermaid-1753397111621 .marker.cross{stroke:#333333;}#mermaid-1753397111621 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1753397111621 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-1753397111621 .cluster-label text{fill:#333;}#mermaid-1753397111621 .cluster-label span,#mermaid-1753397111621 p{color:#333;}#mermaid-1753397111621 .label text,#mermaid-1753397111621 span,#mermaid-1753397111621 p{fill:#333;color:#333;}#mermaid-1753397111621 .node rect,#mermaid-1753397111621 .node circle,#mermaid-1753397111621 .node ellipse,#mermaid-1753397111621 .node polygon,#mermaid-1753397111621 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1753397111621 .flowchart-label text{text-anchor:middle;}#mermaid-1753397111621 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-1753397111621 .node .label{text-align:center;}#mermaid-1753397111621 .node.clickable{cursor:pointer;}#mermaid-1753397111621 .arrowheadPath{fill:#333333;}#mermaid-1753397111621 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1753397111621 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1753397111621 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1753397111621 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1753397111621 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-1753397111621 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1753397111621 .cluster text{fill:#333;}#mermaid-1753397111621 .cluster span,#mermaid-1753397111621 p{color:#333;}#mermaid-1753397111621 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1753397111621 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-1753397111621 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerheight="12" markerwidth="12" markerunits="userSpaceOnUse" refy="5" refx="6" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397111621_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/></marker><marker orient="auto" markerheight="12" markerwidth="12" markerunits="userSpaceOnUse" refy="5" refx="4.5" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397111621_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5" refx="11" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397111621_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5" refx="-1" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397111621_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5.2" refx="12" viewbox="0 0 11 11" class="marker cross flowchart" id="mermaid-1753397111621_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5.2" refx="-1" viewbox="0 0 11 11" class="marker cross flowchart" id="mermaid-1753397111621_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><g class="root"><g class="clusters"/><g class="edgePaths"><path marker-end="url(#mermaid-1753397111621_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" id="L-A-B-0" d="M368.724,36L345.323,41.917C321.923,47.833,275.121,59.667,251.721,70.617C228.32,81.567,228.32,91.633,228.32,96.667L228.32,101.7"/><path marker-end="url(#mermaid-1753397111621_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" id="L-B-C-0" d="M200.471,143L191.317,148.917C182.163,154.833,163.855,166.667,154.701,178.587C145.547,190.507,145.547,202.513,145.547,208.516L145.547,214.52"/><path marker-end="url(#mermaid-1753397111621_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-D" id="L-B-D-0" d="M273.667,143L288.573,148.917C303.479,154.833,333.29,166.667,348.196,177.617C363.102,188.567,363.102,198.633,363.102,203.667L363.102,208.7"/><path marker-end="url(#mermaid-1753397111621_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-E" id="L-A-E-0" d="M415.842,36L407.93,41.917C400.017,47.833,384.192,59.667,383.485,70.971C382.777,82.275,397.188,93.051,404.393,98.438L411.598,103.826"/><path marker-end="url(#mermaid-1753397111621_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-A" id="L-E-A-0" d="M463.986,107L471.898,101.083C479.811,95.167,495.636,83.333,496.343,72.029C497.051,60.725,482.641,49.949,475.436,44.562L468.23,39.174"/><path marker-end="url(#mermaid-1753397111621_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-F" id="L-A-F-0" d="M505.461,36L527.007,41.917C548.552,47.833,591.643,59.667,613.189,70.617C634.734,81.567,634.734,91.633,634.734,96.667L634.734,101.7"/><path marker-end="url(#mermaid-1753397111621_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-F LE-G" id="L-F-G-0" d="M634.734,143L634.734,148.917C634.734,154.833,634.734,166.667,634.734,179.503C634.734,192.34,634.734,206.18,634.734,213.1L634.734,220.02"/><path marker-end="url(#mermaid-1753397111621_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-G LE-H" id="L-G-H-0" d="M610.158,261.32L599.504,269.123C588.85,276.926,567.542,292.533,556.888,305.369C546.234,318.206,546.234,328.272,546.234,333.306L546.234,338.339"/><path marker-end="url(#mermaid-1753397111621_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-H LE-I" id="L-H-I-0" d="M546.234,414.915L546.234,420.831C546.234,426.748,546.234,438.581,546.234,449.531C546.234,460.481,546.234,470.548,546.234,475.581L546.234,480.615"/><path marker-end="url(#mermaid-1753397111621_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-G LE-M" id="L-G-M-0" d="M659.31,261.32L669.964,269.123C680.618,276.926,701.926,292.533,712.58,308.309C723.234,324.085,723.234,340.031,723.234,348.004L723.234,355.977"/><path marker-end="url(#mermaid-1753397111621_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-M LE-N" id="L-M-N-0" d="M723.234,397.277L723.234,406.133C723.234,414.989,723.234,432.702,723.234,449.531C723.234,466.36,723.234,482.306,723.234,490.279L723.234,498.252"/><path marker-end="url(#mermaid-1753397111621_flowchart-pointEnd)" style="fill:none;stroke-width:2px;stroke-dasharray:3;" class="edge-thickness-normal edge-pattern-dotted flowchart-link LS-I LE-J" id="L-I-J-0" d="M546.234,557.19L546.234,563.107C546.234,569.023,546.234,580.857,546.234,591.807C546.234,602.757,546.234,612.823,546.234,617.857L546.234,622.89"/><path marker-end="url(#mermaid-1753397111621_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-J LE-K" id="L-J-K-0" d="M522.734,658.743L513.234,663.817C503.734,668.892,484.734,679.041,475.3,687.482C465.866,695.924,465.998,702.657,466.064,706.024L466.13,709.391"/><path marker-end="url(#mermaid-1753397111621_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-J LE-L" id="L-J-L-0" d="M569.734,658.743L579.234,663.817C588.734,668.892,607.734,679.041,617.3,687.482C626.866,695.924,626.998,702.657,627.064,706.024L627.13,709.391"/></g><g class="edgeLabels"><g transform="translate(228.3203125, 71.5)" class="edgeLabel"><g transform="translate(-57.546875, -10.5)" class="label"><foreignObject height="21" width="115.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">1. 检索计划详情</span></div></foreignObject></g></g><g transform="translate(145.546875, 178.5)" class="edgeLabel"><g transform="translate(-145.546875, -10.5)" class="label"><foreignObject height="21" width="291.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">2. 基于区域、设备类型的加载和读取计划</span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g transform="translate(368.3671875, 71.5)" class="edgeLabel"><g transform="translate(-41.546875, -10.5)" class="label"><foreignObject height="21" width="83.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">3. 展示选项</span></div></foreignObject></g></g><g transform="translate(511.4609375, 71.5)" class="edgeLabel"><g transform="translate(-81.546875, -10.5)" class="label"><foreignObject height="21" width="163.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">4. 会员选择了一个计划</span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g transform="translate(634.734375, 178.5)" class="edgeLabel"><g transform="translate(-57.546875, -10.5)" class="label"><foreignObject height="21" width="115.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">5. 会员服务启动</span></div></foreignObject></g></g><g transform="translate(546.234375, 308.1390838623047)" class="edgeLabel"><g transform="translate(-57.546875, -10.5)" class="label"><foreignObject height="21" width="115.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">5. 持续订阅信息</span></div></foreignObject></g></g><g transform="translate(546.234375, 450.41451263427734)" class="edgeLabel"><g transform="translate(-57.546875, -10.5)" class="label"><foreignObject height="21" width="115.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">6. 写入历史服务</span></div></foreignObject></g></g><g transform="translate(723.234375, 308.1390838623047)" class="edgeLabel"><g transform="translate(-41.546875, -10.5)" class="label"><foreignObject height="21" width="83.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">7. 通知计费</span></div></foreignObject></g></g><g transform="translate(723.234375, 450.41451263427734)" class="edgeLabel"><g transform="translate(-41.546875, -10.5)" class="label"><foreignObject height="21" width="83.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">8. 生成发票</span></div></foreignObject></g></g><g transform="translate(546.234375, 592.68994140625)" class="edgeLabel"><g transform="translate(-41.546875, -10.5)" class="label"><foreignObject height="21" width="83.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">9. 发布事件</span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(439.9140625, 18)" data-id="A" data-node="true" id="flowchart-A-0" class="node default default flowchart-label"><rect height="36" width="143" y="-18" x="-71.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-64, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="128"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">增长工程应用程序</span></div></foreignObject></g></g><g transform="translate(228.3203125, 125)" data-id="B" data-node="true" id="flowchart-B-1" class="node default default flowchart-label"><rect height="36" width="111" y="-18" x="-55.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-48, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="96"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">会员计划目录</span></div></foreignObject></g></g><g transform="translate(145.546875, 243.31954193115234)" data-id="C" data-node="true" id="flowchart-C-3" class="node default default flowchart-label"><circle height="36" width="47" r="23.5" ry="0" rx="0" style=""/><g transform="translate(-16, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="32"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">规则</span></div></foreignObject></g></g><g transform="translate(363.1015625, 243.31954193115234)" data-id="D" data-node="true" id="flowchart-D-5" class="node default default flowchart-label"><path transform="translate(-30.578125,-29.319540036931343)" d="M 0,8.213026691287562 a 30.578125,8.213026691287562 0,0,0 61.15625 0 a 30.578125,8.213026691287562 0,0,0 -61.15625 0 l 0,42.21302669128756 a 30.578125,8.213026691287562 0,0,0 61.15625 0 l 0,-42.21302669128756" style=""/><g transform="translate(-23.078125, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="46.15625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">SKUDB</span></div></foreignObject></g></g><g transform="translate(439.9140625, 125)" data-id="E" data-node="true" id="flowchart-E-7" class="node default default flowchart-label"><rect height="36" width="111" y="-18" x="-55.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-48, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="96"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">选择计划页面</span></div></foreignObject></g></g><g transform="translate(634.734375, 125)" data-id="F" data-node="true" id="flowchart-F-11" class="node default default flowchart-label"><rect height="36" width="79" y="-18" x="-39.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-32, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="64"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">付款页面</span></div></foreignObject></g></g><g transform="translate(634.734375, 243.31954193115234)" data-id="G" data-node="true" id="flowchart-G-13" class="node default default flowchart-label"><rect height="36" width="111" y="-18" x="-55.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-48, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="96"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">会员状态服务</span></div></foreignObject></g></g><g transform="translate(546.234375, 379.276798248291)" data-id="H" data-node="true" id="flowchart-H-15" class="node default default flowchart-label"><path transform="translate(-55.5,-35.637711864406775)" d="M 0,11.758474576271185 a 55.5,11.758474576271185 0,0,0 111 0 a 55.5,11.758474576271185 0,0,0 -111 0 l 0,47.75847457627118 a 55.5,11.758474576271185 0,0,0 111 0 l 0,-47.75847457627118" style=""/><g transform="translate(-48, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="96"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">会员订阅服务</span></div></foreignObject></g></g><g transform="translate(546.234375, 521.5522270202637)" data-id="I" data-node="true" id="flowchart-I-17" class="node default default flowchart-label"><path transform="translate(-55.5,-35.637711864406775)" d="M 0,11.758474576271185 a 55.5,11.758474576271185 0,0,0 111 0 a 55.5,11.758474576271185 0,0,0 -111 0 l 0,47.75847457627118 a 55.5,11.758474576271185 0,0,0 111 0 l 0,-47.75847457627118" style=""/><g transform="translate(-48, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="96"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">会员历史服务</span></div></foreignObject></g></g><g transform="translate(723.234375, 379.276798248291)" data-id="M" data-node="true" id="flowchart-M-19" class="node default default flowchart-label"><rect height="36" width="143" y="-18" x="-71.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-64, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="128"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">计费工程应用程序</span></div></foreignObject></g></g><g transform="translate(723.234375, 521.5522270202637)" data-id="N" data-node="true" id="flowchart-N-21" class="node default default flowchart-label"><rect height="36" width="111" y="-18" x="-55.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-48, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="96"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">会员定价服务</span></div></foreignObject></g></g><g transform="translate(546.234375, 646.18994140625)" data-id="J" data-node="true" id="flowchart-J-23" class="node default default flowchart-label"><rect height="36" width="47" y="-18" x="-23.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-16, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="32"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">事件</span></div></foreignObject></g></g><g transform="translate(465.734375, 732.18994140625)" data-id="K" data-node="true" id="flowchart-K-25" class="node default default flowchart-label"><polygon style="" transform="translate(-55.5,18)" class="label-container" points="0,0 111,0 111,-36 0,-36 0,0 -8,0 119,0 119,-36 -8,-36 -8,0"/><g transform="translate(-48, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="96"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">数据科学管道</span></div></foreignObject></g></g><g transform="translate(626.734375, 732.18994140625)" data-id="L" data-node="true" id="flowchart-L-27" class="node default default flowchart-label"><polygon style="" transform="translate(-39.5,18)" class="label-container" points="0,0 79,0 79,-36 0,-36 0,0 -8,0 87,0 87,-36 -8,-36 -8,0"/><g transform="translate(-32, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="64"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">消息管道</span></div></foreignObject></g></g></g></g></g></svg>
<p>下面将详细介绍每个步骤：</p>
<ol>
<li>首先，用户通过 Netflix 的增长工程应用程序选择计划。计划详情从会员计划目录服务中获取，该服务由 CockroachDB 支持。</li>
<li>会员计划目录服务根据预定义的地区和设备类型规则加载和读取计划。</li>
<li>然后将检索到的计划展示给用户，让他们根据自己的偏好和预算做出明智的决定。</li>
<li>用户选择计划后，流程会进入付款确认屏幕。在这里，用户提供付款详情并确认订阅。</li>
<li>确认后，用户点击 <code>Start Membership</code> 按钮，触发会员状态服务。该服务会将相关信息（如所选计划、价格层级和国家）保存到 Cassandra 数据库中。</li>
<li>会员状态服务还会将付款情况通知计费工程应用程序。</li>
<li>计费工程应用程序根据从会员定价服务获取的注册数据生成发票。</li>
<li>会员数据会同时写入会员历史服务，以确保全面记录用户的订阅历史。</li>
<li>发布事件以提示激活会员资格。这些事件会触发信息管道，负责向用户发送欢迎邮件，并通知下游系统以进行分析。</li>
</ol>
<h2 id="如何跟踪会员历史"><a class="markdownIt-Anchor" href="#如何跟踪会员历史"></a> 如何跟踪会员历史？</h2>
<p>在 Netflix 会员平台的早期阶段，会员历史和数据是通过应用程序级事件来跟踪的。</p>
<p>虽然这种方法在初期已经足够，但随着 Netflix 的扩张和会员数据复杂性的增加，显然需要一种更精细、更持久的数据跟踪解决方案。</p>
<p>为了满足这一需求，Netflix 开发了基于变更数据捕获 (CDC) 模式的强大解决方案。</p>
<p>作为参考，CDC 是一种设计模式，可直接捕获对数据库所做的更改，并将这些更改传播到下游系统进行进一步处理或分析。</p>
<p>下图显示了 CDC 流程的工作原理：</p>
<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewbox="-8 -50 659.953125 336" style="max-width: 659.953125px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-1753397113270"><style>#mermaid-1753397113270{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1753397113270 .error-icon{fill:#552222;}#mermaid-1753397113270 .error-text{fill:#552222;stroke:#552222;}#mermaid-1753397113270 .edge-thickness-normal{stroke-width:2px;}#mermaid-1753397113270 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1753397113270 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1753397113270 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1753397113270 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1753397113270 .marker{fill:#333333;stroke:#333333;}#mermaid-1753397113270 .marker.cross{stroke:#333333;}#mermaid-1753397113270 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1753397113270 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-1753397113270 .cluster-label text{fill:#333;}#mermaid-1753397113270 .cluster-label span,#mermaid-1753397113270 p{color:#333;}#mermaid-1753397113270 .label text,#mermaid-1753397113270 span,#mermaid-1753397113270 p{fill:#333;color:#333;}#mermaid-1753397113270 .node rect,#mermaid-1753397113270 .node circle,#mermaid-1753397113270 .node ellipse,#mermaid-1753397113270 .node polygon,#mermaid-1753397113270 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1753397113270 .flowchart-label text{text-anchor:middle;}#mermaid-1753397113270 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-1753397113270 .node .label{text-align:center;}#mermaid-1753397113270 .node.clickable{cursor:pointer;}#mermaid-1753397113270 .arrowheadPath{fill:#333333;}#mermaid-1753397113270 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1753397113270 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1753397113270 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1753397113270 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1753397113270 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-1753397113270 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1753397113270 .cluster text{fill:#333;}#mermaid-1753397113270 .cluster span,#mermaid-1753397113270 p{color:#333;}#mermaid-1753397113270 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1753397113270 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-1753397113270 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerheight="12" markerwidth="12" markerunits="userSpaceOnUse" refy="5" refx="6" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397113270_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/></marker><marker orient="auto" markerheight="12" markerwidth="12" markerunits="userSpaceOnUse" refy="5" refx="4.5" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397113270_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5" refx="11" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397113270_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5" refx="-1" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397113270_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5.2" refx="12" viewbox="0 0 11 11" class="marker cross flowchart" id="mermaid-1753397113270_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5.2" refx="-1" viewbox="0 0 11 11" class="marker cross flowchart" id="mermaid-1753397113270_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><g class="root"><g class="clusters"><g id="目标系统" class="cluster default flowchart-label"><rect height="278" width="238.953125" y="0" x="405" ry="0" rx="0" style=""/><g transform="translate(492.4765625, 0)" class="cluster-label"><foreignObject height="21" width="64"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">目标系统</span></div></foreignObject></g></g><g id="交易" class="cluster default flowchart-label"><rect height="106" width="242" y="86" x="113" ry="0" rx="0" style=""/><g transform="translate(218, 86)" class="cluster-label"><foreignObject height="21" width="32"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">交易</span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid-1753397113270_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" id="L-A-B-0" d="M63,139L67.167,139C71.333,139,79.667,139,88,139C96.333,139,104.667,139,112.117,139C119.567,139,126.133,139,129.417,139L132.7,139"/><path marker-end="url(#mermaid-1753397113270_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" id="L-B-C-0" d="M201,139L205.167,139C209.333,139,217.667,139,225.117,139C232.567,139,239.133,139,242.417,139L245.7,139"/><path marker-end="url(#mermaid-1753397113270_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-C LE-D" id="L-C-D-0" d="M330,139L334.167,139C338.333,139,346.667,139,355,139C363.333,139,371.667,139,380,139C388.333,139,396.667,139,404.117,139C411.567,139,418.133,139,421.417,139L424.7,139"/><path marker-end="url(#mermaid-1753397113270_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-E" id="L-D-E-0" d="M481.158,121L489.457,109.667C497.756,98.333,514.355,75.667,525.937,64.333C537.52,53,544.086,53,547.37,53L550.653,53"/><path marker-end="url(#mermaid-1753397113270_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-F" id="L-D-F-0" d="M505.953,139L510.12,139C514.286,139,522.62,139,531.403,139C540.186,139,549.42,139,554.036,139L558.653,139"/><path marker-end="url(#mermaid-1753397113270_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-G" id="L-D-G-0" d="M481.158,157L489.457,168.333C497.756,179.667,514.355,202.333,525.937,213.667C537.52,225,544.086,225,547.37,225L550.653,225"/></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"/></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(587.453125, 53)" data-id="E" data-node="true" id="flowchart-E-7" class="node default default flowchart-label"><rect height="36" width="63" y="-18" x="-31.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-24, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="48"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">数据库</span></div></foreignObject></g></g><g transform="translate(467.9765625, 139)" data-id="D" data-node="true" id="flowchart-D-5" class="node default default flowchart-label"><rect height="36" width="75.953125" y="-18" x="-37.9765625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-30.4765625, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="60.953125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">CDC进程</span></div></foreignObject></g></g><g transform="translate(587.453125, 139)" data-id="F" data-node="true" id="flowchart-F-9" class="node default default flowchart-label"><rect height="36" width="47" y="-18" x="-23.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-16, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="32"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">缓存</span></div></foreignObject></g></g><g transform="translate(587.453125, 225)" data-id="G" data-node="true" id="flowchart-G-11" class="node default default flowchart-label"><rect height="36" width="63" y="-18" x="-31.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-24, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="48"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">数据仓</span></div></foreignObject></g></g><g transform="translate(290.5, 139)" data-id="C" data-node="true" id="flowchart-C-3" class="node default default flowchart-label"><rect height="36" width="79" y="-18" x="-39.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-32, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="64"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">交易日志</span></div></foreignObject></g></g><g transform="translate(169.5, 139)" data-id="B" data-node="true" id="flowchart-B-1" class="node default default flowchart-label"><rect height="36" width="63" y="-18" x="-31.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-24, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="48"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">交易表</span></div></foreignObject></g></g><g transform="translate(31.5, 139)" data-id="A" data-node="true" id="flowchart-A-0" class="node default default flowchart-label"><path transform="translate(-31.5,-30.566489361702125)" d="M 0,8.377659574468085 a 31.5,8.377659574468085 0,0,0 63 0 a 31.5,8.377659574468085 0,0,0 -63 0 l 0,44.37765957446808 a 31.5,8.377659574468085 0,0,0 63 0 l 0,-44.37765957446808" style=""/><g transform="translate(-24, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="48"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">数据库</span></div></foreignObject></g></g></g></g></g><text class="flowchartTitleText" y="-25" x="321.9765625">CDC 如何工作？</text></svg>
<p>采用类似 CDC 的方法可确保对会员数据源所做的所有 delta 更改都记录在一个仅有附件的日志系统中，该日志系统由 Cassandra 数据库提供支持。</p>
<p>下图显示了 Netflix 会员平台的历史数据流：</p>
<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewbox="-8 -50 513.734375 551.5254516601562" style="max-width: 513.734375px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-1753397114592"><style>#mermaid-1753397114592{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1753397114592 .error-icon{fill:#552222;}#mermaid-1753397114592 .error-text{fill:#552222;stroke:#552222;}#mermaid-1753397114592 .edge-thickness-normal{stroke-width:2px;}#mermaid-1753397114592 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1753397114592 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1753397114592 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1753397114592 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1753397114592 .marker{fill:#333333;stroke:#333333;}#mermaid-1753397114592 .marker.cross{stroke:#333333;}#mermaid-1753397114592 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1753397114592 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-1753397114592 .cluster-label text{fill:#333;}#mermaid-1753397114592 .cluster-label span,#mermaid-1753397114592 p{color:#333;}#mermaid-1753397114592 .label text,#mermaid-1753397114592 span,#mermaid-1753397114592 p{fill:#333;color:#333;}#mermaid-1753397114592 .node rect,#mermaid-1753397114592 .node circle,#mermaid-1753397114592 .node ellipse,#mermaid-1753397114592 .node polygon,#mermaid-1753397114592 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1753397114592 .flowchart-label text{text-anchor:middle;}#mermaid-1753397114592 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-1753397114592 .node .label{text-align:center;}#mermaid-1753397114592 .node.clickable{cursor:pointer;}#mermaid-1753397114592 .arrowheadPath{fill:#333333;}#mermaid-1753397114592 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1753397114592 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1753397114592 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1753397114592 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1753397114592 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-1753397114592 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1753397114592 .cluster text{fill:#333;}#mermaid-1753397114592 .cluster span,#mermaid-1753397114592 p{color:#333;}#mermaid-1753397114592 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1753397114592 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-1753397114592 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerheight="12" markerwidth="12" markerunits="userSpaceOnUse" refy="5" refx="6" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397114592_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/></marker><marker orient="auto" markerheight="12" markerwidth="12" markerunits="userSpaceOnUse" refy="5" refx="4.5" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397114592_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5" refx="11" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397114592_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5" refx="-1" viewbox="0 0 10 10" class="marker flowchart" id="mermaid-1753397114592_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5.2" refx="12" viewbox="0 0 11 11" class="marker cross flowchart" id="mermaid-1753397114592_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><marker orient="auto" markerheight="11" markerwidth="11" markerunits="userSpaceOnUse" refy="5.2" refx="-1" viewbox="0 0 11 11" class="marker cross flowchart" id="mermaid-1753397114592_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><g class="root"><g class="clusters"/><g class="edgePaths"><path marker-end="url(#mermaid-1753397114592_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" id="L-A-B-0" d="M197.094,36L197.094,41.917C197.094,47.833,197.094,59.667,197.094,70.617C197.094,81.567,197.094,91.633,197.094,96.667L197.094,101.7"/><path marker-end="url(#mermaid-1753397114592_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" id="L-B-C-0" d="M147.224,171.677L138.944,178.694C130.665,185.71,114.106,199.743,105.826,211.792C97.547,223.842,97.547,233.909,97.547,238.942L97.547,243.975"/><path marker-end="url(#mermaid-1753397114592_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-D" id="L-B-D-0" d="M246.964,171.677L255.243,178.694C263.523,185.71,280.082,199.743,288.361,213.072C296.641,226.4,296.641,239.025,296.641,245.338L296.641,251.65"/><path marker-end="url(#mermaid-1753397114592_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-E" id="L-D-E-0" d="M249.818,322.78L240.364,330.884C230.91,338.987,212.002,355.194,202.548,368.33C193.094,381.467,193.094,391.534,193.094,396.567L193.094,401.6"/><path marker-end="url(#mermaid-1753397114592_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-F" id="L-D-F-0" d="M343.463,322.78L352.917,330.884C362.371,338.987,381.279,355.194,390.733,372.549C400.188,389.905,400.188,408.409,400.188,417.661L400.188,426.913"/></g><g class="edgeLabels"><g transform="translate(197.09375, 71.5)" class="edgeLabel"><g transform="translate(-89.546875, -10.5)" class="label"><foreignObject height="21" width="179.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">1. 计费合作伙伴更新请求</span></div></foreignObject></g></g><g transform="translate(97.546875, 213.77542877197266)" class="edgeLabel"><g transform="translate(-97.546875, -10.5)" class="label"><foreignObject height="21" width="195.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">2. 更新客户的账单合作伙伴</span></div></foreignObject></g></g><g transform="translate(296.640625, 213.77542877197266)" class="edgeLabel"><g transform="translate(-81.546875, -10.5)" class="label"><foreignObject height="21" width="163.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">3. 为客户添加更新数据</span></div></foreignObject></g></g><g transform="translate(193.09375, 371.40042877197266)" class="edgeLabel"><g transform="translate(-89.546875, -10.5)" class="label"><foreignObject height="21" width="179.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">4. 将数据插入会员历史表</span></div></foreignObject></g></g><g transform="translate(400.1875, 371.40042877197266)" class="edgeLabel"><g transform="translate(-97.546875, -10.5)" class="label"><foreignObject height="21" width="195.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">5. 发出更新会员资格的事件</span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(197.09375, 18)" data-id="A" data-node="true" id="flowchart-A-0" class="node default default flowchart-label"><rect height="36" width="79" y="-18" x="-39.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-32, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="64"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">会员服务</span></div></foreignObject></g></g><g transform="translate(197.09375, 142.63771438598633)" data-id="B" data-node="true" id="flowchart-B-1" class="node default default flowchart-label"><path transform="translate(-55.5,-35.637711864406775)" d="M 0,11.758474576271185 a 55.5,11.758474576271185 0,0,0 111 0 a 55.5,11.758474576271185 0,0,0 -111 0 l 0,47.75847457627118 a 55.5,11.758474576271185 0,0,0 111 0 l 0,-47.75847457627118" style=""/><g transform="translate(-48, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="96"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">会员订阅服务</span></div></foreignObject></g></g><g transform="translate(97.546875, 292.58792877197266)" data-id="C" data-node="true" id="flowchart-C-3" class="node default default flowchart-label"><circle height="34" width="86.625" r="43.3125" ry="0" rx="0" style=""/><g transform="translate(-35.8125, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="71.625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Cassandra</span></div></foreignObject></g></g><g transform="translate(296.640625, 292.58792877197266)" data-id="D" data-node="true" id="flowchart-D-5" class="node default default flowchart-label"><path transform="translate(-55.5,-35.637711864406775)" d="M 0,11.758474576271185 a 55.5,11.758474576271185 0,0,0 111 0 a 55.5,11.758474576271185 0,0,0 -111 0 l 0,47.75847457627118 a 55.5,11.758474576271185 0,0,0 111 0 l 0,-47.75847457627118" style=""/><g transform="translate(-48, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="96"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">会员历史服务</span></div></foreignObject></g></g><g transform="translate(193.09375, 450.21292877197266)" data-id="E" data-node="true" id="flowchart-E-7" class="node default default flowchart-label"><circle height="34" width="86.625" r="43.3125" ry="0" rx="0" style=""/><g transform="translate(-35.8125, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="71.625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Cassandra</span></div></foreignObject></g></g><g transform="translate(400.1875, 450.21292877197266)" data-id="F" data-node="true" id="flowchart-F-9" class="node default default flowchart-label"><rect height="36" width="47" y="-18" x="-23.5" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-16, -10.5)" style="" class="label"><rect/><foreignObject height="21" width="32"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">事件</span></div></foreignObject></g></g></g></g></g><text class="flowchartTitleText" y="-25" x="248.8671875">新会员历史记录流程</text></svg>
<p>让我们来看看这个过程的步骤：</p>
<ol>
<li>假设有一个修改会员计费伙伴的更新请求。会员订阅服务接收到该请求。</li>
<li>会员订阅服务会处理该请求并更新 Cassandra 数据库中的相关信息。</li>
<li>除了更新主数据库外，用户的更新数据还会附加到会员历史服务中。该服务负责维护会员数据所有更改的历史记录。</li>
<li>会员历史服务将附加数据插入会员历史表。该表是历史数据的持久存储。</li>
<li>最后会发出一个事件，通知下游系统有关成员资格更新的信息。这样，其他服务和流程就能对变化做出反应，并执行任何必要的操作。</li>
</ol>
<p>这种设计有多种好处：</p>
<ul>
<li><strong>详细调试</strong>：通过维护会员数据更改的全面历史记录，系统可以进行详细的调试和故障排除。开发人员可以追溯事件发生的顺序，了解数据是如何演变的。</li>
<li><strong>事件回放和对账</strong>：日志系统的只附加特性允许重放事件。在数据损坏或不一致的情况下，系统可以通过从已知的良好状态重放事件来调节数据。</li>
<li><strong>客户服务分析</strong>：会员历史记录服务捕获的历史数据使客户服务分析变得简单。</li>
</ul>
<h2 id="netflix-会员平台的技术足迹"><a class="markdownIt-Anchor" href="#netflix-会员平台的技术足迹"></a> Netflix 会员平台的技术足迹</h2>
<p>Netflix 会员制平台的技术架构可大致分为两个主要领域：开发和运营/监控。</p>
<p>让我们来详细了解每个领域。</p>
<h4 id="开发堆栈"><a class="markdownIt-Anchor" href="#开发堆栈"></a> 开发堆栈</h4>
<p>Netflix 会员制平台的开发堆栈可以用以下要点来描述：</p>
<ul>
<li>Netflix 的架构经过优化，可处理每秒高读取请求 (RPS)，以支持其庞大的用户群。</li>
<li>会员平台由超过 12 个微服务组成，这些微服务在 HTTP 层使用 gRPC 进行通信。通常情况下，该平台每秒可处理 300-400 万个请求。为了支持如此大的处理量，Netflix 采用了 gRPC 层的客户端缓存和整个记录的内存缓存等技术，以防止 CockroachDB 成为单点故障。</li>
<li>会员平台使用的主要编程语言是带有 Spring Boot 的 Java。不过，在某些重写场景中，Netflix 正在逐步过渡到 Kotlin。</li>
<li>Kafka 在消息传递和与其他团队（如消息传递和下游分析）的接口方面发挥着关键作用。这确保了不同系统间的顺畅通信和数据流。</li>
<li>Netflix 利用 Spark 和 Flink 对其大数据执行离线对账任务。这些对账工作对于保持会员平台内各种记录系统（如订阅和会员历史数据库）之间的数据一致性和一致性至关重要。数据的准确性还延伸到外部系统，确保整个生态系统的状态一致。</li>
<li>为确保在线系统的数据一致性，Netflix 采用了轻量级事务并使用 Cassandra 等数据库。这种方法保证了不同服务间数据的完整性和可靠性。</li>
</ul>
<h4 id="运行和监测"><a class="markdownIt-Anchor" href="#运行和监测"></a> 运行和监测</h4>
<p>Netflix 非常重视可观察性和监控，以确保其会员平台的顺利运行：</p>
<ul>
<li>广泛的日志记录、仪表板和分布式跟踪机制可实现快速的错误检测和解决。在 Netflix 复杂的微服务环境中，这些工具对于发现和排除故障至关重要。</li>
<li>设置了生产警报，以跟踪运营指标并保证最佳服务水平。</li>
<li>利用运营数据来推动机器学习模型，从而增强异常检测并启用自动问题解决流程。所有这些都是为了努力为用户提供不间断的流媒体体验。</li>
<li>Netflix 利用 Kibana 和 Elasticsearch 等工具创建仪表板并分析日志数据。在错误率激增的情况下，这些仪表盘可让团队快速识别导致问题的特定端点，并采取纠正措施。</li>
</ul>
<h2 id="结论"><a class="markdownIt-Anchor" href="#结论"></a> 结论</h2>
<p>总之，Netflix 的会员平台是公司成功的关键组成部分，使其能够管理用户订阅的整个生命周期。该平台已从一个简单、轻量级的库发展成为一个强大、可扩展的架构，每秒可处理数百万个请求。</p>
<p>需要记住的一些关键要点如下：</p>
<ul>
<li>会员平台负责管理用户注册、计划变更、续订和取消。</li>
<li>它采用微服务架构，使用 CockroachDB 和 Cassandra 等数据库存储会员数据。</li>
<li>该平台使用 CDC 捕获并存储会员数据的历史变化，用于调试、事件重放和分析。</li>
</ul>
<h4 id="参考文献"><a class="markdownIt-Anchor" href="#参考文献"></a> 参考文献</h4>
<ul>
<li><a target="_blank" rel="noopener" href="https://substack.com/redirect/19db3f26-2ee5-4ff7-ba91-dd7977f4d927?j=eyJ1IjoiM241d3VpIn0.zuhQr2h0bppviCayt6ZoA-2zzi3IsOcAKWBL0Cs6t9I">Managing 238M memberships at Netflix</a></li>
<li><a target="_blank" rel="noopener" href="https://substack.com/redirect/3817e491-2856-4a03-8706-a2c103787021?j=eyJ1IjoiM241d3VpIn0.zuhQr2h0bppviCayt6ZoA-2zzi3IsOcAKWBL0Cs6t9I">Netflix’s Membership Platform</a></li>
<li><a target="_blank" rel="noopener" href="https://substack.com/redirect/2c62bed5-a3b0-480d-90b0-620f99ff1c08?j=eyJ1IjoiM241d3VpIn0.zuhQr2h0bppviCayt6ZoA-2zzi3IsOcAKWBL0Cs6t9I">Presentation on Managing 238M memberships at Netflix</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="49c3.html">上一篇</a><a class="next" href="369.html">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'hallowdem';
var disqus_identifier = 'posts/75ba.html';
var disqus_title = 'ByteByteGo 简报翻译【1】：Netflix 如何管理 2.38 亿会员？';
var disqus_url = 'https://cytrogen.icu/posts/75ba.html';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async></script><div class="copyright"><p>© 2022 - 2025 <a href="https://cytrogen.icu">Cytrogen</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/claymcleod/hexo-theme-hermes" target="_blank">hexo-theme-hermes</a>. </p></div></footer></div><script>document.addEventListener('DOMContentLoaded', function() {
  const codeBlocks = document.querySelectorAll('figure.highlight');
  
  codeBlocks.forEach(block => {
    let caption = block.querySelector('figcaption');
    if (!caption) {
      caption = document.createElement('figcaption');
      block.insertBefore(caption, block.firstChild);
    }

    const info = document.createElement('div');
    info.className = 'info';
    
    const filename = caption.querySelector('span');
    if (filename) {
      filename.className = 'filename';
      info.appendChild(filename);
    }
    
    const lang = block.className.split(' ')[1];
    if (lang) {
      const langSpan = document.createElement('span');
      langSpan.className = 'lang-name';
      langSpan.textContent = lang;
      info.appendChild(langSpan);
    }

    const sourceLink = caption.querySelector('a');
    if (sourceLink) {
      sourceLink.className = 'source-link';
      info.appendChild(sourceLink);
    }

    const actions = document.createElement('div');
    actions.className = 'actions';

    const codeHeight = block.scrollHeight;
    const threshold = 300;

    if (codeHeight > threshold) {
      block.classList.add('folded');
      
      const toggleBtn = document.createElement('button');
      toggleBtn.textContent = '展开';
      toggleBtn.addEventListener('click', () => {
        block.classList.toggle('folded');
        toggleBtn.textContent = block.classList.contains('folded') ? '展开' : '折叠';
      });
      actions.appendChild(toggleBtn);
    }

    const copyBtn = document.createElement('button');
    copyBtn.textContent = '复制';
    copyBtn.addEventListener('click', async () => {
      const codeLines = block.querySelectorAll('.code .line');
      const code = Array.from(codeLines)
        .map(line => line.textContent)
        .join('\n')
        .replace(/\n\n/g, '\n');
      
      try {
        await navigator.clipboard.writeText(code);
        copyBtn.textContent = '已复制';
        copyBtn.classList.add('copied');
        
        setTimeout(() => {
          copyBtn.textContent = '复制';
          copyBtn.classList.remove('copied');
        }, 3000);
      } catch (err) {
        console.error('复制失败:', err);
        copyBtn.textContent = '复制失败';
        
        setTimeout(() => {
          copyBtn.textContent = '复制';
        }, 3000);
      }
    });
    actions.appendChild(copyBtn);

    caption.innerHTML = '';
    caption.appendChild(info);
    caption.appendChild(actions);

    const markedLines = block.getAttribute('data-marked-lines');
    if (markedLines) {
      const lines = markedLines.split(',');
      lines.forEach(range => {
        if (range.includes('-')) {
          const [start, end] = range.split('-').map(Number);
          for (let i = start; i <= end; i++) {
            const line = block.querySelector(`.line-${i}`);
            if (line) line.classList.add('marked');
          }
        } else {
          const line = block.querySelector(`.line-${range}`);
          if (line) line.classList.add('marked');
        }
      });
    }
  });
});</script><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-4PVPZXE0QQ"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-4PVPZXE0QQ');</script><script src="../js/search.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
    const searchBtn = document.getElementById('search-btn');
    const searchPopup = document.getElementById('search-popup');
    const searchInput = document.getElementById('local-search-input');
    const searchClose = document.getElementById('search-close');

    if (searchBtn && searchPopup && searchInput) {
        searchBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            searchPopup.classList.remove('hidden');
            searchInput.focus();
        });

        searchPopup.addEventListener('click', function(e) {
            e.stopPropagation();
        });

        if (searchClose) {
            searchClose.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                searchPopup.classList.add('hidden');
            });
        }

        document.addEventListener('click', function() {
            searchPopup.classList.add('hidden');
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                searchPopup.classList.add('hidden');
            }
        });

        let search_path = "search.xml";
        if (search_path.length === 0) {
            search_path = "search.xml";
        }
        const path = "/" + search_path;
        searchFunc(path, 'local-search-input', 'local-search-result');
    }
});
</script><script>document.addEventListener('DOMContentLoaded', function() {
    const languageToggle = document.querySelector('.language-toggle');
    const languageDropdown = document.querySelector('.language-dropdown');

    if (languageToggle && languageDropdown) {
    languageToggle.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        languageDropdown.classList.toggle('hidden');
    });

    languageDropdown.addEventListener('click', function(e) {
        e.stopPropagation();
    });

    document.addEventListener('click', function() {
        languageDropdown.classList.add('hidden');
    });

    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
        languageDropdown.classList.add('hidden');
        }
    });
    }
});
</script><script>document.addEventListener('DOMContentLoaded', function() {
    const moreToggle = document.querySelector('.more-toggle');
    const moreDropdown = document.querySelector('.more-dropdown');

    if (moreToggle && moreDropdown) {
        moreToggle.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            moreDropdown.classList.toggle('hidden');
        });

        moreDropdown.addEventListener('click', function(e) {
            e.stopPropagation();
        });

        document.addEventListener('click', function() {
            moreDropdown.classList.add('hidden');
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                moreDropdown.classList.add('hidden');
            }
        });
    }
});
</script><script>const hamburger = document.querySelector('.hamburger-menu');
const mobileMenu = document.querySelector('.mobile-menu-container');
const menuClose = document.querySelector('.menu-close');

if (hamburger && mobileMenu) {
    const closeDropdowns = () => {
        const openDropdowns = mobileMenu.querySelectorAll('.dropdown-menu.show');
        const rotatedToggles = mobileMenu.querySelectorAll('.dropdown-toggle.rotated');
        openDropdowns.forEach(dropdown => dropdown.classList.remove('show'));
        rotatedToggles.forEach(toggle => toggle.classList.remove('rotated'));
    };

    const closeMenu = () => {
        mobileMenu.classList.remove('show');
        hamburger.setAttribute('aria-expanded', false);
        closeDropdowns();
    };

    hamburger.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        mobileMenu.classList.toggle('show');
        const isExpanded = mobileMenu.classList.contains('show');
        hamburger.setAttribute('aria-expanded', isExpanded);
    });

    if (menuClose) {
        menuClose.addEventListener('click', closeMenu);
    }

    const dropdownItems = mobileMenu.querySelectorAll('.has-dropdown');
    dropdownItems.forEach(item => {
        const link = item.querySelector('.nav-link');
        const dropdownMenu = item.querySelector('.dropdown-menu');
        const dropdownToggle = item.querySelector('.dropdown-toggle');

        if (link && dropdownMenu) {
            link.addEventListener('click', function(e) {
                if (e.target !== link) return;
                e.preventDefault();
                dropdownMenu.classList.toggle('show');
                dropdownToggle?.classList.toggle('rotated');
            });
        }
    });

    mobileMenu.addEventListener('click', e => e.stopPropagation());

    document.addEventListener('click', closeMenu);

    document.addEventListener('keydown', e => {
        if (e.key === 'Escape' && mobileMenu.classList.contains('show')) {
            closeMenu();
        }
    });
}</script><div class="hidden" id="search-popup"><div id="search-panel"><input type="text" id="local-search-input" placeholder="搜索..."><div id="local-search-result"></div></div></div></body></html>