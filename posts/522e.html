<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>《黑客攻防技术宝典：Web 实战篇》・在读笔记 · Cytrogen 的个人博客</title><meta name="description" content="近期 “收割” 了一批感兴趣的书，空闲时会阅读一下。不过很快就会发现，没法随时随地阅读它们，因为我总是想要记笔记。 顺带一提，我用的是 Calibre 统一管理书籍，手机（安卓）用的是 Moon+ Reader、iPad 用的是 KyBook 3。Calibre 可以启动内容服务器，同个局域网下让移动设备访问所有的书籍并下载，很是方便。Moon+ Reader 还可以直接通过 OPDS（Open Publication Distribution System，开放式出版发布系统）下载书籍。 这一篇阅读的是《黑客攻防技术宝典：Web 实战篇》（The Web Application Hacker's Handbook: Finding and Exploiting Security Flaws）。"><link rel="icon" href="../favicon.png"><link rel="preload" href="../fonts/opensans-regular-latin.woff2" as="font" type="font/woff2" crossorigin="anonymous"><style>@font-face {
  font-family: 'Open Sans';
  src: url('../fonts/opensans-regular-latin.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
  size-adjust: 107%;
  ascent-override: 97%;
  descent-override: 25%;
  line-gap-override: 0%;
}
</style><link rel="stylesheet" href="../css/ares.css"><script data-netlify-skip-bundle="true">(function() {
  const getInitialTheme = () => {
    const saved = localStorage.getItem('theme');
    if (saved && (saved === 'light' || saved === 'dark')) {
      return saved;
    }
    
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
    
    return 'light';
  };
  
  const theme = getInitialTheme();
  document.documentElement.setAttribute('data-theme', theme);
  
  document.documentElement.style.colorScheme = theme;
  
  // Add anti-flicker style for dark mode
  if (theme === 'dark') {
    const style = document.createElement('style');
    style.id = 'anti-flicker-style';
    style.innerHTML = `
      #page-wrapper[data-theme="dark"] {
        background-color: #0f172a;
        color: #f1f5f9;
      }
    `;
    document.head.appendChild(style);
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    const pageWrapper = document.getElementById('page-wrapper');
    if (pageWrapper) {
      pageWrapper.setAttribute('data-theme', theme);
    }
  });
})();

</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="atom.xml" title="Cytrogen 的个人博客" type="application/atom+xml">
</head><body><div id="page-wrapper"><a class="skip-link" href="#main-content">跳到主要内容</a><div class="wrap"><header><a class="logo-link" href="../index.html"><img src="../favicon.png" alt="logo"></a><nav class="site-nav"><div class="nav-main"><div class="nav-primary"><ul class="nav-list hidden-mobile"><li class="nav-item"><a class="nav-link" href="../index.html">首页</a></li></ul><div class="nav-tools"><div class="language-menu"><button class="language-toggle" type="button"><svg class="icon icon-globe" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" focusable="false"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4a9.267 9.267 0 0 1 .64-1.539 6.7 6.7 0 0 1 .597-.933A7.025 7.025 0 0 0 2.255 4H4.09zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a6.958 6.958 0 0 0-.656 2.5h2.49zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5H4.847zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5H4.51zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12c.138.386.295.744.468 1.068.552 1.035 1.218 1.65 1.887 1.855V12H5.145zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11a13.652 13.652 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5H3.82zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855A7.97 7.97 0 0 0 10.855 12H8.5zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5a6.959 6.959 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5h2.49zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4a7.966 7.966 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4h2.355z"></path></svg><span>中文</span></button><div class="language-dropdown"></div></div></div><div class="nav-controls"><div class="more-menu hidden-mobile"><button class="more-toggle" type="button"><span>更多</span><svg class="icon icon-chevron-down" width="12" height="12" viewBox="0 0 12 12" fill="currentColor" aria-hidden="true" focusable="false"><path d="M6 8.825c-.2 0-.4-.1-.5-.2l-3.3-3.3c-.3-.3-.3-.8 0-1.1s.8-.3 1.1 0l2.7 2.7 2.7-2.7c.3-.3.8-.3 1.1 0s.3.8 0 1.1l-3.3 3.3c-.1.1-.3.2-.5.2z"></path></svg></button><div class="more-dropdown"><ul class="dropdown-list"><li class="dropdown-item"><a class="nav-link" href="../archives">归档</a></li><li class="dropdown-item"><a class="nav-link" href="../categories">分类</a></li><li class="dropdown-item"><a class="nav-link" href="../tags">标签</a></li><li class="dropdown-item"><a class="nav-link" href="../about">关于</a></li><li class="dropdown-item"><a class="nav-link" href="../friends">友链</a></li><li class="dropdown-item"><a class="nav-link" href="../atom.xml">RSS订阅</a></li><li class="dropdown-item"><a class="dropdown-link" href="https://portfolio.cytrogen.icu" target="_blank" rel="noopener noreferrer">作品集<svg class="icon icon-external-link" width="14" height="14" viewBox="0 0 14 14" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8.636 2.364A1 1 0 0 1 10 1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V3.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 2H9a1 1 0 0 1-1.364-1.636zM2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 1 1 2 0v3a3 3 0 0 1-3 3H2a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3h3a1 1 0 1 1 0 2H2z"></path></svg></a></li><li class="dropdown-item"><a class="dropdown-link" href="https://github.com/cytrogen" target="_blank" rel="noopener noreferrer">GitHub<svg class="icon icon-external-link" width="14" height="14" viewBox="0 0 14 14" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8.636 2.364A1 1 0 0 1 10 1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V3.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 2H9a1 1 0 0 1-1.364-1.636zM2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 1 1 2 0v3a3 3 0 0 1-3 3H2a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3h3a1 1 0 1 1 0 2H2z"></path></svg></a></li></ul></div></div><div class="theme-switcher"><button class="theme-toggle" type="button" role="switch" aria-pressed="false" aria-label="切换主题"><div class="theme-icon moon-icon"><svg class="icon icon-moon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" focusable="false"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path></svg></div><div class="theme-icon sun-icon"><svg class="icon icon-sun" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></svg></div></button></div><details class="mobile-menu-details hidden-desktop"><summary class="hamburger-menu" aria-label="nav.menu"><svg class="icon icon-bars" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" focusable="false"><path d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"></path></svg><span class="menu-text">nav.menu</span></summary><div class="mobile-menu-dropdown"><ul class="mobile-nav-list"><li class="mobile-nav-item"><a class="mobile-nav-link" href="../index.html">首页</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../archives">归档</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../categories">分类</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../tags">标签</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../about">关于</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../friends">友链</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../atom.xml">RSS订阅</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="https://portfolio.cytrogen.icu" target="_blank" rel="noopener noreferrer">作品集<svg class="icon icon-external-link" width="14" height="14" viewBox="0 0 14 14" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8.636 2.364A1 1 0 0 1 10 1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V3.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 2H9a1 1 0 0 1-1.364-1.636zM2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 1 1 2 0v3a3 3 0 0 1-3 3H2a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3h3a1 1 0 1 1 0 2H2z"></path></svg></a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="https://github.com/cytrogen" target="_blank" rel="noopener noreferrer">GitHub<svg class="icon icon-external-link" width="14" height="14" viewBox="0 0 14 14" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8.636 2.364A1 1 0 0 1 10 1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V3.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 2H9a1 1 0 0 1-1.364-1.636zM2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 1 1 2 0v3a3 3 0 0 1-3 3H2a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3h3a1 1 0 1 1 0 2H2z"></path></svg></a></li></ul></div></details></div></div></div></nav></header><main class="container" id="main-content" tabindex="-1"><div class="post"><article class="post-block"><h1 class="post-title">《黑客攻防技术宝典：Web 实战篇》・在读笔记</h1><div class="post-info">9/17/2025</div><div class="post-content"><html><head></head><body><p>近期「收割」了一批感兴趣的书，空闲时会阅读一下。不过很快就会发现，没法随时随地阅读它们，因为我总是想要记笔记。</p>
<p>顺带一提，我用的是 <a target="_blank" rel="noopener" href="https://calibre-ebook.com/">Calibre</a> 统一管理书籍，手机（安卓）用的是 <a target="_blank" rel="noopener" href="https://moondownload.com/">Moon+ Reader</a>、iPad 用的是 <a target="_blank" rel="noopener" href="http://kybook-reader.com/">KyBook 3</a>。Calibre 可以启动内容服务器，同个局域网下让移动设备访问所有的书籍并下载，很是方便。Moon+ Reader 还可以直接通过 OPDS（Open Publication Distribution System，开放式出版发布系统）下载书籍。</p>
<p>这一篇阅读的是<a target="_blank" rel="noopener" href="https://www.google.com/books/edition/The_Web_Application_Hacker_s_Handbook/jN6cDprdnd0C?hl=en">《黑客攻防技术宝典：Web 实战篇》</a>（<em>The Web Application Hacker's Handbook: Finding and Exploiting Security Flaws</em>）。</p>
<span id="more"></span>
<h2 id="第一章"><a class="markdownIt-Anchor" href="#第一章"></a> 第一章</h2>
<p>早期的万维网仅由 Web 站点构成。</p>
<blockquote>
<p>Web 1.0 时代，Web 站点的唯一功能就是陈列信息，也就是静态文档。作为读者，你无法对该它作出任何影响，只能去看它。</p>
<p>到了 Web 2.0 时代，互联网变成了一个功能强大的交互式软件或服务平台。你可以注册登录、转账、发布照片等。</p>
</blockquote>
<p>现在，网站几乎都是 Web 应用程序。安全问题变得至关重要且复杂。</p>
<p>作者表示，就算使用 SSL 或者遵循 PCI 标准扫描 Web 站点，也会遇到这些漏洞：</p>
<blockquote>
<p>SSL（Secure Sockets Layer，安全套接层），会加密浏览器和网站服务器之间的通信通道。现在则有另一个名字：TLS（Transport Layer Security，传输层安全协议），不过本质是一样的。</p>
</blockquote>
<blockquote>
<p>PCI 通常指的是 PCI DSS（Payment Card Industry Data Security Standard，支付卡行业数据安全标准）。这是由 Visa、MasterCard 等主流信用卡公司联合制定和推行的一套安全规则和要求。它规定了任何处理、存储或传输信用卡信息的商家或机构<strong>必须</strong>遵守的安全标准。所有接受信用卡支付的线上电商、线下实体店、支付处理公司等，都必须遵守 PCI DSS 标准。定期进行的「PCI 扫描」就是为了检查商家的系统是否符合这些规定。</p>
</blockquote>
<ul>
<li>不完善的身份验证
<ul>
<li>登录环节有漏洞</li>
</ul>
</li>
<li>不完善的访问控制
<ul>
<li>登录之后的权限管理混乱。例如普通用户可以查看其他用户的隐私数据（比如订单、私信），甚至可以执行管理员才能做的操作（比如删除别人的账户）</li>
</ul>
</li>
<li>SQL 注入
<ul>
<li>利用输入框，向网站的数据库下达恶意命令</li>
</ul>
</li>
<li>跨站点脚本（XSS）
<ul>
<li>攻击者在网站上留下恶意代码，当其他用户访问时，这段代码会在他们的浏览器里执行</li>
</ul>
</li>
<li>信息泄露
<ul>
<li>网站泄露了太多内部技术细节</li>
</ul>
</li>
<li>跨站点请求伪造（CSRF）
<ul>
<li>强迫一个已登录的用户，在不知情的情况下，向网站发送一个他本不想发送的请求</li>
</ul>
</li>
</ul>
<p>这些问题里，最核心的问题是：<strong>服务器永远不能信任客户端、永远假设客户端发来的请求都是暗藏恶意的。</strong></p>
<ol>
<li>
<p>用户可以拦截和修改浏览器与服务器之间传递的所有数据，包括请求参数、Cookie 等。任何在浏览器端做的安全检查（比如「价格不能是负数」）都可以被轻松绕过</p>
</li>
<li>
<p>用户可以不按照开发者设计的流程操作。比如一个购物流程是「加入购物车 -&gt; 填写地址 -&gt; 支付」，用户可能直接跳到第 3 步，或者在一个步骤里提交 100 次请求</p>
</li>
<li>
<p>攻击者不一定用普通的浏览器（Chrome、Firefox）来访问你的网站。他们有各种专业工具（比如 Postman、Burp Suite），可以构造出浏览器绝对无法发出的、稀奇古怪的请求</p>
</li>
</ol>
<p>这意味着 Web 安全的真正战场不在于加固传输通道（SSL 的工作），而在于服务器后端本身必须建立一套「不信任」和「严格审查」的机制。</p>
<p>Web 应用安全问题之所以如此普遍和顽固，就是因为整个开发生态系统存在一系列系统性缺陷，导致即使是善意的开发者也很容易写出不安全的代码。</p>
<ol>
<li>
<p>不成熟的安全意识。这很简单理解：写网站的程序员通常不是安全专家。IT 安全人员可能很懂防火墙，但不懂 SQL 注入；Web 开发者可能每天忙于用第三方工具包拼凑出功能，但很少有时间去深入研究安全基础，甚至会错误地假设他们使用的框架是绝对安全的</p>
</li>
<li>
<p>独立开发。公司的网络基础设施通常是购买业界领先地成熟产品，按照标准流程部署，相对可靠。但 Web 应用几乎都是自己从头开发的。即使使用了第三方组件，也是通过新代码「粘合」起来的。这意味着每个网站都是一个独特的实验品，不像工业化标准产品那样经过千锤百炼</p>
</li>
<li>
<p>欺骗性的简化。现在有很多强大的开发框架（如 Liferay），提供了大量现成的代码组件。一个新手程序员可以在短时间内「拖拉拽」出一个功能强大的网站，但他根本不理解其内部运行机制和潜在风险。能用 ≠ 安全。这种模式导致大量使用相同框架的网站，一旦框架本身爆出漏洞，就会「一损俱损」</p>
</li>
<li>
<p>迅速发展的威胁形势。Web 攻击和防御是一个高速发展的领域。今天还被认为是安全的防御方法，明天可能就被新的攻击技巧破解。一个开发团队在项目开始时学习了最新的安全知识，但等他们花了一两年时间开发完产品并上线时，黑客们已经发明出了全新的攻击武器</p>
</li>
<li>
<p>资源与时间限制。大多数项目都有严格的预算和上线日期。功能开发和稳定性是首要任务。安全问题因为「看不见摸不着」，优先级通常被排在最后。很多时候，只有到项目快上线了，才找人匆匆忙忙做个「渗透测试」，这种测试往往只能发现最表面的问题</p>
</li>
<li>
<p>技术上强其所难。很多 Web 核心技术，例如 JavaScript，都诞生于互联网早期，当时的设计目标也都只是为了显示一些简单的静态文档。但现在，我们用这些技术去构建极其复杂的应用，意味着技术本身被「强行」用在了远超其最初设想的场景中，自然会暴露出各种无法预料的安全漏洞</p>
</li>
<li>
<p>对功能的需求不断增强。为了吸引用户，网站的功能变得越来越复杂。一个简单的登录功能，现在会被要求加上「密码恢复」、「用短信登录」、「记住我」等多种选项。每一个新增的功能，都为黑客提供了一个新的潜在攻击点。功能越多，需要保护的地方就越多，防御的难度呈指数级增长</p>
</li>
</ol>
<p>在 Web 应用出现之前，安全防御的重点都放在网络边界上。过去的安全思路很简单：只要防火墙够强，公司的网络就是安全的。而 Web 应用要被用户使用，公司必须在「城墙」上开一个大门（允许 HTTP / HTTPS 流量通过）。而且这个应用为了实现功能，还必须连接到最核心的数据库和后台系统。既然防火墙已经被合法地打穿，那么真正的安全边界就不再是那道「旧城墙」，而是 Web 应用程序本身。应用处理用户输入的每一行代码，都成了新的前线和边界。</p>
<h2 id="第二章"><a class="markdownIt-Anchor" href="#第二章"></a> 第二章</h2>
<p>Web 应用程序大多采用以下三层安全机制来处理用户的访问，对应三个本质性的问题：</p>
<ol>
<li>
<p>身份验证：<em>你是谁？</em></p>
<p>确认一个未知访客的真实身份，并赋予他一个已知的「身份标签」。Web 应用程序会使用「登录」来进行这个操作。你可以输入用户名和密码，或者使用指纹、人脸识别、客户端证书等，系统会去数据库内核对、确认你的身份是合法用户。</p>
</li>
<li>
<p>会话管理：<em>我如何记住你是谁？</em></p>
<p>在无状态的 HTTP 协议上，为用户创建一个持续的、被认可的「登录状态」，避免每次操作都需要重新验证身份的麻烦。当你登录成功后，服务器会给你一个令牌（Token），通常以 Cookie 或者其他形式保存在你的浏览器里。当你每次浏览网站的不同页面、提交不同请求时，浏览器都会自动带上这个令牌。服务器看到这个令牌，就会知道你刚才登录过了、不需要再登录一遍。</p>
</li>
<li>
<p>访问控制：<em>你能做什么？</em></p>
<p>在确认了你的身份并维持了你的登录状态之后，对你的每一次具体操作进行权限检查，确保你只在被允许的范围内活动。例如，你作为一个普通用户只能查看自己的邮件、修改自己的个人资料，但是不能去访问管理员后台、查看其他人的邮件。因为系统的权限设置规定了，普通用户角色不能执行管理员操作，也不能访问不属于自己的数据。</p>
</li>
</ol>
<p>这三层安全机制至关重要，任意一层存在缺陷都可能使攻击者自由访问：</p>
<ol>
<li>如果身份验证有缺陷，那么攻击者可以伪造一张完全合法的通行证，并且拥有被冒充者的所有权限。之后的两层再怎么坚固也没有用</li>
<li>如果会话管理有缺陷，那么攻击者根本不需要去验证身份，他大可以直接去偷或者复制一个通行证、冒充别人在 Web 应用程序里随意执行别人的所有权限</li>
<li>如果访问控制有缺陷，那么攻击者只需要一个最低权限的账户，就能访问整个系统的所有功能和数据</li>
</ol>
<h4 id="身份验证"><a class="markdownIt-Anchor" href="#身份验证"></a> 身份验证</h4>
<p>身份验证是「信任」的起点和基石。它是 Web 应用安全中最基础、最关键，却又最容易被误解和错误实现的部分。</p>
<p>身份验证不是一个非黑即白的东西，它有一个从弱到强的「安全光谱」。选择哪种方式，取决于应用的重要性和它所保护的数据价值。最基础的是用户名 + 密码，适用于绝大多数场景，也是最基础的防线；在「知道密码」的基础上，高价值应用 —— 例如电子银行 —— 会增加「你拥有什么（手机验证码、令牌）」或者「你是什么（指纹、面容 ID）」；政府、军队或者特定企业内部系统会将认证凭证与物理硬件绑定，虽然牺牲了便利性，但是大大提升了破解难度。</p>
<p>不过真正的攻击面并不是这些，而是身份验证机制的支持功能。例如，攻击者可以尝试在注册时，使用包含恶意代码的用户名来注册，从而影响到 Web 应用程序内部；修改密码时如果不要求输入旧密码的话，攻击者可以通过一些方式 —— 像 XSS—— 来劫持用户登陆后的会话、直接修改密码；最值得注意的是账户恢复功能，安全问题是可以通过社交网络查到的、重置令牌不够随机的话就会被预测到、验证码没有次数限制的话就会被暴力破解。</p>
<p>为什么看似简单的登录功能，却是重灾区？这些问题都需要我们考虑到：</p>
<ol>
<li>当用户登录时，返回的错误信息是「用户名不存在」还是「密码错误」？如果是前者，攻击者就可以利用这个功能来枚举出所有的合法用户名，为后续的密码攻击做准备。一个安全的实现应该统一返回「用户名或密码错误」</li>
<li>身份验证流程往往涉及多个步骤和状态。例如，一个需要两步验证的流程，攻击者能否在完成第一步验证后，直接跳过第二步，访问一个需要登录才能访问的页面？这就是逻辑缺陷，攻击者利用了开发者没有周全考虑到的流程漏洞</li>
<li>身份验证机制最终还是要被人使用。系统是否强制用户设置强密码？用户是否会因为密码重用、导致在一个不安全的网站泄露密码，而那个密码又可以用来登录你的高安全应用？</li>
</ol>
<h4 id="会话管理"><a class="markdownIt-Anchor" href="#会话管理"></a> 会话管理</h4>
<p>身份验证只是一瞬间的动作，而会话管理则是在用户登录后的整个访问期间，持续地、安全地记住用户身份的机制。这个机制的命脉完全系于一个叫做「令牌」的东西上，因此，令牌的安全性就等同于整个会话的安全性。</p>
<p>最传统、最常见的会话管理模型是使用 Session：用户登陆成功后，服务器会在自己内部创建一个「档案」，里面存放着该用户的所有状态信息，这个「档案」便是会话。服务器创建了「档案」之后，会生成一个独一无二、极其随机的字符串作为这个「档案」的编号，即令牌。服务器将这个令牌发给用户的浏览器，浏览器通常会将其存到 Cookie 里。之后，用户的浏览器每次向服务器发请求，都会自动带上存有这个令牌的 Cookie。服务器收到请求后，看到令牌，就拿着这个编号去自己的「档案室」里查找对应的「档案」，从而恢复用户的所有状态信息，并处理他们的请求。</p>
<p>问题在于，令牌是维持登录状态的唯一凭证，那么攻击者就不再需要用户的密码，他们只需要想办法得到用户的令牌。手段如下：</p>
<ol>
<li>如果应用程序生成的会话令牌不够随机（例如，只是简单地基于时间戳或用户 ID 进行编码），攻击者就可以分析规律，预测出其他用户的合法令牌，从而冒充他们</li>
<li>窃取令牌的方式有很多：
<ol>
<li>攻击者在页面注入恶意脚本，读取并发送你的 Cookie</li>
<li>如果用户在不安全的公共 Wi-Fi 上访问一个没有使用 HTTPS 的网站，网络中的任何人都可以「偷听」到用户的网络流量，并从中窃取会话 Cookie</li>
<li>攻击者使用了用户未锁屏的电脑</li>
</ol>
</li>
<li>攻击者先访问网站，让服务器生成一个会话令牌。然后他把这个令牌通过链接发给用户（例如 <code>http://网站.后缀/?SESSIONID=...</code>）。用户点击链接后，用自己的账号密码成功登录。如果此时服务器没有为用户<strong>重新生成一个新的、更安全的会话令牌</strong>，那么攻击者预先知道的那个令牌就和用户成功登录的账户绑定了</li>
</ol>
<p>还有其他模型，比方说无状态会话，最典型的代表便是 JWT（JSON Web Token），它的原理是将状态信息保存在客户端而非服务器上。这种方式服务器端开销小、易于扩展；缺点是一旦令牌发出，在它过期之前就很难让它失效。</p>
<h4 id="访问控制"><a class="markdownIt-Anchor" href="#访问控制"></a> 访问控制</h4>
<p>访问控制是安全体系的最后一道、也是最复杂的一道防线。它的复杂性决定了它必然是漏洞的重灾区，因此也成为了攻击者最有价值的攻击目标。</p>
<p>首先，访问控制的定位是「后置检查」，也就是说它仅关心「已登录的用户可以做什么」。为什么访问控制必然复杂？在一个真实的应用中，权限绝对不是简单的「是」或「否」。我们可以将访问控制分为几种类型，每一种都会引入大量复杂的逻辑：</p>
<ol>
<li>
<p>垂直访问控制</p>
<p>基于角色和权限的控制。不同级别的用户能访问的功能完全不同。例如管理员可以访问 <code>/admin/dashboard</code>，而普通用户不能。当角色非常多（超级管理员、区域管理员、编辑、版主、普通用户……）且权限可以灵活组合时，逻辑会变得极其复杂，开发者很容易在某个角色的权限判断上出错。</p>
</li>
<li>
<p>水平访问控制</p>
<p>基于数据所有权的控制。同一角色的用户之间，只能访问属于自己的数据。</p>
<p>这是<strong>最常见、最致命的漏洞来源</strong>。对于每一个需要操作数据的请求（如 <code>GET /orders/101</code>, <code>POST /profiles/202</code>），服务器都<strong>必须</strong>增加一步检查：「当前登录的用户是否是订单 101 的主人？」或「当前登录的用户是否就是用户 202 本人？」。</p>
</li>
<li>
<p>上下文相关的访问控制</p>
<p>权限还依赖于当前的状态或上下文。打个比方，在一个竞拍应用中，只有在竞拍进行中你才能出价。这种逻辑将状态机（State Machine）引入了权限判断，使得代码的判断分支急剧增多。</p>
</li>
</ol>
<p>对于攻击者而言，开发者总是会犯错的。</p>
<p>开发者可能会错误假设：所有用户都会按照设计的流程来。因此在前端界面只给用户显示「编辑我的帖子」按钮，这样用户就不可能去编辑别人的帖子了。但是真实情况是攻击者根本不通过开发者的前端界面、直接捕获点击「编辑我的帖子」时发出的请求，例如 <code>PUT /api/posts/123</code>。然后手动修改请求中的帖子 ID，改成 <code>PUT /api/posts/456</code>（别人的帖子 ID），再重新发送。如果后端开发者相信了前端的「保护」，而忘记在后端 API 上进行所有权检查，那么这次攻击就成功了。这就是经典的 IDOR（Insecure Direct Object Reference，不安全的直接对象引用）漏洞。</p>
<p>也有可能，开发者给 10 个端口添加了检查，却在第 11 个端口忘记这么干了。</p>
<h4 id="输入的多样性和不可信性"><a class="markdownIt-Anchor" href="#输入的多样性和不可信性"></a> 输入的多样性和不可信性</h4>
<p>「用户输入」不单单是用户在表单里填写的内容。像我们先前说的，从安全的角度看，所有从客户端发送到服务器的数据，都是用户输入，都是<strong>不可信</strong>的。这包括：</p>
<ul>
<li>表单字段（用户名、密码、搜索框、评论区）</li>
<li>URL 参数（<code>/product?id=123</code>）、URL 路径（<code>/user/profile/123</code>）</li>
<li>Cookies、User-Agent、Referer 等所有头部信息</li>
<li>服务器端生成，但客户端可修改的数据。这一点很重要，也很容易被开发者忽略。例如，一个隐藏表单字段 <code>&lt;input type="hidden" name="price" value="100"&gt;</code>。开发者以为价格是服务器定的，但攻击者可以轻易地拦截请求，把 <code>100</code> 改成 <code>1</code></li>
</ul>
<p>验证策略必须因地制宜。一些场景该严格就严格，一些则该宽松就宽松。</p>
<p>如何去防御呢？作者给出了五种防御策略：</p>
<ol>
<li>
<p>拒绝已知的不良输入</p>
<p>创建黑名单，禁止任何包含列表中内容的数据通过。</p>
<p>这是最脆弱的方法。理由很简单，黑名单很容易被「绕过」：</p>
<ul>
<li>大小写绕过：<code>SELECT</code> -&gt; <code>SeLeCt</code></li>
<li>等价语句绕过：<code>or 1=1</code> -&gt; <code>or 2=2</code></li>
<li>编码绕过：<code>&lt;</code> -&gt; <code>%3c</code></li>
<li>插入无关字符绕过：<code>SELECT FROM</code> -&gt; <code>SELECT/*foo*/FROM</code></li>
</ul>
<p>黑名单只能作为辅助，永远都不能作为主要的防御手段。它注定会失败，因为你永远无法穷举所有不好的东西。</p>
</li>
<li>
<p>接受已知的正常输入</p>
<p>创建白名单，只允许符合规则的数据通过。</p>
<p>在适用的情况下，这是最强大、最有效的方法。最适用于格式固定的数据，如手机号、邮政编码、产品 ID 等。但是不适用于需要丰富表达的自由文本，如文章评论。</p>
</li>
<li>
<p>净化</p>
<p>不拒绝，也不完全接受，而是对输入进行无害化处理。</p>
<p>一种非常实用和必要的妥协方案，主要处理那些无法使用白名单的自由文本。</p>
<p>较为经典的例子是防止 XSS 攻击。假设用户输入了 <code>&lt;script&gt;alert(1)&lt;/script&gt;</code>。显示前你必须将其进行 HTML 编码，将其转换为无害的文本 <code>&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;</code>。这样浏览器就只会把它当成普通文字显示出来，而不会执行它。</p>
</li>
<li>
<p>安全数据处理</p>
<p>与其检查输入是否「安全」，不如让处理过程本身对「危险」免疫。</p>
<p>最佳实践，从根本上解决特定问题。</p>
<p>经典案例为防止 SQL 注入。与其使用黑名单过滤 <code>SELECT</code>、<code>--</code> 等字符，不如直接使用参数化查询。这种方法将用户输入的数据和 SQL 命令本身完全分离开来，即时用户输入了恶意的 SQL 代码，数据库也只会把它当成普通的字符串数据来处理，而不会执行它。</p>
</li>
<li>
<p>语法检查</p>
<p>检查输入的业务含义是否合法，而不仅仅是格式。</p>
<p>比方说，用户修改购物车商品数量，他提交的请求 <code>product_id=101&amp;quantity=-1</code>。从语法上来看，<code>-1</code> 是一个有效的整数，但从业务逻辑上看，数量不能为负数。另一个例子是，用户 A 尝试访问 <code>order_id=102</code>，虽然 <code>102</code> 是合法的订单号格式，但这个订单属于用户 B，所以这也是非法的。</p>
</li>
</ol>
<p>很多初学者会犯的错误是，在应用的最外层写一个「超级过滤器」，试图把所有「坏」东西都挡在门外。作者解释道，这种一刀切的入口过滤是无效的。数据在系统内部流动和转换时会产生新的风险，所以必须在每个处理环节进行针对性的验证。</p>
<p>例如</p>
</body></html></div></article></div></main><footer><div class="paginator"><a class="next" href="b52f.html">下一篇</a></div><div class="copyright"><p>© 2022 - 2025 <a href="https://cytrogen.icu">Cytrogen</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/cytrogen/hexo-theme-ares" target="_blank">hexo-theme-ares</a>.</p></div></footer></div></div><a class="back-to-top" href="#top" aria-label="返回顶部"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M3.293 9.707a1 1 0 010-1.414L9.586 2a2 2 0 012.828 0l6.293 6.293a1 1 0 01-1.414 1.414L11 3.414V17a1 1 0 11-2 0V3.414L2.707 9.707a1 1 0 01-1.414 0z"></path></svg></a><script>document.addEventListener('DOMContentLoaded', function() {
  const codeBlocks = document.querySelectorAll('figure.highlight');
  
  codeBlocks.forEach(block => {
    let caption = block.querySelector('figcaption');
    if (!caption) {
      caption = document.createElement('figcaption');
      block.insertBefore(caption, block.firstChild);
    }

    const info = document.createElement('div');
    info.className = 'info';
    
    const filename = caption.querySelector('span');
    if (filename) {
      filename.className = 'filename';
      info.appendChild(filename);
    }
    
    const lang = block.className.split(' ')[1];
    if (lang) {
      const langSpan = document.createElement('span');
      langSpan.className = 'lang-name';
      langSpan.textContent = lang;
      info.appendChild(langSpan);
    }

    const sourceLink = caption.querySelector('a');
    if (sourceLink) {
      sourceLink.className = 'source-link';
      info.appendChild(sourceLink);
    }

    const actions = document.createElement('div');
    actions.className = 'actions';

    const codeHeight = block.scrollHeight;
    const threshold = 300;

    if (codeHeight > threshold) {
      block.classList.add('folded');
      
      const toggleBtn = document.createElement('button');
      toggleBtn.textContent = '展开';
      toggleBtn.addEventListener('click', () => {
        block.classList.toggle('folded');
        toggleBtn.textContent = block.classList.contains('folded') ? '展开' : '折叠';
      });
      actions.appendChild(toggleBtn);
    }

    const copyBtn = document.createElement('button');
    copyBtn.textContent = '复制';
    copyBtn.addEventListener('click', async () => {
      const codeLines = block.querySelectorAll('.code .line');
      const code = Array.from(codeLines)
        .map(line => line.textContent)
        .join('\n')
        .replace(/\n\n/g, '\n');
      
      try {
        await navigator.clipboard.writeText(code);
        copyBtn.textContent = '已复制';
        copyBtn.classList.add('copied');
        
        setTimeout(() => {
          copyBtn.textContent = '复制';
          copyBtn.classList.remove('copied');
        }, 3000);
      } catch (err) {
        console.error('复制失败:', err);
        copyBtn.textContent = '复制失败';
        
        setTimeout(() => {
          copyBtn.textContent = '复制';
        }, 3000);
      }
    });
    actions.appendChild(copyBtn);

    caption.innerHTML = '';
    caption.appendChild(info);
    caption.appendChild(actions);

    const markedLines = block.getAttribute('data-marked-lines');
    if (markedLines) {
      const lines = markedLines.split(',');
      lines.forEach(range => {
        if (range.includes('-')) {
          const [start, end] = range.split('-').map(Number);
          for (let i = start; i <= end; i++) {
            const line = block.querySelector(`.line-${i}`);
            if (line) line.classList.add('marked');
          }
        } else {
          const line = block.querySelector(`.line-${range}`);
          if (line) line.classList.add('marked');
        }
      });
    }
  });
});</script><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-4PVPZXE0QQ"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-4PVPZXE0QQ');</script><script>(function() {
  // Wait for DOM to be ready
  document.addEventListener('DOMContentLoaded', function() {
    const themeToggle = document.querySelector('.theme-toggle');
    
    if (!themeToggle) return;
    
    // Get current theme
    const getCurrentTheme = () => {
      return document.documentElement.getAttribute('data-theme') || 'light';
    };
    
    // Update UI to match current theme
    const updateUI = (theme) => {
      const isDark = theme === 'dark';
      themeToggle.setAttribute('aria-pressed', isDark.toString());
    };
    
    // Simplified theme setter - CSS handles all animations
    const setTheme = (theme) => {
      document.documentElement.setAttribute('data-theme', theme);
      document.documentElement.style.colorScheme = theme; // Update native UI elements
      
      // Also update page-wrapper for animation support
      const pageWrapper = document.getElementById('page-wrapper');
      if (pageWrapper) {
        pageWrapper.setAttribute('data-theme', theme);
      }
      
      // Find and remove the temporary anti-flicker style tag if it exists.
      // This ensures the main stylesheet takes full control after the initial load.
      const antiFlickerStyle = document.getElementById('anti-flicker-style');
      if (antiFlickerStyle) {
        antiFlickerStyle.remove();
      }
      
      localStorage.setItem('theme', theme);
      updateUI(theme);
    };
    
    // Simple theme toggle - letting CSS handle the smooth transitions
    const toggleTheme = () => {
      const current = getCurrentTheme();
      const newTheme = current === 'light' ? 'dark' : 'light';
      setTheme(newTheme);
    };
    
    // Initialize UI on page load
    updateUI(getCurrentTheme());
    
    // Add click event listener
    themeToggle.addEventListener('click', toggleTheme);
    
    // Listen for system theme changes
    if (window.matchMedia) {
      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
      mediaQuery.addEventListener('change', function(e) {
        // Only update if no manual preference is saved
        if (!localStorage.getItem('theme')) {
          const theme = e.matches ? 'dark' : 'light';
          setTheme(theme);
        }
      });
    }
  });
})();
</script><script>(function() {
  document.addEventListener('DOMContentLoaded', function() {
    const backToTopBtn = document.querySelector('.back-to-top');
    
    if (!backToTopBtn) return;
    
    // Show/hide button based on scroll position
    const toggleButtonVisibility = () => {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const shouldShow = scrollTop > 200; // Show after scrolling 200px
      
      if (shouldShow) {
        backToTopBtn.classList.add('is-visible');
      } else {
        backToTopBtn.classList.remove('is-visible');
      }
    };
    
    // Throttle scroll events for better performance
    let ticking = false;
    const handleScroll = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          toggleButtonVisibility();
          ticking = false;
        });
        ticking = true;
      }
    };
    
    // Smooth scroll to top when clicked
    const scrollToTop = (event) => {
      event.preventDefault();
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    };
    
    // Add event listeners
    window.addEventListener('scroll', handleScroll);
    backToTopBtn.addEventListener('click', scrollToTop);
    
    // Check initial scroll position
    toggleButtonVisibility();
  });
})();</script></body></html>