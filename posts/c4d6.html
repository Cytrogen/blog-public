<!DOCTYPE html><html lang="zh" data-theme="dark"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>ç”¨ JavaScript è‡ªåˆ¶ GameBoy æ¨¡æ‹Ÿå™¨ï¼ˆä¸‹ï¼‰ Â· Cytrogen çš„ä¸ªäººåšå®¢</title><meta name="robots" content="noindex"><meta name="description" content="åœ¨ä¸Šç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ„å»ºäº† GameBoy æ¨¡æ‹Ÿå™¨çš„åŸºç¡€æ¶æ„ï¼ŒåŒ…æ‹¬ CPU æŒ‡ä»¤å¤„ç†ã€å†…å­˜ç®¡ç†ã€GPU æ—¶åºå’Œå›¾å½¢æ¸²æŸ“ç³»ç»Ÿã€‚è™½ç„¶æˆ‘ä»¬çš„æ¨¡æ‹Ÿå™¨èƒ½å¤Ÿæ˜¾ç¤ºå›¾åƒï¼Œä½†è¿˜æ— æ³•ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚è¿™ç¯‡æ–‡ç« å°†ç»§ç»­å®Œå–„è¯¥æ¨¡æ‹Ÿå™¨ã€‚"><link rel="icon" href="../favicon.png"><link rel="canonical" href="https://cytrogen.icu/posts/c4d6.html"><link rel="webmention" href="https://webmention.io/cytrogen.icu/webmention"><link rel="me" href="https://m.otter.homes/@Cytrogen"><meta name="fediverse:creator" content="@Cytrogen@m.otter.homes"><link rel="preload" href="../fonts/opensans-regular-latin.woff2" as="font" type="font/woff2" crossorigin="anonymous"><style>@font-face {
  font-family: 'Open Sans';
  src: url('../fonts/opensans-regular-latin.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
  size-adjust: 107%;
  ascent-override: 97%;
  descent-override: 25%;
  line-gap-override: 0%;
}
</style><script>(function() {
  try {
    // ä¼˜å…ˆçº§ï¼šç”¨æˆ·é€‰æ‹© > ç³»ç»Ÿåå¥½ > é»˜è®¤æµ…è‰²
    const saved = localStorage.getItem('theme');
    const theme = saved || 
      (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    
    document.documentElement.setAttribute('data-theme', theme);
    document.documentElement.style.colorScheme = theme;
  } catch (error) {
    // å¤±è´¥æ—¶ä½¿ç”¨é»˜è®¤ä¸»é¢˜ï¼Œä¸é˜»å¡æ¸²æŸ“
    document.documentElement.setAttribute('data-theme', 'light');
  }
})();
</script><link rel="stylesheet" href="../css/ares.css"><script data-netlify-skip-bundle="true">(function() {
  document.addEventListener('DOMContentLoaded', function() {
    const theme = document.documentElement.getAttribute('data-theme');
    const pageWrapper = document.getElementById('page-wrapper');
    if (pageWrapper && theme) {
      pageWrapper.setAttribute('data-theme', theme);
    }
  });
})();

</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="atom.xml" title="Cytrogen çš„ä¸ªäººåšå®¢" type="application/atom+xml">
</head><body><div id="page-wrapper"><a class="skip-link" href="#main-content">è·³åˆ°ä¸»è¦å†…å®¹</a><div class="wrap"><header><a class="logo-link" href="../index.html"><img src="../favicon.png" alt="logo"></a><nav class="site-nav"><div class="nav-main"><div class="nav-primary"><ul class="nav-list hidden-mobile"><li class="nav-item"><a class="nav-link" href="../index.html">é¦–é¡µ</a></li></ul><div class="nav-tools"><div class="language-menu"><button class="language-toggle" type="button"><svg class="icon icon-globe" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" focusable="false"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4a9.267 9.267 0 0 1 .64-1.539 6.7 6.7 0 0 1 .597-.933A7.025 7.025 0 0 0 2.255 4H4.09zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a6.958 6.958 0 0 0-.656 2.5h2.49zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5H4.847zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5H4.51zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12c.138.386.295.744.468 1.068.552 1.035 1.218 1.65 1.887 1.855V12H5.145zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11a13.652 13.652 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5H3.82zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855A7.97 7.97 0 0 0 10.855 12H8.5zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5a6.959 6.959 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5h2.49zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4a7.966 7.966 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4h2.355z"></path></svg><span>ä¸­æ–‡</span></button><div class="language-dropdown"></div></div></div><div class="nav-controls"><div class="more-menu hidden-mobile"><button class="more-toggle" type="button"><span>æ›´å¤š</span><svg class="icon icon-chevron-down" width="12" height="12" viewBox="0 0 12 12" fill="currentColor" aria-hidden="true" focusable="false"><path d="M6 8.825c-.2 0-.4-.1-.5-.2l-3.3-3.3c-.3-.3-.3-.8 0-1.1s.8-.3 1.1 0l2.7 2.7 2.7-2.7c.3-.3.8-.3 1.1 0s.3.8 0 1.1l-3.3 3.3c-.1.1-.3.2-.5.2z"></path></svg></button><div class="more-dropdown"><ul class="dropdown-list"><li class="dropdown-item"><a class="nav-link" href="../archives/index.html">å½’æ¡£</a></li><li class="dropdown-item"><a class="nav-link" href="../categories/index.html">åˆ†ç±»</a></li><li class="dropdown-item"><a class="nav-link" href="../tags/index.html">æ ‡ç­¾</a></li><li class="dropdown-item"><a class="nav-link" href="../about/index.html">å…³äº</a></li><li class="dropdown-item"><a class="nav-link" href="../friends/index.html">å‹é“¾</a></li><li class="dropdown-item"><a class="nav-link" href="../atom.xml">RSSè®¢é˜…</a></li><li class="dropdown-item"><a class="dropdown-link" href="https://github.com/cytrogen" target="_blank" rel="noopener noreferrer me">GitHub<svg class="icon icon-external-link" width="14" height="14" viewBox="0 0 14 14" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8.636 2.364A1 1 0 0 1 10 1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V3.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 2H9a1 1 0 0 1-1.364-1.636zM2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 1 1 2 0v3a3 3 0 0 1-3 3H2a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3h3a1 1 0 1 1 0 2H2z"></path></svg></a></li><li class="dropdown-item"><a class="dropdown-link" href="https://portfolio.cytrogen.icu" target="_blank" rel="noopener noreferrer">ä½œå“é›†<svg class="icon icon-external-link" width="14" height="14" viewBox="0 0 14 14" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8.636 2.364A1 1 0 0 1 10 1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V3.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 2H9a1 1 0 0 1-1.364-1.636zM2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 1 1 2 0v3a3 3 0 0 1-3 3H2a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3h3a1 1 0 1 1 0 2H2z"></path></svg></a></li></ul></div></div><div class="theme-switcher"><button class="theme-toggle" type="button" role="switch" aria-pressed="false" aria-label="åˆ‡æ¢ä¸»é¢˜"><div class="theme-icon moon-icon"><svg class="icon icon-moon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" focusable="false"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path></svg></div><div class="theme-icon sun-icon"><svg class="icon icon-sun" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></svg></div></button></div><details class="mobile-menu-details hidden-desktop"><summary class="hamburger-menu" aria-label="nav.menu"><svg class="icon icon-bars" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" focusable="false"><path d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"></path></svg><span class="menu-text">nav.menu</span></summary><div class="mobile-menu-dropdown"><ul class="mobile-nav-list"><li class="mobile-nav-item"><a class="mobile-nav-link" href="../index.html">é¦–é¡µ</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../archives/index.html">å½’æ¡£</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../categories/index.html">åˆ†ç±»</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../tags/index.html">æ ‡ç­¾</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../about/index.html">å…³äº</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../friends/index.html">å‹é“¾</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../atom.xml">RSSè®¢é˜…</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="https://github.com/cytrogen" target="_blank" rel="noopener noreferrer me">GitHub<svg class="icon icon-external-link" width="14" height="14" viewBox="0 0 14 14" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8.636 2.364A1 1 0 0 1 10 1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V3.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 2H9a1 1 0 0 1-1.364-1.636zM2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 1 1 2 0v3a3 3 0 0 1-3 3H2a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3h3a1 1 0 1 1 0 2H2z"></path></svg></a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="https://portfolio.cytrogen.icu" target="_blank" rel="noopener noreferrer">ä½œå“é›†<svg class="icon icon-external-link" width="14" height="14" viewBox="0 0 14 14" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8.636 2.364A1 1 0 0 1 10 1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V3.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 2H9a1 1 0 0 1-1.364-1.636zM2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 1 1 2 0v3a3 3 0 0 1-3 3H2a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3h3a1 1 0 1 1 0 2H2z"></path></svg></a></li></ul></div></details></div></div></div></nav></header><main class="container" id="main-content" tabindex="-1"><div class="post"><article class="post-block"><h1 class="post-title">ç”¨ JavaScript è‡ªåˆ¶ GameBoy æ¨¡æ‹Ÿå™¨ï¼ˆä¸‹ï¼‰</h1><div class="post-info"><time class="post-date dt-published" datetime="2025-07-05T04:00:00.000Z">7/5/2025</time></div><div class="post-content"><html><head></head><body><p>åœ¨ <a href="/posts/4148/">ä¸Šç¯‡æ–‡ç« </a> ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ„å»ºäº† GameBoy æ¨¡æ‹Ÿå™¨çš„åŸºç¡€æ¶æ„ï¼ŒåŒ…æ‹¬ CPU æŒ‡ä»¤å¤„ç†ã€å†…å­˜ç®¡ç†ã€GPU æ—¶åºå’Œå›¾å½¢æ¸²æŸ“ç³»ç»Ÿã€‚è™½ç„¶æˆ‘ä»¬çš„æ¨¡æ‹Ÿå™¨èƒ½å¤Ÿæ˜¾ç¤ºå›¾åƒï¼Œä½†è¿˜æ— æ³•ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚è¿™ç¯‡æ–‡ç« å°†ç»§ç»­å®Œå–„è¯¥æ¨¡æ‹Ÿå™¨ã€‚</p>
<span id="more"></span>
<h1 id="6-è¾“å…¥ç³»ç»Ÿè®©ç©å®¶ä¸æ¸¸æˆäº¤äº’"><a class="markdownIt-Anchor" href="#6-è¾“å…¥ç³»ç»Ÿè®©ç©å®¶ä¸æ¸¸æˆäº¤äº’"></a> 6. è¾“å…¥ç³»ç»Ÿï¼šè®©ç©å®¶ä¸æ¸¸æˆäº¤äº’</h1>
<p>ä¸ç°ä»£æ¸¸æˆæ‰‹æŸ„å¤æ‚çš„æŒ‰é”®å¸ƒå±€ä¸åŒï¼ŒGameBoy çš„è¾“å…¥ç³»ç»Ÿç›¸å¯¹ç®€å•ä½†éå¸¸å·§å¦™ã€‚å®ƒåªæœ‰ 8 ä¸ªæŒ‰é”®ï¼Œä½†é€šè¿‡çŸ©é˜µå¼çš„ç¡¬ä»¶è®¾è®¡ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°æ£€æµ‹ä»»æ„ç»„åˆçš„æŒ‰é”®çŠ¶æ€ã€‚</p>
<h2 id="61-gameboy-è¾“å…¥ç¡¬ä»¶åŸç†"><a class="markdownIt-Anchor" href="#61-gameboy-è¾“å…¥ç¡¬ä»¶åŸç†"></a> 6.1. GameBoy è¾“å…¥ç¡¬ä»¶åŸç†</h2>
<p>GameBoy çš„ 8 ä¸ªæŒ‰é”®è¢«ç»„ç»‡ä¸ºä¸€ä¸ª 2 åˆ— Ã— 4 è¡Œçš„çŸ©é˜µï¼š</p>
<table>
<thead>
<tr>
<th>åˆ— 1ï¼ˆåŠŸèƒ½é”®ï¼‰</th>
<th>åˆ— 2ï¼ˆæ–¹å‘é”®ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>A æŒ‰é”®</td>
<td>å³æ–¹å‘é”®</td>
</tr>
<tr>
<td>B æŒ‰é”®</td>
<td>å·¦æ–¹å‘é”®</td>
</tr>
<tr>
<td>Select</td>
<td>ä¸Šæ–¹å‘é”®</td>
</tr>
<tr>
<td>Start</td>
<td>ä¸‹æ–¹å‘é”®</td>
</tr>
</tbody>
</table>
<p>è¿™ç§çŸ©é˜µè®¾è®¡çš„å·¥ä½œåŸç†ç±»ä¼¼äºé”®ç›˜æ‰«æï¼š</p>
<ol>
<li>
<p><strong>åˆ—é€‰æ‹©</strong>ï¼šCPU é€šè¿‡å†™å…¥ <code>0xFF00</code> å¯„å­˜å™¨çš„ç¬¬ 4ã€5 ä½æ¥é€‰æ‹©è¦æ‰«æçš„åˆ—</p>
<ul>
<li>å†™å…¥ <code>0x10</code> é€‰æ‹©åˆ— 1ï¼ˆåŠŸèƒ½é”®ï¼‰</li>
<li>å†™å…¥ <code>0x20</code> é€‰æ‹©åˆ— 2ï¼ˆæ–¹å‘é”®ï¼‰</li>
</ul>
</li>
<li>
<p><strong>è¡Œè¯»å–</strong>ï¼šé€‰æ‹©åˆ—åï¼ŒCPU è¯»å– <code>0xFF00</code> å¯„å­˜å™¨çš„ä½ 4 ä½ï¼Œè·å–è¯¥åˆ—ä¸­å„è¡Œçš„æŒ‰é”®çŠ¶æ€</p>
</li>
<li>
<p><strong>çŠ¶æ€åè½¬</strong>ï¼šç¡¬ä»¶ä½¿ç”¨åè½¬é€»è¾‘ï¼Œå³ <em>æœªæŒ‰ä¸‹ = 1ï¼ŒæŒ‰ä¸‹ = 0</em></p>
</li>
</ol>
<blockquote>
<p>ä¸ºä»€ä¹ˆç”¨çŸ©é˜µï¼Ÿ</p>
<p>å¦‚æœç›´æ¥ä¸ºæ¯ä¸ªæŒ‰é”®åˆ†é…ä¸€ä½ï¼Œéœ€è¦ 8 ä½ã€‚ä½†ç”¨ 2Ã—4 çŸ©é˜µåªéœ€è¦ 6 æ ¹çº¿ï¼ˆ2 åˆ— + 4 è¡Œï¼‰ï¼ŒèŠ‚çœäº†ç¡¬ä»¶æˆæœ¬ã€‚</p>
<p>è¿™åœ¨ 1989 å¹´æ˜¯å¾ˆé‡è¦çš„ä¼˜åŒ–ï¼Œæ¯å‡å°‘ä¸€æ ¹çº¿éƒ½èƒ½é™ä½æˆæœ¬ã€‚</p>
</blockquote>
<h2 id="62-è¾“å…¥æ§åˆ¶å™¨å®ç°"><a class="markdownIt-Anchor" href="#62-è¾“å…¥æ§åˆ¶å™¨å®ç°"></a> 6.2. è¾“å…¥æ§åˆ¶å™¨å®ç°</h2>
<p>åœ¨å®ç°è¾“å…¥æ§åˆ¶å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®¾è®¡å®Œæ•´çš„å¸¸é‡ä½“ç³»å’Œæ¶æ„ã€‚GameBoy çš„è¾“å…¥ç³»ç»Ÿè™½ç„¶ç®€å•ï¼Œä½†éœ€è¦ç²¾ç¡®çš„ä½æ“ä½œå’ŒçŠ¶æ€ç®¡ç†ã€‚</p>
<p>è¾“å…¥ç³»ç»Ÿçš„æ‰€æœ‰é­”æ³•æ•°å­—éƒ½éœ€è¦æ˜ç¡®çš„å¸¸é‡å®šä¹‰ï¼š</p>
<figure class="highlight javascript"><figcaption><span>input.JS</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¾“å…¥å¸¸é‡å®šä¹‰ - æ¯ä¸ªæ•°å€¼éƒ½æœ‰å…¶ç¡¬ä»¶æ„ä¹‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">INPUT_CONSTANTS</span> = {</span><br><span class="line">  <span class="comment">// å¯„å­˜å™¨åœ°å€</span></span><br><span class="line">  <span class="attr">JOYPAD_REGISTER</span>: <span class="number">0xFF00</span>,        <span class="comment">// GameBoyè¾“å…¥å¯„å­˜å™¨çš„å†…å­˜åœ°å€</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ—é€‰æ‹©ä½æ©ç  - æ§åˆ¶æ‰«æå“ªä¸€åˆ—æŒ‰é”®</span></span><br><span class="line">  <span class="attr">COLUMN_SELECT_MASK</span>: <span class="number">0x30</span>,       <span class="comment">// äºŒè¿›åˆ¶: 00110000 - æå–ç¬¬4ã€5ä½</span></span><br><span class="line">  <span class="attr">COLUMN_1_SELECT</span>: <span class="number">0x10</span>,          <span class="comment">// äºŒè¿›åˆ¶: 00010000 - é€‰æ‹©åŠŸèƒ½é”®åˆ—</span></span><br><span class="line">  <span class="attr">COLUMN_2_SELECT</span>: <span class="number">0x20</span>,          <span class="comment">// äºŒè¿›åˆ¶: 00100000 - é€‰æ‹©æ–¹å‘é”®åˆ—</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¡ŒçŠ¶æ€ä½æ©ç  - å„è¡ŒæŒ‰é”®çš„çŠ¶æ€</span></span><br><span class="line">  <span class="attr">ROW_MASK</span>: <span class="number">0x0F</span>,                 <span class="comment">// äºŒè¿›åˆ¶: 00001111 - æå–ä½4ä½è¡ŒçŠ¶æ€</span></span><br><span class="line">  <span class="attr">ROW_0</span>: <span class="number">0x01</span>, <span class="attr">ROW_1</span>: <span class="number">0x02</span>,       <span class="comment">// ç¬¬0ã€1è¡Œ</span></span><br><span class="line">  <span class="attr">ROW_2</span>: <span class="number">0x04</span>, <span class="attr">ROW_3</span>: <span class="number">0x08</span>,       <span class="comment">// ç¬¬2ã€3è¡Œ</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// é»˜è®¤çŠ¶æ€ï¼šæ‰€æœ‰æŒ‰é”®æœªæŒ‰ä¸‹</span></span><br><span class="line">  <span class="attr">DEFAULT_ROW_STATE</span>: <span class="number">0x0F</span>         <span class="comment">// æ‰€æœ‰è¡Œä¸ºé«˜ç”µå¹³ï¼ˆæœªæŒ‰ä¸‹çŠ¶æ€ï¼‰</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>é¦–å…ˆåˆ›å»ºè¾“å…¥æ§åˆ¶å™¨çš„æ ¸å¿ƒç±»ï¼š</p>
<figure class="highlight javascript"><figcaption><span>input.JS</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * GameBoy è¾“å…¥æ§åˆ¶å™¨</span></span><br><span class="line"><span class="comment"> * ç®¡ç†é”®ç›˜è¾“å…¥çŸ©é˜µå’Œå¯„å­˜å™¨äº¤äº’</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameBoyInputController</span> {</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initializeInputMatrix</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initializeKeyMapping</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initializeEventListeners</span>();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åˆå§‹åŒ–è¾“å…¥çŸ©é˜µ</span></span><br><span class="line"><span class="comment">   * 2 åˆ— Ã— 4 è¡Œçš„æŒ‰é”®çŸ©é˜µï¼Œæ¯åˆ—ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤º</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">initializeInputMatrix</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="comment">// æŒ‰é”®çŠ¶æ€çŸ©é˜µï¼š[åˆ—1, åˆ—2]</span></span><br><span class="line">    <span class="comment">// æ¯åˆ— 4 ä½ï¼Œæ¯ä½ä»£è¡¨ä¸€è¡Œçš„çŠ¶æ€</span></span><br><span class="line">    <span class="comment">// 0 = æŒ‰é”®æŒ‰ä¸‹ï¼Œ1 = æŒ‰é”®æœªæŒ‰ä¸‹</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">keyMatrix</span> = [</span><br><span class="line">      <span class="variable constant_">INPUT_CONSTANTS</span>.<span class="property">DEFAULT_ROW_STATE</span>, <span class="comment">// åˆ—1ï¼šåŠŸèƒ½é”®åˆ—</span></span><br><span class="line">      <span class="variable constant_">INPUT_CONSTANTS</span>.<span class="property">DEFAULT_ROW_STATE</span>  <span class="comment">// åˆ—2ï¼šæ–¹å‘é”®åˆ—</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“å‰é€‰æ‹©çš„åˆ—</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">selectedColumn</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒ‰é”®çŠ¶æ€ç¼“å­˜ï¼ˆç”¨äºè°ƒè¯•ï¼‰</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">pressedKeys</span> = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>æŒ‰é”®æ˜ å°„å®šä¹‰äº† JavaScript é”®ç åˆ° GameBoy æŒ‰é”®çš„å¯¹åº”å…³ç³»ï¼š</p>
<figure class="highlight javascript"><figcaption><span>input.JS</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŒ‰é”®æ˜ å°„å¸¸é‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">KEY_MAPPING</span> = {</span><br><span class="line">  <span class="comment">// åŠŸèƒ½é”®ï¼ˆåˆ—1ï¼‰</span></span><br><span class="line">  <span class="attr">A_BUTTON</span>: { <span class="attr">column</span>: <span class="number">0</span>, <span class="attr">row</span>: <span class="number">0</span>, <span class="attr">keyCode</span>: <span class="number">90</span>, <span class="attr">name</span>: <span class="string">'A'</span>, <span class="attr">key</span>: <span class="string">'Z'</span> },        <span class="comment">// Zé”®</span></span><br><span class="line">  <span class="attr">B_BUTTON</span>: { <span class="attr">column</span>: <span class="number">0</span>, <span class="attr">row</span>: <span class="number">1</span>, <span class="attr">keyCode</span>: <span class="number">88</span>, <span class="attr">name</span>: <span class="string">'B'</span>, <span class="attr">key</span>: <span class="string">'X'</span> },        <span class="comment">// Xé”®</span></span><br><span class="line">  <span class="attr">SELECT</span>: { <span class="attr">column</span>: <span class="number">0</span>, <span class="attr">row</span>: <span class="number">2</span>, <span class="attr">keyCode</span>: <span class="number">32</span>, <span class="attr">name</span>: <span class="string">'Select'</span>, <span class="attr">key</span>: <span class="string">'Space'</span> }, <span class="comment">// ç©ºæ ¼é”®</span></span><br><span class="line">  <span class="attr">START</span>: { <span class="attr">column</span>: <span class="number">0</span>, <span class="attr">row</span>: <span class="number">3</span>, <span class="attr">keyCode</span>: <span class="number">13</span>, <span class="attr">name</span>: <span class="string">'Start'</span>, <span class="attr">key</span>: <span class="string">'Enter'</span> },   <span class="comment">// å›è½¦é”®</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ–¹å‘é”®ï¼ˆåˆ—2ï¼‰</span></span><br><span class="line">  <span class="attr">RIGHT</span>: { <span class="attr">column</span>: <span class="number">1</span>, <span class="attr">row</span>: <span class="number">0</span>, <span class="attr">keyCode</span>: <span class="number">39</span>, <span class="attr">name</span>: <span class="string">'Right'</span>, <span class="attr">key</span>: <span class="string">'â†’'</span> },       <span class="comment">// å³ç®­å¤´</span></span><br><span class="line">  <span class="attr">LEFT</span>: { <span class="attr">column</span>: <span class="number">1</span>, <span class="attr">row</span>: <span class="number">1</span>, <span class="attr">keyCode</span>: <span class="number">37</span>, <span class="attr">name</span>: <span class="string">'Left'</span>, <span class="attr">key</span>: <span class="string">'â†'</span> },         <span class="comment">// å·¦ç®­å¤´</span></span><br><span class="line">  <span class="attr">UP</span>: { <span class="attr">column</span>: <span class="number">1</span>, <span class="attr">row</span>: <span class="number">2</span>, <span class="attr">keyCode</span>: <span class="number">38</span>, <span class="attr">name</span>: <span class="string">'Up'</span>, <span class="attr">key</span>: <span class="string">'â†‘'</span> },             <span class="comment">// ä¸Šç®­å¤´</span></span><br><span class="line">  <span class="attr">DOWN</span>: { <span class="attr">column</span>: <span class="number">1</span>, <span class="attr">row</span>: <span class="number">3</span>, <span class="attr">keyCode</span>: <span class="number">40</span>, <span class="attr">name</span>: <span class="string">'Down'</span>, <span class="attr">key</span>: <span class="string">'â†“'</span> }          <span class="comment">// ä¸‹ç®­å¤´</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™ä¸ªæ˜ å°„è¡¨çš„è®¾è®¡è€ƒè™‘äº†å‡ ä¸ªé‡è¦å› ç´ ï¼š</p>
<ul>
<li><strong>äººä½“å·¥ç¨‹å­¦</strong>ï¼šA/B é”®æ”¾åœ¨å·¦æ‰‹ä½ç½®ï¼ˆZ/Xï¼‰ï¼Œæ–¹å‘é”®ç”¨æ ‡å‡†ç®­å¤´</li>
<li><strong>é¿å…å†²çª</strong>ï¼šé¿å¼€å¸¸ç”¨çš„ç½‘é¡µå¿«æ·é”®ï¼ˆå¦‚ Ctrl + C ç­‰ï¼‰</li>
<li><strong>æ˜“äºè®°å¿†</strong>ï¼šåŠŸèƒ½é”®é›†ä¸­ï¼Œæ–¹å‘é”®ç›´è§‚</li>
</ul>
<p>è¾“å…¥æ§åˆ¶å™¨éœ€è¦å°†æµè§ˆå™¨çš„é”®ç›˜äº‹ä»¶è½¬æ¢ä¸º GameBoy æ ¼å¼ï¼š</p>
<figure class="highlight javascript"><figcaption><span>input.JS</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–é”®ç›˜äº‹ä»¶ç›‘å¬</span></span><br><span class="line"><span class="comment"> * å»ºç«‹æµè§ˆå™¨äº‹ä»¶ä¸GameBoyè¾“å…¥ç³»ç»Ÿçš„æ¡¥æ¢</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">initializeKeyMapping</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="comment">// åˆ›å»ºkeyCodeåˆ°æŒ‰é”®ä¿¡æ¯çš„å¿«é€ŸæŸ¥æ‰¾è¡¨</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">keyCodeMap</span> = {};</span><br><span class="line">  </span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">values</span>(<span class="variable constant_">KEY_MAPPING</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">keyInfo</span> =&gt;</span> {</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">keyCodeMap</span>[keyInfo.<span class="property">keyCode</span>] = keyInfo;</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'ğŸ—ï¸ æŒ‰é”®æ˜ å°„å·²åˆå§‹åŒ–'</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">initializeEventListeners</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="comment">// ç»‘å®šå…¨å±€é”®ç›˜äº‹ä»¶</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">'keydown'</span>, <span class="variable language_">this</span>.<span class="property">handleKeyDown</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">'keyup'</span>, <span class="variable language_">this</span>.<span class="property">handleKeyUp</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// é˜²æ­¢ç®­å¤´é”®ç­‰æŒ‰é”®çš„é»˜è®¤è¡Œä¸ºï¼ˆå¦‚é¡µé¢æ»šåŠ¨ï¼‰</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">'keydown'</span>, <span class="variable language_">this</span>.<span class="property">preventDefaultKeys</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>é”®ç›˜äº‹ä»¶å¤„ç†æ˜¯è¾“å…¥ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œéœ€è¦æ­£ç¡®å®ç°çŠ¶æ€åè½¬é€»è¾‘ï¼š</p>
<figure class="highlight javascript"><figcaption><span>input.JS</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†æŒ‰é”®æŒ‰ä¸‹äº‹ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">handleKeyDown</span>(<span class="params">event</span>) {</span><br><span class="line">  <span class="keyword">const</span> keyInfo = <span class="variable language_">this</span>.<span class="property">keyCodeMap</span>[event.<span class="property">keyCode</span>];</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (!keyInfo || <span class="variable language_">this</span>.<span class="property">pressedKeys</span>.<span class="title function_">has</span>(event.<span class="property">keyCode</span>)) {</span><br><span class="line">    <span class="keyword">return</span>; <span class="comment">// ä¸æ˜¯æˆ‘ä»¬å…³å¿ƒçš„æŒ‰é”®æˆ–é‡å¤æŒ‰é”®</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®°å½•æŒ‰é”®çŠ¶æ€</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pressedKeys</span>.<span class="title function_">add</span>(event.<span class="property">keyCode</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ›´æ–°çŸ©é˜µçŠ¶æ€ï¼šæŒ‰ä¸‹æ—¶å¯¹åº”ä½è®¾ä¸º 0</span></span><br><span class="line">  <span class="keyword">const</span> rowMask = ~(<span class="number">1</span> &lt;&lt; keyInfo.<span class="property">row</span>); <span class="comment">// åˆ›å»ºæ©ç ï¼Œå¯¹åº”ä½ä¸º0</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">keyMatrix</span>[keyInfo.<span class="property">column</span>] &amp;= rowMask;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">DEBUG_MODE</span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ğŸ¯ æŒ‰é”®æŒ‰ä¸‹: <span class="subst">${keyInfo.name}</span> - åˆ—<span class="subst">${keyInfo.column}</span>è¡Œ<span class="subst">${keyInfo.row}</span>`</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†æŒ‰é”®é‡Šæ”¾äº‹ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">handleKeyUp</span>(<span class="params">event</span>) {</span><br><span class="line">  <span class="keyword">const</span> keyInfo = <span class="variable language_">this</span>.<span class="property">keyCodeMap</span>[event.<span class="property">keyCode</span>];</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (!keyInfo || !<span class="variable language_">this</span>.<span class="property">pressedKeys</span>.<span class="title function_">has</span>(event.<span class="property">keyCode</span>)) {</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç§»é™¤æŒ‰é”®çŠ¶æ€</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pressedKeys</span>.<span class="title function_">delete</span>(event.<span class="property">keyCode</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ›´æ–°çŸ©é˜µçŠ¶æ€ï¼šé‡Šæ”¾æ—¶å¯¹åº”ä½è®¾ä¸º 1</span></span><br><span class="line">  <span class="keyword">const</span> rowMask = <span class="number">1</span> &lt;&lt; keyInfo.<span class="property">row</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">keyMatrix</span>[keyInfo.<span class="property">column</span>] |= rowMask;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é˜²æ­¢æŒ‰é”®é»˜è®¤è¡Œä¸º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">preventDefaultKeys</span>(<span class="params">event</span>) {</span><br><span class="line">  <span class="keyword">const</span> keyInfo = <span class="variable language_">this</span>.<span class="property">keyCodeMap</span>[event.<span class="property">keyCode</span>];</span><br><span class="line">  <span class="keyword">if</span> (keyInfo) {</span><br><span class="line">    event.<span class="title function_">preventDefault</span>(); <span class="comment">// é˜»æ­¢ç®­å¤´é”®æ»šåŠ¨é¡µé¢ç­‰</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»Ÿè®¡å’Œè°ƒè¯•æ”¯æŒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">initializeDebugInfo</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">stats</span> = {</span><br><span class="line">    <span class="attr">keyPressCount</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">keyReleaseCount</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">lastKeyPressed</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">registerReads</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">registerWrites</span>: <span class="number">0</span></span><br><span class="line">  };</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h4 id="621-ä½æ“ä½œè¯¦è§£çŠ¶æ€åè½¬çš„æ•°å€¼ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#621-ä½æ“ä½œè¯¦è§£çŠ¶æ€åè½¬çš„æ•°å€¼ç¤ºä¾‹"></a> 6.2.1. ä½æ“ä½œè¯¦è§£ï¼šçŠ¶æ€åè½¬çš„æ•°å€¼ç¤ºä¾‹</h4>
<p>GameBoy çš„çŠ¶æ€åè½¬é€»è¾‘æ˜¯æ•´ä¸ªè¾“å…¥ç³»ç»Ÿçš„æ ¸å¿ƒã€‚è®©æˆ‘ä»¬é€šè¿‡å…·ä½“çš„æ•°å€¼ç¤ºä¾‹æ¥ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<blockquote>
<p><strong>åˆå§‹çŠ¶æ€ï¼ˆæ‰€æœ‰æŒ‰é”®æœªæŒ‰ä¸‹ï¼‰ï¼š</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åˆ—1ï¼ˆåŠŸèƒ½é”®ï¼‰: keyMatrix[0] = 0x0F = 0b00001111</span><br><span class="line">åˆ—2ï¼ˆæ–¹å‘é”®ï¼‰: keyMatrix[1] = 0x0F = 0b00001111</span><br><span class="line"></span><br><span class="line">ä½å«ä¹‰ï¼š[bit3=Start, bit2=Select, bit1=B, bit0=A]</span><br><span class="line">      [bit3=Down,  bit2=Up,     bit1=Left, bit0=Right]</span><br></pre></td></tr></tbody></table></figure>
<p><strong>ç¤ºä¾‹ 1ï¼šæŒ‰ä¸‹ A é”®ï¼ˆåˆ— 0 è¡Œ 0ï¼‰</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. æŒ‰é”®ä¿¡æ¯ï¼šA_BUTTON = { column: 0, row: 0, ... }</span><br><span class="line">2. åˆ›å»ºè¡Œæ©ç ï¼šrowMask = ~(1 &lt;&lt; 0) = ~0b00000001 = 0b11111110 = 0xFE</span><br><span class="line">3. åº”ç”¨æ©ç ï¼škeyMatrix[0] &amp;= 0xFE</span><br><span class="line">   åŸå€¼ï¼š0x0F = 0b00001111</span><br><span class="line">   æ©ç ï¼š0xFE = 0b11111110</span><br><span class="line">   ç»“æœï¼š0x0E = 0b00001110  â† A é”®ç°åœ¨ä¸º 0ï¼ˆæŒ‰ä¸‹çŠ¶æ€ï¼‰</span><br></pre></td></tr></tbody></table></figure>
<p><strong>ç¤ºä¾‹ 2ï¼šæŒ‰ä¸‹æ–¹å‘é”® Upï¼ˆåˆ— 1 è¡Œ 2ï¼‰</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. æŒ‰é”®ä¿¡æ¯ï¼šUP = { column: 1, row: 2, ... }</span><br><span class="line">2. åˆ›å»ºè¡Œæ©ç ï¼šrowMask = ~(1 &lt;&lt; 2) = ~0b00000100 = 0b11111011 = 0xFB</span><br><span class="line">3. åº”ç”¨æ©ç ï¼škeyMatrix[1] &amp;= 0xFB</span><br><span class="line">   åŸå€¼ï¼š0x0F = 0b00001111</span><br><span class="line">   æ©ç ï¼š0xFB = 0b11111011</span><br><span class="line">   ç»“æœï¼š0x0B = 0b00001011  â† Up é”®ç°åœ¨ä¸º 0ï¼ˆæŒ‰ä¸‹çŠ¶æ€ï¼‰</span><br></pre></td></tr></tbody></table></figure>
<p><strong>ç¤ºä¾‹ 3ï¼šåŒæ—¶æŒ‰ä¸‹ A é”®å’Œ B é”®</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">åˆå§‹ï¼škeyMatrix[0] = 0x0F = 0b00001111</span><br><span class="line"></span><br><span class="line">æŒ‰ä¸‹Aé”®ï¼š</span><br><span class="line">rowMask = ~(1 &lt;&lt; 0) = 0xFE = 0b11111110</span><br><span class="line">keyMatrix[0] = 0x0F &amp; 0xFE = 0x0E = 0b00001110</span><br><span class="line"></span><br><span class="line">æŒ‰ä¸‹Bé”®ï¼š</span><br><span class="line">rowMask = ~(1 &lt;&lt; 1) = 0xFD = 0b11111101  </span><br><span class="line">keyMatrix[0] = 0x0E &amp; 0xFD = 0x0C = 0b00001100</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆçŠ¶æ€ï¼š0b00001100 â† A å’Œ B é”®éƒ½ä¸º 0ï¼ˆéƒ½è¢«æŒ‰ä¸‹ï¼‰</span><br></pre></td></tr></tbody></table></figure>
<p><strong>é‡Šæ”¾æŒ‰é”®çš„è¿‡ç¨‹</strong>ï¼ˆä»¥é‡Šæ”¾ A é”®ä¸ºä¾‹ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. å½“å‰çŠ¶æ€ï¼škeyMatrix[0] = 0x0C = 0b00001100 (Aå’ŒBéƒ½æŒ‰ä¸‹)</span><br><span class="line">2. åˆ›å»ºæ¢å¤æ©ç ï¼šrowMask = 1 &lt;&lt; 0 = 0b00000001 = 0x01</span><br><span class="line">3. åº”ç”¨æˆ–æ“ä½œï¼škeyMatrix[0] |= 0x01</span><br><span class="line">   å½“å‰ï¼š0x0C = 0b00001100</span><br><span class="line">   æ©ç ï¼š0x01 = 0b00000001</span><br><span class="line">   ç»“æœï¼š0x0D = 0b00001101  â† A é”®æ¢å¤ä¸º 1ï¼ˆæœªæŒ‰ä¸‹ï¼‰ï¼ŒB é”®ä¿æŒ 0ï¼ˆä»æŒ‰ä¸‹ï¼‰</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p><strong>å…³é”®ç†è§£ç‚¹ï¼š</strong></p>
<ol>
<li>
<p><strong>æŒ‰ä¸‹æ“ä½œ</strong>ï¼šä½¿ç”¨ <code>&amp;=</code> å’Œåè½¬æ©ç å°†æŒ‡å®šä½è®¾ä¸º 0</p>
<ul>
<li><code>~(1 &lt;&lt; row)</code> åˆ›å»ºåªæœ‰ç›®æ ‡ä½ä¸º 0 çš„æ©ç </li>
<li>ä¸è¿ç®—ç¡®ä¿åªæœ‰ç›®æ ‡ä½è¢«æ¸…é›¶</li>
</ul>
</li>
<li>
<p><strong>é‡Šæ”¾æ“ä½œ</strong>ï¼šä½¿ç”¨ <code>|=</code> å’Œæ­£å¸¸æ©ç å°†æŒ‡å®šä½è®¾ä¸º 1</p>
<ul>
<li><code>(1 &lt;&lt; row)</code> åˆ›å»ºåªæœ‰ç›®æ ‡ä½ä¸º 1 çš„æ©ç </li>
<li>æˆ–è¿ç®—ç¡®ä¿åªæœ‰ç›®æ ‡ä½è¢«ç½®ä½</li>
</ul>
</li>
<li>
<p><strong>ç»„åˆæŒ‰é”®</strong>ï¼šå¤šä¸ªæŒ‰é”®å¯ä»¥åŒæ—¶å¤„äºæŒ‰ä¸‹çŠ¶æ€ï¼Œæ¯ä¸ªæŒ‰é”®ç‹¬ç«‹ç®¡ç†å…¶å¯¹åº”çš„ä½</p>
</li>
</ol>
<p>è¿™ç§è®¾è®¡è®© GameBoy èƒ½å¤Ÿå‡†ç¡®æ£€æµ‹ä»»æ„æŒ‰é”®ç»„åˆï¼Œä¸ºå¤æ‚çš„æ¸¸æˆæ“ä½œæä¾›äº†åŸºç¡€ã€‚</p>
<blockquote>
<p><strong>ä¸ºä»€ä¹ˆæ˜¯åè½¬çš„ï¼Ÿ</strong></p>
<p>GameBoy ä½¿ç”¨ "ä½ç”µå¹³æœ‰æ•ˆ" çš„ç¡¬ä»¶è®¾è®¡ï¼š</p>
<ul>
<li>æŒ‰é”®æœªæŒ‰ä¸‹æ—¶ï¼Œè¯¥ä½ä¸ºé«˜ç”µå¹³ï¼ˆ1ï¼‰</li>
<li>æŒ‰é”®æŒ‰ä¸‹æ—¶ï¼Œè¯¥ä½è¢«æ‹‰ä½ï¼ˆ0ï¼‰</li>
</ul>
</blockquote>
<h2 id="63-å¯„å­˜å™¨æ¥å£å®ç°"><a class="markdownIt-Anchor" href="#63-å¯„å­˜å™¨æ¥å£å®ç°"></a> 6.3. å¯„å­˜å™¨æ¥å£å®ç°</h2>
<p>è¾“å…¥æ§åˆ¶å™¨çš„æœ€ç»ˆç›®çš„æ˜¯ä¸º CPU æä¾›ç¬¦åˆ GameBoy ç¡¬ä»¶è§„èŒƒçš„å¯„å­˜å™¨æ¥å£ã€‚CPU é€šè¿‡è¯»å†™ <code>0xFF00</code> åœ°å€æ¥è·å–æŒ‰é”®çŠ¶æ€å’Œæ§åˆ¶æ‰«ææ¨¡å¼ã€‚</p>
<p>è¾“å…¥æ§åˆ¶å™¨å¿…é¡»æä¾›ç¬¦åˆ GameBoy ç¡¬ä»¶è§„èŒƒçš„å¯„å­˜å™¨æ¥å£ï¼š</p>
<figure class="highlight javascript"><figcaption><span>input.JS</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯»å–æ¸¸æˆæ‰‹æŸ„å¯„å­˜å™¨</span></span><br><span class="line"><span class="comment"> * æ ¹æ®å½“å‰é€‰æ‹©çš„åˆ—è¿”å›å¯¹åº”çš„æŒ‰é”®çŠ¶æ€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">readJoypadRegister</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">let</span> result = <span class="number">0xC0</span>; <span class="comment">// é«˜2ä½å§‹ç»ˆä¸º1ï¼ˆæœªä½¿ç”¨ï¼‰</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ åˆ—é€‰æ‹©ä½</span></span><br><span class="line">  result |= <span class="variable language_">this</span>.<span class="property">selectedColumn</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ®é€‰æ‹©çš„åˆ—è¿”å›å¯¹åº”çš„è¡ŒçŠ¶æ€</span></span><br><span class="line">  <span class="keyword">switch</span> (<span class="variable language_">this</span>.<span class="property">selectedColumn</span>) {</span><br><span class="line">    <span class="keyword">case</span> <span class="variable constant_">INPUT_CONSTANTS</span>.<span class="property">COLUMN_1_SELECT</span>:</span><br><span class="line">      <span class="comment">// åŠŸèƒ½é”®åˆ—</span></span><br><span class="line">      result |= <span class="variable language_">this</span>.<span class="property">keyMatrix</span>[<span class="number">0</span>] &amp; <span class="variable constant_">INPUT_CONSTANTS</span>.<span class="property">ROW_MASK</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="variable constant_">INPUT_CONSTANTS</span>.<span class="property">COLUMN_2_SELECT</span>:</span><br><span class="line">      <span class="comment">// æ–¹å‘é”®åˆ—  </span></span><br><span class="line">      result |= <span class="variable language_">this</span>.<span class="property">keyMatrix</span>[<span class="number">1</span>] &amp; <span class="variable constant_">INPUT_CONSTANTS</span>.<span class="property">ROW_MASK</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="comment">// æ²¡æœ‰é€‰æ‹©åˆ—ï¼Œè¿”å›æ‰€æœ‰è¡Œä¸ºé«˜ç”µå¹³</span></span><br><span class="line">      result |= <span class="variable constant_">INPUT_CONSTANTS</span>.<span class="property">ROW_MASK</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å†™å…¥æ¸¸æˆæ‰‹æŸ„å¯„å­˜å™¨</span></span><br><span class="line"><span class="comment"> * ä¸»è¦ç”¨äºé€‰æ‹©è¦è¯»å–çš„åˆ—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">writeJoypadRegister</span>(<span class="params">value</span>) {</span><br><span class="line">  <span class="comment">// æå–åˆ—é€‰æ‹©ä½</span></span><br><span class="line">  <span class="keyword">const</span> columnSelect = value &amp; <span class="variable constant_">INPUT_CONSTANTS</span>.<span class="property">COLUMN_SELECT_MASK</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (columnSelect !== <span class="variable language_">this</span>.<span class="property">selectedColumn</span>) {</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">selectedColumn</span> = columnSelect;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">DEBUG_MODE</span>) {</span><br><span class="line">      <span class="keyword">const</span> columnName = columnSelect === <span class="variable constant_">INPUT_CONSTANTS</span>.<span class="property">COLUMN_1_SELECT</span> ? <span class="string">'åŠŸèƒ½é”®'</span> : </span><br><span class="line">                        columnSelect === <span class="variable constant_">INPUT_CONSTANTS</span>.<span class="property">COLUMN_2_SELECT</span> ? <span class="string">'æ–¹å‘é”®'</span> : <span class="string">'æ— '</span>;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`âœï¸ é€‰æ‹©<span class="subst">${columnName}</span>åˆ—`</span>);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™äº›å‡½æ•°æ˜¯æ•´ä¸ªè¾“å…¥ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œå®ç°äº†å®Œæ•´çš„çŸ©é˜µæ‰«æé€»è¾‘ï¼š</p>
<ol>
<li><strong>é«˜ä½è®¾ç½®</strong>ï¼š<code>0xC0</code> è®¾ç½®ç¬¬ 6ã€7 ä½ä¸º 1ï¼ˆç¡¬ä»¶è§„èŒƒè¦æ±‚ï¼‰</li>
<li><strong>åˆ—é€‰æ‹©å›æ˜¾</strong>ï¼šå°†å½“å‰é€‰æ‹©çš„åˆ—å€¼åŠ å…¥ç»“æœ</li>
<li><strong>è¡ŒçŠ¶æ€è¿”å›</strong>ï¼šæ ¹æ®é€‰æ‹©çš„åˆ—è¿”å›å¯¹åº”çš„ 4 ä½è¡ŒçŠ¶æ€</li>
</ol>
<p>çŸ©é˜µæ‰«æçš„å·¥ä½œæµç¨‹ï¼š</p>
<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-8 -8 481.046875 446.890625" style="max-width: 481.046875px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-1768201632824"><style>#mermaid-1768201632824{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1768201632824 .error-icon{fill:#552222;}#mermaid-1768201632824 .error-text{fill:#552222;stroke:#552222;}#mermaid-1768201632824 .edge-thickness-normal{stroke-width:2px;}#mermaid-1768201632824 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1768201632824 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1768201632824 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1768201632824 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1768201632824 .marker{fill:#333333;stroke:#333333;}#mermaid-1768201632824 .marker.cross{stroke:#333333;}#mermaid-1768201632824 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1768201632824 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-1768201632824 .cluster-label text{fill:#333;}#mermaid-1768201632824 .cluster-label span,#mermaid-1768201632824 p{color:#333;}#mermaid-1768201632824 .label text,#mermaid-1768201632824 span,#mermaid-1768201632824 p{fill:#333;color:#333;}#mermaid-1768201632824 .node rect,#mermaid-1768201632824 .node circle,#mermaid-1768201632824 .node ellipse,#mermaid-1768201632824 .node polygon,#mermaid-1768201632824 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1768201632824 .flowchart-label text{text-anchor:middle;}#mermaid-1768201632824 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-1768201632824 .node .label{text-align:center;}#mermaid-1768201632824 .node.clickable{cursor:pointer;}#mermaid-1768201632824 .arrowheadPath{fill:#333333;}#mermaid-1768201632824 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1768201632824 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1768201632824 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1768201632824 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1768201632824 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-1768201632824 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1768201632824 .cluster text{fill:#333;}#mermaid-1768201632824 .cluster span,#mermaid-1768201632824 p{color:#333;}#mermaid-1768201632824 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1768201632824 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-1768201632824 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="6" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-1768201632824_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-1768201632824_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-1768201632824_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-1768201632824_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-1768201632824_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-1768201632824_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#mermaid-1768201632824_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" id="L-A-B-0" d="M240.523,39L240.523,43.167C240.523,47.333,240.523,55.667,240.589,63.2C240.655,70.734,240.788,77.467,240.854,80.834L240.92,84.201"></path><path marker-end="url(#mermaid-1768201632824_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" id="L-B-C-0" d="M197.421,185.788L175.102,199.139C152.783,212.489,108.146,239.19,85.827,257.824C63.508,276.457,63.508,287.024,63.508,292.307L63.508,297.591"></path><path marker-end="url(#mermaid-1768201632824_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-D" id="L-B-D-0" d="M241.023,229.391L240.94,235.474C240.857,241.557,240.69,253.724,240.607,265.091C240.523,276.457,240.523,287.024,240.523,292.307L240.523,297.591"></path><path marker-end="url(#mermaid-1768201632824_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-E" id="L-B-E-0" d="M283.862,186.552L304.808,199.775C325.755,212.998,367.647,239.444,388.593,257.951C409.539,276.457,409.539,287.024,409.539,292.307L409.539,297.591"></path><path marker-end="url(#mermaid-1768201632824_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-C LE-F" id="L-C-F-0" d="M63.508,341.891L63.508,346.057C63.508,350.224,63.508,358.557,80.497,366.995C97.487,375.433,131.467,383.975,148.456,388.246L165.446,392.517"></path><path marker-end="url(#mermaid-1768201632824_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-F" id="L-D-F-0" d="M240.523,341.891L240.523,346.057C240.523,350.224,240.523,358.557,240.523,366.007C240.523,373.457,240.523,380.024,240.523,383.307L240.523,386.591"></path><path marker-end="url(#mermaid-1768201632824_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-F" id="L-E-F-0" d="M409.539,341.891L409.539,346.057C409.539,350.224,409.539,358.557,393.88,366.847C378.221,375.136,346.904,383.382,331.245,387.505L315.586,391.627"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(63.5078125, 265.890625)" class="edgeLabel"><g transform="translate(-16.59375, -9.5)" class="label"><foreignObject height="19" width="33.1875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">0x10</span></div></foreignObject></g></g><g transform="translate(240.5234375, 265.890625)" class="edgeLabel"><g transform="translate(-16.59375, -9.5)" class="label"><foreignObject height="19" width="33.1875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">0x20</span></div></foreignObject></g></g><g transform="translate(409.5390625, 265.890625)" class="edgeLabel"><g transform="translate(-16.0078125, -12)" class="label"><foreignObject height="24" width="32.015625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"> å…¶ä»–</span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(240.5234375, 19.5)" data-id="A" data-node="true" id="flowchart-A-0" class="node default default flowchart-label"><rect height="39" width="123.875" y="-19.5" x="-61.9375" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-54.4375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="108.875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"> CPU å†™å…¥åˆ—é€‰æ‹©</span></div></foreignObject></g></g><g transform="translate(240.5234375, 158.9453125)" data-id="B" data-node="true" id="flowchart-B-1" class="node default default flowchart-label"><polygon style="" transform="translate(-69.9453125,69.9453125)" class="label-container" points="69.9453125,0 139.890625,-69.9453125 69.9453125,-139.890625 0,-69.9453125"></polygon><g transform="translate(-42.9453125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="85.890625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">é€‰æ‹©å“ªä¸€åˆ—ï¼Ÿ</span></div></foreignObject></g></g><g transform="translate(63.5078125, 322.390625)" data-id="C" data-node="true" id="flowchart-C-3" class="node default default flowchart-label"><rect height="39" width="127.015625" y="-19.5" x="-63.5078125" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-56.0078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.015625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">è¿”å›åŠŸèƒ½é”®çŠ¶æ€</span></div></foreignObject></g></g><g transform="translate(240.5234375, 322.390625)" data-id="D" data-node="true" id="flowchart-D-5" class="node default default flowchart-label"><rect height="39" width="127.015625" y="-19.5" x="-63.5078125" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-56.0078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="112.015625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">è¿”å›æ–¹å‘é”®çŠ¶æ€</span></div></foreignObject></g></g><g transform="translate(409.5390625, 322.390625)" data-id="E" data-node="true" id="flowchart-E-7" class="node default default flowchart-label"><rect height="39" width="111.015625" y="-19.5" x="-55.5078125" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-48.0078125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="96.015625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">è¿”å›å…¨é«˜ç”µå¹³</span></div></foreignObject></g></g><g transform="translate(240.5234375, 411.390625)" data-id="F" data-node="true" id="flowchart-F-9" class="node default default flowchart-label"><rect height="39" width="139.875" y="-19.5" x="-69.9375" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-62.4375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="124.875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"> CPU è¯»å–æŒ‰é”®çŠ¶æ€</span></div></foreignObject></g></g></g></g></g></svg>
<h2 id="64-mmu-é›†æˆ"><a class="markdownIt-Anchor" href="#64-mmu-é›†æˆ"></a> 6.4. MMU é›†æˆ</h2>
<p>åœ¨ MMU ä¸­å®Œå–„è¾“å…¥å¯„å­˜å™¨çš„å¤„ç†é€»è¾‘ï¼š</p>
<figure class="highlight javascript"><figcaption><span>input.JS</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯»å–I/Oå¯„å­˜å™¨ - æ”¯æŒç¡¬ä»¶ç»„ä»¶è·¯ç”±</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">readIORegister</span>(<span class="params">address</span>) {</span><br><span class="line">  <span class="comment">// ğŸ® æŒ‰é”®è¾“å…¥å¯„å­˜å™¨ (0xFF00) - ç¬¬6ç« å®ç° âœ… å·²å®Œæˆ</span></span><br><span class="line">  <span class="keyword">if</span> (address === <span class="variable constant_">IO_REGISTERS</span>.<span class="property">JOYPAD</span>) {</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">inputController</span> &amp;&amp; <span class="keyword">typeof</span> <span class="variable language_">this</span>.<span class="property">inputController</span>.<span class="property">readJoypadRegister</span> === <span class="string">'function'</span>) {</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">inputController</span>.<span class="title function_">readJoypadRegister</span>();</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="comment">// å¦‚æœè¾“å…¥æ§åˆ¶å™¨æœªè¿æ¥ï¼Œè¿”å›é»˜è®¤å€¼ï¼ˆæ‰€æœ‰æŒ‰é”®æœªæŒ‰ä¸‹ï¼‰</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">0xFF</span>; <span class="comment">// é»˜è®¤ï¼šæ‰€æœ‰æŒ‰é”®æœªæŒ‰ä¸‹</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ... å…¶ä»–å¯„å­˜å™¨å¤„ç† ...</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å†™å…¥I/Oå¯„å­˜å™¨ - æ”¯æŒç¡¬ä»¶ç»„ä»¶è·¯ç”±</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">writeIORegister</span>(<span class="params">address, value</span>) {</span><br><span class="line">  <span class="comment">// ğŸ® æŒ‰é”®è¾“å…¥å¯„å­˜å™¨ (0xFF00) - ç¬¬6ç« å®ç° âœ… å·²å®Œæˆ</span></span><br><span class="line">  <span class="keyword">if</span> (address === <span class="variable constant_">IO_REGISTERS</span>.<span class="property">JOYPAD</span>) {</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">inputController</span> &amp;&amp; <span class="keyword">typeof</span> <span class="variable language_">this</span>.<span class="property">inputController</span>.<span class="property">writeJoypadRegister</span> === <span class="string">'function'</span>) {</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">inputController</span>.<span class="title function_">writeJoypadRegister</span>(value);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// ä¿å­˜åˆ°æœ¬åœ°æ•°ç»„</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ioRegisters</span>[address - <span class="variable constant_">MEMORY_REGIONS</span>.<span class="property">IO_START</span>] = value;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ... å…¶ä»–å¯„å­˜å™¨å¤„ç† ...</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–I/Oå¯„å­˜å™¨çŠ¶æ€ (è°ƒè¯•ç”¨)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> {<span class="type">Object</span>} I/Oå¯„å­˜å™¨çŠ¶æ€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">getIORegisterStatus</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">const</span> status = {</span><br><span class="line">    <span class="attr">gpu</span>: {</span><br><span class="line">      <span class="attr">lcdc</span>: <span class="variable language_">this</span>.<span class="title function_">readByte</span>(<span class="variable constant_">IO_REGISTERS</span>.<span class="property">LCDC</span>).<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">'0'</span>),</span><br><span class="line">      <span class="attr">stat</span>: <span class="variable language_">this</span>.<span class="title function_">readByte</span>(<span class="variable constant_">IO_REGISTERS</span>.<span class="property">STAT</span>).<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">'0'</span>),</span><br><span class="line">      <span class="attr">scy</span>: <span class="variable language_">this</span>.<span class="title function_">readByte</span>(<span class="variable constant_">IO_REGISTERS</span>.<span class="property">SCY</span>),</span><br><span class="line">      <span class="attr">scx</span>: <span class="variable language_">this</span>.<span class="title function_">readByte</span>(<span class="variable constant_">IO_REGISTERS</span>.<span class="property">SCX</span>),</span><br><span class="line">      <span class="attr">ly</span>: <span class="variable language_">this</span>.<span class="title function_">readByte</span>(<span class="variable constant_">IO_REGISTERS</span>.<span class="property">LY</span>),</span><br><span class="line">      <span class="attr">bgp</span>: <span class="variable language_">this</span>.<span class="title function_">readByte</span>(<span class="variable constant_">IO_REGISTERS</span>.<span class="property">BGP</span>).<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">'0'</span>)</span><br><span class="line">    },</span><br><span class="line">    <span class="attr">input</span>: {</span><br><span class="line">      <span class="attr">joypad</span>: <span class="variable language_">this</span>.<span class="title function_">readByte</span>(<span class="variable constant_">IO_REGISTERS</span>.<span class="property">JOYPAD</span>).<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">'0'</span>)</span><br><span class="line">    },</span><br><span class="line">    <span class="attr">interrupts</span>: {</span><br><span class="line">      <span class="attr">ie</span>: <span class="variable language_">this</span>.<span class="title function_">readByte</span>(<span class="variable constant_">IO_REGISTERS</span>.<span class="property">IE</span>).<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">'0'</span>),</span><br><span class="line">      <span class="attr">if</span>: <span class="variable language_">this</span>.<span class="title function_">readByte</span>(<span class="variable constant_">IO_REGISTERS</span>.<span class="property">IF</span>).<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">'0'</span>)</span><br><span class="line">    }</span><br><span class="line">  };</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœè¾“å…¥æ§åˆ¶å™¨å¯ç”¨ï¼Œæ·»åŠ è¯¦ç»†çš„è¾“å…¥çŠ¶æ€</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">inputController</span>) {</span><br><span class="line">    status.<span class="property">input</span>.<span class="property">detailed</span> = <span class="variable language_">this</span>.<span class="property">inputController</span>.<span class="title function_">getInputStatus</span>();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> status;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="65-ç³»ç»Ÿé›†æˆ"><a class="markdownIt-Anchor" href="#65-ç³»ç»Ÿé›†æˆ"></a> 6.5. ç³»ç»Ÿé›†æˆ</h2>
<p>åœ¨ä¸»ç³»ç»Ÿä¸­åˆ›å»ºå’Œè¿æ¥è¾“å…¥æ§åˆ¶å™¨ï¼š</p>
<figure class="highlight javascript"><figcaption><span>gameboy.JS</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºç¡¬ä»¶ç»„ä»¶å®ä¾‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">createHardwareComponents</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ›å»ºè¾“å…¥æ§åˆ¶å™¨</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">inputController</span> = <span class="keyword">new</span> <span class="title class_">GameBoyInputController</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'âœ… è¾“å…¥æ§åˆ¶å™¨å·²åˆ›å»º'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½®å…¨å±€å¼•ç”¨ï¼ˆå…¼å®¹æ€§ï¼‰</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">InputController</span> = <span class="variable language_">this</span>.<span class="property">inputController</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿æ¥ç¡¬ä»¶ç»„ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">connectComponents</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿æ¥è¾“å…¥æ§åˆ¶å™¨åˆ° MMU</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">mmu</span>.<span class="title function_">connectHardware</span>(<span class="string">'input'</span>, <span class="variable language_">this</span>.<span class="property">inputController</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'ğŸ”— ç¡¬ä»¶ç»„ä»¶è¿æ¥å®Œæˆ'</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ£€æŸ¥å¿…è¦çš„ç±»æ˜¯å¦å·²åŠ è½½</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">checkRequiredClasses</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">const</span> requiredClasses = [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    { <span class="attr">name</span>: <span class="string">'GameBoyInputController'</span>, <span class="attr">class</span>: <span class="variable language_">window</span>.<span class="property">GameBoyInputController</span> }</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç³»ç»Ÿé‡ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">reset</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">inputController</span>) <span class="variable language_">this</span>.<span class="property">inputController</span>.<span class="title function_">reset</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  } <span class="keyword">catch</span> (error) {</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–ç³»ç»ŸçŠ¶æ€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> {<span class="type">Object</span>} ç³»ç»ŸçŠ¶æ€å¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">getStatus</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">const</span> status = {</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">components</span>: {</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      <span class="attr">input</span>: <span class="variable language_">this</span>.<span class="property">inputController</span> ? <span class="variable language_">this</span>.<span class="property">inputController</span>.<span class="title function_">getInputStatus</span>() : <span class="string">'æœªåˆå§‹åŒ–'</span></span><br><span class="line">    }</span><br><span class="line">  };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–è°ƒè¯•ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> {<span class="type">string</span>} æ ¼å¼åŒ–çš„è°ƒè¯•ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">getDebugInfo</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¾“å…¥æ§åˆ¶å™¨çŠ¶æ€</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">inputController</span>) {</span><br><span class="line">    debugInfo += <span class="string">`\n\nğŸ® è¾“å…¥æ§åˆ¶å™¨çŠ¶æ€ï¼š\n<span class="subst">${<span class="variable language_">this</span>.inputController.getDebugInfo()}</span>`</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é”€æ¯ç³»ç»Ÿï¼ˆæ¸…ç†èµ„æºï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">destroy</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">inputController</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">inputController</span>) <span class="keyword">delete</span> <span class="variable language_">window</span>.<span class="property">InputController</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="66-è°ƒè¯•å’Œæµ‹è¯•å·¥å…·"><a class="markdownIt-Anchor" href="#66-è°ƒè¯•å’Œæµ‹è¯•å·¥å…·"></a> 6.6. è°ƒè¯•å’Œæµ‹è¯•å·¥å…·</h2>
<p>è¾“å…¥ç³»ç»ŸåŒ…å«äº†å®Œæ•´çš„è°ƒè¯•åŠŸèƒ½ï¼š</p>
<figure class="highlight javascript"><figcaption><span>input.JS</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å®Œæ•´çš„è¾“å…¥çŠ¶æ€ï¼ˆè°ƒè¯•ä¸“ç”¨ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">getInputStatus</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">const</span> pressedKeyNames = <span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="variable language_">this</span>.<span class="property">pressedKeys</span>).<span class="title function_">map</span>(<span class="function"><span class="params">keyCode</span> =&gt;</span> {</span><br><span class="line">    <span class="keyword">const</span> keyInfo = <span class="variable language_">this</span>.<span class="property">keyCodeMap</span>[keyCode];</span><br><span class="line">    <span class="keyword">return</span> keyInfo ? keyInfo.<span class="property">name</span> : <span class="string">`Unknown(<span class="subst">${keyCode}</span>)`</span>;</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> {</span><br><span class="line">    <span class="attr">selectedColumn</span>: <span class="variable language_">this</span>.<span class="property">selectedColumn</span>,</span><br><span class="line">    <span class="attr">keyMatrix</span>: [...<span class="variable language_">this</span>.<span class="property">keyMatrix</span>],           <span class="comment">// å¤åˆ¶æ•°ç»„é¿å…å¤–éƒ¨ä¿®æ”¹</span></span><br><span class="line">    <span class="attr">pressedKeys</span>: pressedKeyNames,</span><br><span class="line">    <span class="attr">stats</span>: { ...<span class="variable language_">this</span>.<span class="property">stats</span> }                 <span class="comment">// å¤åˆ¶å¯¹è±¡</span></span><br><span class="line">  };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–æŒ‰é”®æ˜ å°„ä¿¡æ¯ï¼ˆç”¨äºUIæ˜¾ç¤ºï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">getKeyMappings</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">values</span>(<span class="variable constant_">KEY_MAPPING</span>).<span class="title function_">map</span>(<span class="function"><span class="params">keyInfo</span> =&gt;</span> ({</span><br><span class="line">    <span class="attr">gameboyKey</span>: keyInfo.<span class="property">name</span>,</span><br><span class="line">    <span class="attr">keyboardKey</span>: keyInfo.<span class="property">key</span>,</span><br><span class="line">    <span class="attr">keyCode</span>: keyInfo.<span class="property">keyCode</span>,</span><br><span class="line">    <span class="attr">isPressed</span>: <span class="variable language_">this</span>.<span class="property">pressedKeys</span>.<span class="title function_">has</span>(keyInfo.<span class="property">keyCode</span>)</span><br><span class="line">  }));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¨¡æ‹ŸæŒ‰é”®æ“ä½œï¼ˆæµ‹è¯•ä¸“ç”¨ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">simulateKeyPress</span>(<span class="params">keyName</span>) {</span><br><span class="line">  <span class="keyword">const</span> keyInfo = <span class="title class_">Object</span>.<span class="title function_">values</span>(<span class="variable constant_">KEY_MAPPING</span>).<span class="title function_">find</span>(<span class="function"><span class="params">info</span> =&gt;</span> info.<span class="property">name</span> === keyName);</span><br><span class="line">  <span class="keyword">if</span> (keyInfo) {</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">handleKeyDown</span>({ <span class="attr">keyCode</span>: keyInfo.<span class="property">keyCode</span>, <span class="attr">preventDefault</span>: <span class="function">() =&gt;</span> {} });</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="title function_">simulateKeyRelease</span>(<span class="params">keyName</span>) {</span><br><span class="line">  <span class="keyword">const</span> keyInfo = <span class="title class_">Object</span>.<span class="title function_">values</span>(<span class="variable constant_">KEY_MAPPING</span>).<span class="title function_">find</span>(<span class="function"><span class="params">info</span> =&gt;</span> info.<span class="property">name</span> === keyName);</span><br><span class="line">  <span class="keyword">if</span> (keyInfo) {</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">handleKeyUp</span>({ <span class="attr">keyCode</span>: keyInfo.<span class="property">keyCode</span> });</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–è°ƒè¯•ä¿¡æ¯å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">getDebugInfo</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">const</span> status = <span class="variable language_">this</span>.<span class="title function_">getInputStatus</span>();</span><br><span class="line">  <span class="keyword">const</span> mappings = <span class="variable language_">this</span>.<span class="title function_">getKeyMappings</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> debugInfo = <span class="string">`ğŸ® è¾“å…¥æ§åˆ¶å™¨çŠ¶æ€ï¼š</span></span><br><span class="line"><span class="string">é€‰æ‹©åˆ—: 0x<span class="subst">${status.selectedColumn.toString(<span class="number">16</span>).padStart(<span class="number">2</span>, <span class="string">'0'</span>)}</span></span></span><br><span class="line"><span class="string">çŸ©é˜µçŠ¶æ€: [0x<span class="subst">${status.keyMatrix[<span class="number">0</span>].toString(<span class="number">16</span>)}</span>, 0x<span class="subst">${status.keyMatrix[<span class="number">1</span>].toString(<span class="number">16</span>)}</span>]</span></span><br><span class="line"><span class="string">å½“å‰æŒ‰ä¸‹: <span class="subst">${status.pressedKeys.join(<span class="string">', '</span>) || <span class="string">'æ— '</span>}</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ğŸ“Š ç»Ÿè®¡ä¿¡æ¯ï¼š</span></span><br><span class="line"><span class="string">æŒ‰é”®æ¬¡æ•°: <span class="subst">${status.stats.keyPressCount}</span></span></span><br><span class="line"><span class="string">é‡Šæ”¾æ¬¡æ•°: <span class="subst">${status.stats.keyReleaseCount}</span></span></span><br><span class="line"><span class="string">å¯„å­˜å™¨è¯»å–: <span class="subst">${status.stats.registerReads}</span></span></span><br><span class="line"><span class="string">å¯„å­˜å™¨å†™å…¥: <span class="subst">${status.stats.registerWrites}</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ğŸ—ï¸ æŒ‰é”®æ˜ å°„ï¼š`</span>;</span><br><span class="line"></span><br><span class="line">  mappings.<span class="title function_">forEach</span>(<span class="function"><span class="params">mapping</span> =&gt;</span> {</span><br><span class="line">    <span class="keyword">const</span> statusIcon = mapping.<span class="property">isPressed</span> ? <span class="string">'ğŸ”´'</span> : <span class="string">'âšª'</span>;</span><br><span class="line">    debugInfo += <span class="string">`\n<span class="subst">${statusIcon}</span> <span class="subst">${mapping.gameboyKey}</span>: <span class="subst">${mapping.keyboardKey}</span>`</span>;</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> debugInfo;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è‡ªåŠ¨åŒ–æµ‹è¯•åŠŸèƒ½å¯ä»¥éªŒè¯æ‰€æœ‰æŒ‰é”®ï¼š</p>
<figure class="highlight javascript"><figcaption><span>gameboy.JS</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•è¾“å…¥ç³»ç»Ÿï¼ˆè°ƒè¯•ç”¨ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">testInputSystem</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">inputController</span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">'âš ï¸ è¾“å…¥æ§åˆ¶å™¨æœªåˆå§‹åŒ–'</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'ğŸ§ª å¼€å§‹è¾“å…¥ç³»ç»Ÿæµ‹è¯•...'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æµ‹è¯•å„ä¸ªæŒ‰é”®</span></span><br><span class="line">  <span class="keyword">const</span> testKeys = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'Start'</span>, <span class="string">'Select'</span>, <span class="string">'Up'</span>, <span class="string">'Down'</span>, <span class="string">'Left'</span>, <span class="string">'Right'</span>];</span><br><span class="line">  </span><br><span class="line">  testKeys.<span class="title function_">forEach</span>(<span class="function">(<span class="params">keyName, index</span>) =&gt;</span> {</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">inputController</span>.<span class="title function_">simulateKeyPress</span>(keyName);</span><br><span class="line">      </span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">inputController</span>.<span class="title function_">simulateKeyRelease</span>(keyName);</span><br><span class="line">      }, <span class="number">200</span>);</span><br><span class="line">    }, index * <span class="number">500</span>);</span><br><span class="line">  });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="67-ç”¨æˆ·ç•Œé¢å®Œå–„"><a class="markdownIt-Anchor" href="#67-ç”¨æˆ·ç•Œé¢å®Œå–„"></a> 6.7. ç”¨æˆ·ç•Œé¢å®Œå–„</h2>
<p>ä¸ºäº†æé«˜ç”¨æˆ·ä½“éªŒï¼Œéœ€è¦å®ç°ä¸€ä¸ªå¯è§†åŒ–çš„è™šæ‹Ÿæ‰‹æŸ„ã€‚è™šæ‹Ÿæ‰‹æŸ„çš„æ ¸å¿ƒåœ¨äºå°†è§¦æ‘¸ / é¼ æ ‡äº‹ä»¶è½¬æ¢ä¸º GameBoy æŒ‰é”®äº‹ä»¶ï¼šï¼š</p>
<figure class="highlight html"><figcaption><span>index.HTML</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- è¾“å…¥æ§åˆ¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"controls"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- è™šæ‹ŸæŒ‰é”®æ˜¾ç¤º --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-section"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-title"</span>&gt;</span>ğŸ•¹ï¸ è™šæ‹Ÿæ‰‹æŸ„<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"virtual-gamepad"</span> <span class="attr">id</span>=<span class="string">"virtual-gamepad"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- æ–¹å‘é”® --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dpad-container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dpad"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dpad-button dpad-up"</span> <span class="attr">data-key</span>=<span class="string">"Up"</span>&gt;</span>â†‘<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dpad-middle"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dpad-button dpad-left"</span> <span class="attr">data-key</span>=<span class="string">"Left"</span>&gt;</span>â†<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dpad-center"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dpad-button dpad-right"</span> <span class="attr">data-key</span>=<span class="string">"Right"</span>&gt;</span>â†’<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dpad-button dpad-down"</span> <span class="attr">data-key</span>=<span class="string">"Down"</span>&gt;</span>â†“<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dpad-label"</span>&gt;</span>æ–¹å‘é”®<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">&lt;!-- åŠŸèƒ½é”® --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"action-buttons"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"button-row"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"action-button"</span> <span class="attr">data-key</span>=<span class="string">"Select"</span>&gt;</span>SELECT<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"action-button"</span> <span class="attr">data-key</span>=<span class="string">"Start"</span>&gt;</span>START<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"button-row"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"action-button action-b"</span> <span class="attr">data-key</span>=<span class="string">"B"</span>&gt;</span>B<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"action-button action-a"</span> <span class="attr">data-key</span>=<span class="string">"A"</span>&gt;</span>A<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- è°ƒè¯•å’Œå›¾å½¢æ§åˆ¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"controls"</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ ·å¼ï¼š</p>
<figure class="highlight html"><figcaption><span>index.HTML</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* è™šæ‹Ÿæ‰‹æŸ„æ ·å¼ */</span></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.virtual-gamepad</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">justify-content</span>: space-between;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#5a6b4d</span>, <span class="number">#6a7b5d</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-radius</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">min-height</span>: <span class="number">120px</span>;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.dpad-container</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">gap</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.dpad</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: grid;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">grid-template-areas</span>: </span></span><br><span class="line"><span class="language-css">      <span class="string">". up ."</span></span></span><br><span class="line"><span class="language-css">      <span class="string">"left center right"</span></span></span><br><span class="line"><span class="language-css">      <span class="string">". down ."</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">grid-template-columns</span>: <span class="number">30px</span> <span class="number">30px</span> <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">grid-template-rows</span>: <span class="number">30px</span> <span class="number">30px</span> <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">gap</span>: <span class="number">2px</span>;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.dpad-button</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#7a8a6d</span>, <span class="number">#6a7a5d</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#2c5530</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transition</span>: all <span class="number">0.1s</span> ease;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">4px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.2</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">user-select</span>: none;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.dpad-button</span><span class="selector-pseudo">:hover</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#8a9a7d</span>, <span class="number">#7a8a6d</span>);</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.dpad-button</span><span class="selector-class">.pressed</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#5a7c4a</span>, <span class="number">#4a6c3a</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">1px</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">1px</span> <span class="number">2px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.3</span>);</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.dpad-up</span> { <span class="attribute">grid-area</span>: up; }</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.dpad-down</span> { <span class="attribute">grid-area</span>: down; }</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.dpad-left</span> { <span class="attribute">grid-area</span>: left; }</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.dpad-right</span> { <span class="attribute">grid-area</span>: right; }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.dpad-middle</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">grid-area</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.dpad-center</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#4a5c3a</span>, <span class="number">#3a4c2a</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.dpad-label</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#6b7a5e</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.action-buttons</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">gap</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.button-row</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">gap</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.action-button</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#2c5530</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transition</span>: all <span class="number">0.1s</span> ease;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">3px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.2</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">user-select</span>: none;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#7a8a6d</span>, <span class="number">#6a7a5d</span>);</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.action-button</span><span class="selector-pseudo">:hover</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#8a9a7d</span>, <span class="number">#7a8a6d</span>);</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.action-button</span><span class="selector-class">.pressed</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#5a7c4a</span>, <span class="number">#4a6c3a</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">2px</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">1px</span> <span class="number">3px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.3</span>);</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.action-a</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#a56565</span>, <span class="number">#955555</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.action-a</span><span class="selector-pseudo">:hover</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#b57575</span>, <span class="number">#a56565</span>);</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.action-a</span><span class="selector-class">.pressed</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#854545</span>, <span class="number">#753535</span>);</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.action-b</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#5a8a5a</span>, <span class="number">#4a7a4a</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.action-b</span><span class="selector-pseudo">:hover</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#6a9a6a</span>, <span class="number">#5a8a5a</span>);</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.action-b</span><span class="selector-class">.pressed</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#3a6a3a</span>, <span class="number">#2a5a2a</span>);</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* æŒ‰é”®æ˜ å°„æ˜¾ç¤º */</span></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.key-mapping-overlay</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: fixed;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.8</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">z-index</span>: <span class="number">1000</span>;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.key-mapping-content</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#8b956d</span>, <span class="number">#9bb583</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-radius</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">max-width</span>: <span class="number">500px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">90%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">max-height</span>: <span class="number">80%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">overflow-y</span>: auto;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.key-mapping-title</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#2c5530</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.key-mapping-table</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-collapse</span>: collapse;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.key-mapping-table</span> <span class="selector-tag">th</span>,</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.key-mapping-table</span> <span class="selector-tag">td</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: left;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#5a6b4d</span>;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.key-mapping-table</span> <span class="selector-tag">th</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#7a8a6d</span>, <span class="number">#6a7a5d</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#2c5530</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.key-mapping-table</span> <span class="selector-tag">td</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">145deg</span>, <span class="number">#9bb583</span>, <span class="number">#8b956d</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#2c5530</span>;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.key-status</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: inline-block;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-right</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.key-status</span><span class="selector-class">.pressed</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="number">#ff4444</span>;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.key-status</span><span class="selector-class">.released</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="number">#44ff44</span>;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.close-btn</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">top</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">right</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: none;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">24px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#2c5530</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.close-btn</span><span class="selector-pseudo">:hover</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* éšè—è™šæ‹Ÿæ‰‹æŸ„ */</span></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.virtual-gamepad</span><span class="selector-class">.hidden</span> {</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* å“åº”å¼è°ƒæ•´ */</span></span></span><br><span class="line"><span class="language-css">  <span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">768px</span>) {</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.virtual-gamepad</span> {</span></span><br><span class="line"><span class="language-css">      <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">gap</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">    }</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.action-button</span> {</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-size</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">    }</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.dpad-button</span> {</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">    }</span></span><br><span class="line"><span class="language-css">  }</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>è™šæ‹Ÿæ‰‹æŸ„æ”¯æŒé¼ æ ‡å’Œè§¦æ‘¸æ“ä½œï¼š</p>
<figure class="highlight html"><figcaption><span>index.HTML</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> virtualGamepadState = {</span></span><br><span class="line"><span class="language-javascript">    pressedButtons = <span class="keyword">new</span> <span class="title class_">Set</span>(),</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">mouseDown</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">  };</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">handleVirtualButtonDown</span>(<span class="params">event</span>) {</span></span><br><span class="line"><span class="language-javascript">    event.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> button = event.<span class="property">currentTarget</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> keyName = button.<span class="property">dataset</span>.<span class="property">key</span>;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (!keyName || virtualGamepadState.<span class="property">pressedButtons</span>.<span class="title function_">has</span>(keyName)) {</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// æ·»åŠ è§†è§‰åé¦ˆ</span></span></span><br><span class="line"><span class="language-javascript">    button.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">'pressed'</span>);</span></span><br><span class="line"><span class="language-javascript">    virtualGamepadState.<span class="property">pressedButtons</span>.<span class="title function_">add</span>(keyName);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// æ¨¡æ‹ŸæŒ‰é”®æŒ‰ä¸‹</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">simulateKeyPress</span>(keyName);</span></span><br><span class="line"><span class="language-javascript">  }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">simulateKeyPress</span>(<span class="params">keyName</span>) {</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (!systemInstance) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">try</span> {</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> system = <span class="variable language_">window</span>.<span class="property">GameBoySystemController</span>.<span class="title function_">getInstance</span>();</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (system &amp;&amp; system.<span class="property">inputController</span>) {</span></span><br><span class="line"><span class="language-javascript">        system.<span class="property">inputController</span>.<span class="title function_">simulateKeyPress</span>(keyName);</span></span><br><span class="line"><span class="language-javascript">      }</span></span><br><span class="line"><span class="language-javascript">    } <span class="keyword">catch</span> (error) {</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`æ¨¡æ‹ŸæŒ‰é”®å¤±è´¥: <span class="subst">${error.message}</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript">  }</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>åœ¨ <code>index.html</code> ä¸­æ·»åŠ ç”¨äºæµ‹è¯•å’Œè°ƒè¯•çš„æ¿å—ï¼š</p>
<figure class="highlight html"><figcaption><span>index.HTML</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- è¾“å…¥æ§åˆ¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"controls"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- è¾“å…¥æµ‹è¯• --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-section"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-title"</span>&gt;</span>ğŸ® è¾“å…¥æ§åˆ¶<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn"</span> <span class="attr">id</span>=<span class="string">"test-input-btn"</span> <span class="attr">disabled</span>&gt;</span>æµ‹è¯•è¾“å…¥ç³»ç»Ÿ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn"</span> <span class="attr">id</span>=<span class="string">"show-input-btn"</span> <span class="attr">disabled</span>&gt;</span>æ˜¾ç¤ºè¾“å…¥çŠ¶æ€<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn"</span> <span class="attr">id</span>=<span class="string">"show-keymapping-btn"</span>&gt;</span>æ˜¾ç¤ºæŒ‰é”®æ˜ å°„<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn"</span> <span class="attr">id</span>=<span class="string">"toggle-virtual-keys-btn"</span>&gt;</span>åˆ‡æ¢è™šæ‹ŸæŒ‰é”®<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"keyboard-hint"</span>&gt;</span></span><br><span class="line">      å¿«æ·é”®ï¼š<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"key"</span>&gt;</span>I<span class="tag">&lt;/<span class="name">span</span>&gt;</span> è¾“å…¥çŠ¶æ€ <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"key"</span>&gt;</span>K<span class="tag">&lt;/<span class="name">span</span>&gt;</span> æŒ‰é”®æ˜ å°„</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- è™šæ‹ŸæŒ‰é”®æ˜¾ç¤º --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"control-section"</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>é¡µé¢æœ€åº•éƒ¨æ·»åŠ æŒ‰é”®æ˜ å°„å¼¹çª—ï¼š</p>
<figure class="highlight html"><figcaption><span>index.HTML</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æŒ‰é”®æ˜ å°„å¼¹çª— --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"key-mapping-overlay"</span> <span class="attr">id</span>=<span class="string">"key-mapping-overlay"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"key-mapping-content"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"close-btn"</span> <span class="attr">id</span>=<span class="string">"close-key-mapping"</span>&gt;</span><span class="symbol">&amp;times;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"key-mapping-title"</span>&gt;</span>ğŸ® GameBoy æŒ‰é”®æ˜ å°„<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"key-mapping-table"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>çŠ¶æ€<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>GameBoy æŒ‰é”®<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>é”®ç›˜æŒ‰é”®<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>åŠŸèƒ½<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">id</span>=<span class="string">"key-mapping-tbody"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- åŠ¨æ€ç”Ÿæˆå†…å®¹ --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"info-box"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h4</span>&gt;</span>ä½¿ç”¨è¯´æ˜ï¼š<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>â€¢ ä½¿ç”¨é”®ç›˜æŒ‰é”®æ§åˆ¶ GameBoy æ¸¸æˆ<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>â€¢ ç»¿ç‚¹è¡¨ç¤ºæŒ‰é”®æœªæŒ‰ä¸‹ï¼Œçº¢ç‚¹è¡¨ç¤ºæŒ‰é”®å·²æŒ‰ä¸‹<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>â€¢ ä¹Ÿå¯ä»¥ç‚¹å‡»è™šæ‹Ÿæ‰‹æŸ„ä¸Šçš„æŒ‰é’®è¿›è¡Œæ§åˆ¶<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>â€¢ æŒ‰ ESC é”®å¯ä»¥å…³é—­æ­¤çª—å£<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight html"><figcaption><span>index.HTML</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// UI å…ƒç´ å¼•ç”¨</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> elements = {</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ...</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// è¾“å…¥ç›¸å…³å…ƒç´ </span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">testInputBtn</span>: <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'test-input-btn'</span>),</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">showInputBtn</span>: <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'show-input-btn'</span>),</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">showKeymappingBtn</span>: <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'show-keymapping-btn'</span>),</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">toggleVirtualKeysBtn</span>: <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'toggle-virtual-keys-btn'</span>),</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// è™šæ‹Ÿæ‰‹æŸ„</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">virtualGamepad</span>: <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'virtual-gamepad'</span>),</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// æŒ‰é”®æ˜ å°„å¼¹çª—</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">keyMappingOverlay</span>: <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'key-mapping-overlay'</span>),</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">keyMappingTbody</span>: <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'key-mapping-tbody'</span>),</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">closeKeyMappingBtn</span>: <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'close-key-mapping'</span>)</span></span><br><span class="line"><span class="language-javascript">  }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// æ›´æ–°æŒ‰é’®çŠ¶æ€</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">updateButtonStates</span>(<span class="params">systemState</span>) {</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ...</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    elements.<span class="property">testInputBtn</span>.<span class="property">disabled</span> = !isInitialized;</span></span><br><span class="line"><span class="language-javascript">    elements.<span class="property">showInputBtn</span>.<span class="property">disabled</span> = !isInitialized;</span></span><br><span class="line"><span class="language-javascript">  }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">initializeVirtualGamePad</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> gamepad = elements.<span class="property">virtualGamepad</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (!gamepad) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// è·å–æ‰€æœ‰è™šæ‹ŸæŒ‰é’®</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> buttons = gamepad.<span class="title function_">querySelectorAll</span>(<span class="string">'[data-key]'</span>);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    buttons.<span class="title function_">forEach</span>(<span class="function"><span class="params">button</span> =&gt;</span> {</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// é¼ æ ‡äº‹ä»¶</span></span></span><br><span class="line"><span class="language-javascript">      button.<span class="title function_">addEventListener</span>(<span class="string">'mousedown'</span>, handleVirtualButtonDown);</span></span><br><span class="line"><span class="language-javascript">      button.<span class="title function_">addEventListener</span>(<span class="string">'mouseup'</span>, handleVirtualButtonUp);</span></span><br><span class="line"><span class="language-javascript">      button.<span class="title function_">addEventListener</span>(<span class="string">'mouseleave'</span>, handleVirtualButtonUp);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨è®¾å¤‡æ”¯æŒï¼‰</span></span></span><br><span class="line"><span class="language-javascript">      button.<span class="title function_">addEventListener</span>(<span class="string">'touchstart'</span>, handleVirtualButtonDown);</span></span><br><span class="line"><span class="language-javascript">      button.<span class="title function_">addEventListener</span>(<span class="string">'touchend'</span>, handleVirtualButtonUp);</span></span><br><span class="line"><span class="language-javascript">      button.<span class="title function_">addEventListener</span>(<span class="string">'touchcancel'</span>, handleVirtualButtonUp);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// é˜²æ­¢é»˜è®¤è¡Œä¸º</span></span></span><br><span class="line"><span class="language-javascript">      button.<span class="title function_">addEventListener</span>(<span class="string">'contextmenu'</span>, <span class="function"><span class="params">e</span> =&gt;</span> e.<span class="title function_">preventDefault</span>());</span></span><br><span class="line"><span class="language-javascript">      button.<span class="title function_">addEventListener</span>(<span class="string">'selectstart'</span>, <span class="function"><span class="params">e</span> =&gt;</span> e.<span class="title function_">preventDefault</span>());</span></span><br><span class="line"><span class="language-javascript">    });</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'ğŸ•¹ï¸ è™šæ‹Ÿæ‰‹æŸ„å·²åˆå§‹åŒ–'</span>);</span></span><br><span class="line"><span class="language-javascript">  }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">handleVirtualButtonUp</span>(<span class="params">event</span>) {</span></span><br><span class="line"><span class="language-javascript">    event.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> button = event.<span class="property">currentTarget</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> keyName = button.<span class="property">dataset</span>.<span class="property">key</span>;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (!keyName || !virtualGamepadState.<span class="property">pressedButtons</span>.<span class="title function_">has</span>(keyName)) {</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ç§»é™¤è§†è§‰åé¦ˆ</span></span></span><br><span class="line"><span class="language-javascript">    button.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">'pressed'</span>);</span></span><br><span class="line"><span class="language-javascript">    virtualGamepadState.<span class="property">pressedButtons</span>.<span class="title function_">delete</span>(keyName);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// æ¨¡æ‹ŸæŒ‰é”®é‡Šæ”¾</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">simulateKeyRelease</span>(keyName);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">DEBUG_MODE</span>) {</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ğŸ”“ è™šæ‹ŸæŒ‰é’®é‡Šæ”¾: <span class="subst">${keyName}</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript">  }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">simulateKeyRelease</span>(<span class="params">keyName</span>) {</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (!systemInstance) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">try</span> {</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> system = <span class="variable language_">window</span>.<span class="property">GameBoySystemController</span>.<span class="title function_">getInstance</span>();</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (system &amp;&amp; system.<span class="property">inputController</span>) {</span></span><br><span class="line"><span class="language-javascript">        system.<span class="property">inputController</span>.<span class="title function_">simulateKeyRelease</span>(keyName);</span></span><br><span class="line"><span class="language-javascript">      }</span></span><br><span class="line"><span class="language-javascript">    } <span class="keyword">catch</span> (error) {</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`æ¨¡æ‹ŸæŒ‰é”®é‡Šæ”¾å¤±è´¥: <span class="subst">${error.message}</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript">  }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// è¾“å…¥æ§åˆ¶å‡½æ•°</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">testInputSystem</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (!systemInstance) {</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">addLog</span>(<span class="string">'âŒ ç³»ç»Ÿæœªåˆå§‹åŒ–'</span>, <span class="string">'error'</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">try</span> {</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> system = <span class="variable language_">window</span>.<span class="property">GameBoySystemController</span>.<span class="title function_">getInstance</span>();</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (system &amp;&amp; system.<span class="property">inputController</span>) {</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">addLog</span>(<span class="string">'ğŸ§ª å¼€å§‹è¾“å…¥ç³»ç»Ÿæµ‹è¯•...'</span>, <span class="string">'debug'</span>);</span></span><br><span class="line"><span class="language-javascript">        system.<span class="title function_">testInputSystem</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">addLog</span>(<span class="string">'âœ… è¾“å…¥ç³»ç»Ÿæµ‹è¯•å·²å¯åŠ¨ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º'</span>, <span class="string">'success'</span>);</span></span><br><span class="line"><span class="language-javascript">      } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">addLog</span>(<span class="string">'âŒ è¾“å…¥æ§åˆ¶å™¨æœªåˆå§‹åŒ–'</span>, <span class="string">'error'</span>);</span></span><br><span class="line"><span class="language-javascript">      }</span></span><br><span class="line"><span class="language-javascript">    } <span class="keyword">catch</span> (error) {</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">addLog</span>(<span class="string">`âŒ è¾“å…¥ç³»ç»Ÿæµ‹è¯•å¤±è´¥: <span class="subst">${error.message}</span>`</span>, <span class="string">'error'</span>);</span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript">  }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">showInputStatus</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (!systemInstance) {</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">addLog</span>(<span class="string">'âŒ ç³»ç»Ÿæœªåˆå§‹åŒ–'</span>, <span class="string">'error'</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">try</span> {</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> system = <span class="variable language_">window</span>.<span class="property">GameBoySystemController</span>.<span class="title function_">getInstance</span>();</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (system &amp;&amp; system.<span class="property">inputController</span>) {</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">addLog</span>(<span class="string">'ğŸ® === è¾“å…¥ç³»ç»ŸçŠ¶æ€ ==='</span>, <span class="string">'debug'</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">addLog</span>(system.<span class="property">inputController</span>.<span class="title function_">getDebugInfo</span>(), <span class="string">'debug'</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">addLog</span>(<span class="string">'==================='</span>, <span class="string">'debug'</span>);</span></span><br><span class="line"><span class="language-javascript">      } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">addLog</span>(<span class="string">'âŒ è¾“å…¥æ§åˆ¶å™¨æœªåˆå§‹åŒ–'</span>, <span class="string">'error'</span>);</span></span><br><span class="line"><span class="language-javascript">      }</span></span><br><span class="line"><span class="language-javascript">    } <span class="keyword">catch</span> (error) {</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">addLog</span>(<span class="string">`âŒ è·å–è¾“å…¥çŠ¶æ€å¤±è´¥: <span class="subst">${error.message}</span>`</span>, <span class="string">'error'</span>);</span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript">  }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">showKeyMapping</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">updateKeyMappingDisplay</span>();</span></span><br><span class="line"><span class="language-javascript">    elements.<span class="property">keyMappingOverlay</span>.<span class="property">style</span>.<span class="property">display</span> = <span class="string">'flex'</span>;</span></span><br><span class="line"><span class="language-javascript">  }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">hideKeyMapping</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">    elements.<span class="property">keyMappingOverlay</span>.<span class="property">style</span>.<span class="property">display</span> = <span class="string">'none'</span>;</span></span><br><span class="line"><span class="language-javascript">  }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">toggleVirtualKeys</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> gamepad = elements.<span class="property">virtualGamepad</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> isHidden = gamepad.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">'hidden'</span>);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (isHidden) {</span></span><br><span class="line"><span class="language-javascript">      gamepad.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">'hidden'</span>);</span></span><br><span class="line"><span class="language-javascript">      elements.<span class="property">toggleVirtualKeysBtn</span>.<span class="property">textContent</span> = <span class="string">'éšè—è™šæ‹ŸæŒ‰é”®'</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">addLog</span>(<span class="string">'ğŸ‘€ è™šæ‹ŸæŒ‰é”®å·²æ˜¾ç¤º'</span>, <span class="string">'info'</span>);</span></span><br><span class="line"><span class="language-javascript">    } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="language-javascript">      gamepad.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">'hidden'</span>);</span></span><br><span class="line"><span class="language-javascript">      elements.<span class="property">toggleVirtualKeysBtn</span>.<span class="property">textContent</span> = <span class="string">'æ˜¾ç¤ºè™šæ‹ŸæŒ‰é”®'</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">addLog</span>(<span class="string">'ğŸ™ˆ è™šæ‹ŸæŒ‰é”®å·²éšè—'</span>, <span class="string">'info'</span>);</span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript">  }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">updateKeyMappingDisplay</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (!systemInstance) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">try</span> {</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> system = <span class="variable language_">window</span>.<span class="property">GameBoySystemController</span>.<span class="title function_">getInstance</span>();</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!system || !system.<span class="property">inputController</span>) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> mappings = system.<span class="property">inputController</span>.<span class="title function_">getKeyMappings</span>();</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> tbody = elements.<span class="property">keyMappingTbody</span>;</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      tbody.<span class="property">innerHTML</span> = <span class="string">''</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      mappings.<span class="title function_">forEach</span>(<span class="function"><span class="params">mapping</span> =&gt;</span> {</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> row = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">'tr'</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> statusClass = mapping.<span class="property">isPressed</span> ? <span class="string">'pressed'</span> : <span class="string">'released'</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> statusText = mapping.<span class="property">isPressed</span> ? <span class="string">'æŒ‰ä¸‹'</span> : <span class="string">'æœªæŒ‰ä¸‹'</span>;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        row.<span class="property">innerHTML</span> = <span class="string">`</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">          &lt;td&gt;&lt;span class="key-status <span class="subst">${statusClass}</span>"&gt;&lt;/span&gt;<span class="subst">${statusText}</span>&lt;/td&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">          &lt;td&gt;&lt;strong&gt;<span class="subst">${mapping.gameboyKey}</span>&lt;/strong&gt;&lt;/td&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">          &lt;td&gt;&lt;kbd&gt;<span class="subst">${mapping.keyboardKey}</span>&lt;/kbd&gt;&lt;/td&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">          &lt;td&gt;<span class="subst">${getKeyFunction(mapping.gameboyKey)}</span>&lt;/td&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">        `</span>;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        tbody.<span class="title function_">appendChild</span>(row);</span></span><br><span class="line"><span class="language-javascript">      });</span></span><br><span class="line"><span class="language-javascript">    } <span class="keyword">catch</span> (error) {</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">'æ›´æ–°æŒ‰é”®æ˜ å°„æ˜¾ç¤ºå¤±è´¥:'</span>, error);</span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript">  }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">getKeyFunction</span>(<span class="params">gameboyKey</span>) {</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> functions = {</span></span><br><span class="line"><span class="language-javascript">      <span class="string">'A'</span>: <span class="string">'ç¡®è®¤/æ”»å‡»'</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="string">'B'</span>: <span class="string">'å–æ¶ˆ/è·³è·ƒ'</span>, </span></span><br><span class="line"><span class="language-javascript">      <span class="string">'Start'</span>: <span class="string">'å¼€å§‹/æš‚åœ'</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="string">'Select'</span>: <span class="string">'é€‰æ‹©/åˆ‡æ¢'</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="string">'Up'</span>: <span class="string">'å‘ä¸Šç§»åŠ¨'</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="string">'Down'</span>: <span class="string">'å‘ä¸‹ç§»åŠ¨'</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="string">'Left'</span>: <span class="string">'å‘å·¦ç§»åŠ¨'</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="string">'Right'</span>: <span class="string">'å‘å³ç§»åŠ¨'</span></span></span><br><span class="line"><span class="language-javascript">    };</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> functions[gameboyKey] || <span class="string">'æœªçŸ¥åŠŸèƒ½'</span>;</span></span><br><span class="line"><span class="language-javascript">  }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// æ€§èƒ½ç›‘æ§</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">startPerformanceMonitoring</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ...</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// å¯åŠ¨æŒ‰é”®çŠ¶æ€ç›‘æ§ï¼Œæ¯ç§’æ›´æ–°ä¸€æ¬¡æŒ‰é”®æ˜ å°„æ˜¾ç¤º</span></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(updateKeyMappingDisplay, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript">  }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// ç»‘å®šäº‹ä»¶ç›‘å¬å™¨</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">bindEventListeners</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ...</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// æŒ‰é”®æ˜ å°„å¼¹çª—çš„ESCé”®å…³é—­</span></span></span><br><span class="line"><span class="language-javascript">    elements.<span class="property">keyMappingOverlay</span>.<span class="title function_">addEventListener</span>(<span class="string">'click'</span>, <span class="keyword">function</span>(<span class="params">event</span>) {</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (event.<span class="property">target</span> === elements.<span class="property">keyMappingOverlay</span>) {</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">hideKeyMapping</span>();</span></span><br><span class="line"><span class="language-javascript">      }</span></span><br><span class="line"><span class="language-javascript">    });</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// åˆå§‹åŒ–è™šæ‹Ÿæ‰‹æŸ„</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">initializeVirtualGamepad</span>();</span></span><br><span class="line"><span class="language-javascript">  }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// é”®ç›˜å¿«æ·é”®</span></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">'keydown'</span>, <span class="keyword">function</span>(<span class="params">event</span>) {</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// é˜²æ­¢åœ¨è¾“å…¥æ¡†ä¸­è§¦å‘å¿«æ·é”®</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (event.<span class="property">target</span>.<span class="property">tagName</span> === <span class="string">'INPUT'</span>) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// å¦‚æœæŒ‰é”®æ˜ å°„å¼¹çª—æ‰“å¼€ï¼ŒESCé”®å…³é—­</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (elements.<span class="property">keyMappingOverlay</span>.<span class="property">style</span>.<span class="property">display</span> === <span class="string">'flex'</span> &amp;&amp; event.<span class="property">code</span> === <span class="string">'Escape'</span>) {</span></span><br><span class="line"><span class="language-javascript">      event.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">hideKeyMapping</span>();</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">switch</span>(event.<span class="property">code</span>) {</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// ...</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">case</span> <span class="string">'KeyI'</span>:</span></span><br><span class="line"><span class="language-javascript">        event.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">showInputStatus</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">case</span> <span class="string">'KeyK'</span>:</span></span><br><span class="line"><span class="language-javascript">        event.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">showKeyMapping</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">case</span> <span class="string">'Escape'</span>:</span></span><br><span class="line"><span class="language-javascript">        event.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (elements.<span class="property">keyMappingOverlay</span>.<span class="property">style</span>.<span class="property">display</span> === <span class="string">'flex'</span>) {</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">hideKeyMapping</span>();</span></span><br><span class="line"><span class="language-javascript">        }</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript">  });</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–</span></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">'load'</span>, <span class="keyword">function</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">bindEventListeners</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// æ£€æŸ¥ç»„ä»¶åŠ è½½çŠ¶æ€</span></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> {</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> components = [</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// ...</span></span></span><br><span class="line"><span class="language-javascript">        { <span class="attr">name</span>: <span class="string">'è¾“å…¥æ§åˆ¶å™¨'</span>, <span class="attr">check</span>: <span class="function">() =&gt;</span> <span class="keyword">typeof</span> <span class="title class_">GameBoyInputController</span> !== <span class="string">'undefined'</span> }</span></span><br><span class="line"><span class="language-javascript">      ];</span></span><br><span class="line"><span class="language-javascript">    });</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ...</span></span></span><br><span class="line"><span class="language-javascript">  });</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<!-- flag of hidden posts --></body></html></div></article></div></main><footer><div class="paginator"></div><!-- Webmention æ˜¾ç¤ºåŒºåŸŸ--><div class="webmention-section webmention-empty" data-page-url="posts/c4d6.html" data-full-url="https://cytrogen.icu/posts/c4d6.html" data-mode="static">
              <h3 class="webmention-title">Webmentions (<span class="webmention-count">0</span>)</h3>
              <div class="webmention-list"></div>
              <span>æš‚æ—  Webmentions</span>
            </div><div class="copyright"><p>Â© 2025 - 2026 <a href="https://cytrogen.icu">Cytrogen</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/cytrogen/hexo-theme-ares" target="_blank">hexo-theme-ares</a>.</p></div></footer></div></div><a class="back-to-top" href="#top" aria-label="è¿”å›é¡¶éƒ¨"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M3.293 9.707a1 1 0 010-1.414L9.586 2a2 2 0 012.828 0l6.293 6.293a1 1 0 01-1.414 1.414L11 3.414V17a1 1 0 11-2 0V3.414L2.707 9.707a1 1 0 01-1.414 0z"></path></svg></a><script>document.addEventListener('DOMContentLoaded', function() {
  const codeBlocks = document.querySelectorAll('figure.highlight');
  
  codeBlocks.forEach(block => {
    let caption = block.querySelector('figcaption');
    if (!caption) {
      caption = document.createElement('figcaption');
      block.insertBefore(caption, block.firstChild);
    }

    const info = document.createElement('div');
    info.className = 'info';
    
    const filename = caption.querySelector('span');
    if (filename) {
      filename.className = 'filename';
      info.appendChild(filename);
    }
    
    const lang = block.className.split(' ')[1];
    if (lang) {
      const langSpan = document.createElement('span');
      langSpan.className = 'lang-name';
      langSpan.textContent = lang;
      info.appendChild(langSpan);
    }

    const sourceLink = caption.querySelector('a');
    if (sourceLink) {
      sourceLink.className = 'source-link';
      info.appendChild(sourceLink);
    }

    const actions = document.createElement('div');
    actions.className = 'actions';

    const codeHeight = block.scrollHeight;
    const threshold = 300;

    if (codeHeight > threshold) {
      block.classList.add('folded');
      
      const toggleBtn = document.createElement('button');
      toggleBtn.textContent = 'å±•å¼€';
      toggleBtn.addEventListener('click', () => {
        block.classList.toggle('folded');
        toggleBtn.textContent = block.classList.contains('folded') ? 'å±•å¼€' : 'æŠ˜å ';
      });
      actions.appendChild(toggleBtn);
    }

    const copyBtn = document.createElement('button');
    copyBtn.textContent = 'å¤åˆ¶';
    copyBtn.addEventListener('click', async () => {
      const codeLines = block.querySelectorAll('.code .line');
      const code = Array.from(codeLines)
        .map(line => line.textContent)
        .join('\n')
        .replace(/\n\n/g, '\n');
      
      try {
        await navigator.clipboard.writeText(code);
        copyBtn.textContent = 'å·²å¤åˆ¶';
        copyBtn.classList.add('copied');
        
        setTimeout(() => {
          copyBtn.textContent = 'å¤åˆ¶';
          copyBtn.classList.remove('copied');
        }, 3000);
      } catch (err) {
        console.error('å¤åˆ¶å¤±è´¥:', err);
        copyBtn.textContent = 'å¤åˆ¶å¤±è´¥';
        
        setTimeout(() => {
          copyBtn.textContent = 'å¤åˆ¶';
        }, 3000);
      }
    });
    actions.appendChild(copyBtn);

    caption.innerHTML = '';
    caption.appendChild(info);
    caption.appendChild(actions);

    const markedLines = block.getAttribute('data-marked-lines');
    if (markedLines) {
      const lines = markedLines.split(',');
      lines.forEach(range => {
        if (range.includes('-')) {
          const [start, end] = range.split('-').map(Number);
          for (let i = start; i <= end; i++) {
            const line = block.querySelector(`.line-${i}`);
            if (line) line.classList.add('marked');
          }
        } else {
          const line = block.querySelector(`.line-${range}`);
          if (line) line.classList.add('marked');
        }
      });
    }
  });
});</script><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script><script>(function() {
  document.addEventListener('DOMContentLoaded', function() {
    const themeToggle = document.querySelector('.theme-toggle');
    
    if (!themeToggle) return;
    
    const getCurrentTheme = () => {
      return document.documentElement.getAttribute('data-theme') || 'light';
    };
    
    const updateUI = (theme) => {
      const isDark = theme === 'dark';
      themeToggle.setAttribute('aria-pressed', isDark.toString());
    };
    
    const setTheme = (theme) => {
      document.documentElement.setAttribute('data-theme', theme);
      document.documentElement.style.colorScheme = theme;
      
      const pageWrapper = document.getElementById('page-wrapper');
      if (pageWrapper) {
        pageWrapper.setAttribute('data-theme', theme);
      }
      
      // Find and remove the temporary anti-flicker style tag if it exists.
      // This ensures the main stylesheet takes full control after the initial load.
      const antiFlickerStyle = document.getElementById('anti-flicker-style');
      if (antiFlickerStyle) {
        antiFlickerStyle.remove();
      }
      
      localStorage.setItem('theme', theme);
      updateUI(theme);
    };
    
    const toggleTheme = () => {
      const current = getCurrentTheme();
      const newTheme = current === 'light' ? 'dark' : 'light';
      setTheme(newTheme);
    };
    
    updateUI(getCurrentTheme());
    
    themeToggle.addEventListener('click', toggleTheme);
    
    if (window.matchMedia) {
      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
      mediaQuery.addEventListener('change', function(e) {
        if (!localStorage.getItem('theme')) {
          const theme = e.matches ? 'dark' : 'light';
          setTheme(theme);
        }
      });
    }
  });
})();
</script><script src="../js/details-toggle.js" defer></script><script>(function() {
  document.addEventListener('DOMContentLoaded', function() {
    const backToTopBtn = document.querySelector('.back-to-top');
    
    if (!backToTopBtn) return;
    
    const toggleButtonVisibility = () => {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const shouldShow = scrollTop > 200;
      
      if (shouldShow) {
        backToTopBtn.classList.add('is-visible');
      } else {
        backToTopBtn.classList.remove('is-visible');
      }
    };
    
    let ticking = false;
    const handleScroll = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          toggleButtonVisibility();
          ticking = false;
        });
        ticking = true;
      }
    };
    
    const scrollToTop = (event) => {
      event.preventDefault();
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    };
    
    window.addEventListener('scroll', handleScroll);
    backToTopBtn.addEventListener('click', scrollToTop);
    
    toggleButtonVisibility();
  });
})();</script></body></html>