<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>IBM全栈开发【13·上】：全栈应用程序开发者毕业设计 · Cytrogen 的个人博客</title><meta name="description" content="本文是 IBM 全栈开发毕业设计项目的实战笔记（上篇），旨在对已有的“Best Cars”汽车经销商应用进行功能增强。内容分为三大模块：首先，对 React 前端进行体验优化，包括将静态下拉菜单改为动态搜索框并美化UI；接着，使用 Node.js、Express 和 MongoDB 从零构建一个全新的、容器化的汽车库存后端微服务；最后，开发新的 React 前端组件，与后端服务集成，实现按品牌、型号、年份等多条件筛选汽车库存的动态功能。这篇笔记全面展示了在一个真实全-stack项目中进行功能迭代、构建新服务并完成前后端集成的完整流程。"><link rel="icon" href="../favicon.png"><link rel="preload" href="../fonts/opensans-regular-latin.woff2" as="font" type="font/woff2" crossorigin="anonymous"><style>@font-face {
  font-family: 'Open Sans';
  src: url('../fonts/opensans-regular-latin.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
  size-adjust: 107%;
  ascent-override: 97%;
  descent-override: 25%;
  line-gap-override: 0%;
}
</style><link rel="stylesheet" href="../css/ares.css"><script>(function() {
  const getInitialTheme = () => {
    const saved = localStorage.getItem('theme');
    if (saved && (saved === 'light' || saved === 'dark')) {
      return saved;
    }
    
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
    
    return 'light';
  };
  
  const theme = getInitialTheme();
  document.documentElement.setAttribute('data-theme', theme);
  
  document.documentElement.style.colorScheme = theme;
  
  // Add anti-flicker style for dark mode
  if (theme === 'dark') {
    const style = document.createElement('style');
    style.id = 'anti-flicker-style';
    style.innerHTML = `
      #page-wrapper[data-theme="dark"] {
        background-color: #0f172a;
        color: #f1f5f9;
      }
    `;
    document.head.appendChild(style);
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    const pageWrapper = document.getElementById('page-wrapper');
    if (pageWrapper) {
      pageWrapper.setAttribute('data-theme', theme);
    }
  });
})();

</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="atom.xml" title="Cytrogen 的个人博客" type="application/atom+xml">
</head><body><div id="page-wrapper"><a class="skip-link" href="#main-content">跳到主要内容</a><div class="wrap"><header><a class="logo-link" href="../index.html"><img src="../favicon.png" alt="logo"></a><nav class="site-nav"><div class="nav-main"><div class="nav-primary"><ul class="nav-list hidden-mobile"><li class="nav-item"><a class="nav-link" href="../index.html">首页</a></li></ul><div class="nav-tools"><div class="language-menu"><button class="language-toggle" type="button"><svg class="icon icon-globe" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" focusable="false"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4a9.267 9.267 0 0 1 .64-1.539 6.7 6.7 0 0 1 .597-.933A7.025 7.025 0 0 0 2.255 4H4.09zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a6.958 6.958 0 0 0-.656 2.5h2.49zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5H4.847zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5H4.51zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12c.138.386.295.744.468 1.068.552 1.035 1.218 1.65 1.887 1.855V12H5.145zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11a13.652 13.652 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5H3.82zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855A7.97 7.97 0 0 0 10.855 12H8.5zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5a6.959 6.959 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5h2.49zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4a7.966 7.966 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4h2.355z"></path></svg><span>中文</span></button><div class="language-dropdown"></div></div></div><div class="nav-controls"><div class="more-menu hidden-mobile"><button class="more-toggle" type="button"><span>更多</span><svg class="icon icon-chevron-down" width="12" height="12" viewBox="0 0 12 12" fill="currentColor" aria-hidden="true" focusable="false"><path d="M6 8.825c-.2 0-.4-.1-.5-.2l-3.3-3.3c-.3-.3-.3-.8 0-1.1s.8-.3 1.1 0l2.7 2.7 2.7-2.7c.3-.3.8-.3 1.1 0s.3.8 0 1.1l-3.3 3.3c-.1.1-.3.2-.5.2z"></path></svg></button><div class="more-dropdown"><ul class="dropdown-list"><li class="dropdown-item"><a class="nav-link" href="../archives">归档</a></li><li class="dropdown-item"><a class="nav-link" href="../categories">分类</a></li><li class="dropdown-item"><a class="nav-link" href="../tags">标签</a></li><li class="dropdown-item"><a class="nav-link" href="../about">关于</a></li><li class="dropdown-item"><a class="nav-link" href="../friends">友链</a></li><li class="dropdown-item"><a class="nav-link" href="../atom.xml">RSS订阅</a></li><li class="dropdown-item"><a class="dropdown-link" href="https://portfolio.cytrogen.icu" target="_blank" rel="noopener noreferrer">作品集<svg class="icon icon-external-link" width="14" height="14" viewBox="0 0 14 14" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8.636 2.364A1 1 0 0 1 10 1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V3.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 2H9a1 1 0 0 1-1.364-1.636zM2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 1 1 2 0v3a3 3 0 0 1-3 3H2a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3h3a1 1 0 1 1 0 2H2z"></path></svg></a></li><li class="dropdown-item"><a class="dropdown-link" href="https://github.com/cytrogen" target="_blank" rel="noopener noreferrer">GitHub<svg class="icon icon-external-link" width="14" height="14" viewBox="0 0 14 14" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8.636 2.364A1 1 0 0 1 10 1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V3.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 2H9a1 1 0 0 1-1.364-1.636zM2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 1 1 2 0v3a3 3 0 0 1-3 3H2a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3h3a1 1 0 1 1 0 2H2z"></path></svg></a></li></ul></div></div><div class="theme-switcher"><button class="theme-toggle" type="button" role="switch" aria-pressed="false" aria-label="切换主题"><div class="theme-icon moon-icon"><svg class="icon icon-moon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" focusable="false"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path></svg></div><div class="theme-icon sun-icon"><svg class="icon icon-sun" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></svg></div></button></div><details class="mobile-menu-details hidden-desktop"><summary class="hamburger-menu" aria-label="nav.menu"><svg class="icon icon-bars" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" focusable="false"><path d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"></path></svg><span class="menu-text">nav.menu</span></summary><div class="mobile-menu-dropdown"><ul class="mobile-nav-list"><li class="mobile-nav-item"><a class="mobile-nav-link" href="../index.html">首页</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../archives">归档</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../categories">分类</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../tags">标签</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../about">关于</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../friends">友链</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../atom.xml">RSS订阅</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="https://portfolio.cytrogen.icu" target="_blank" rel="noopener noreferrer">作品集<svg class="icon icon-external-link" width="14" height="14" viewBox="0 0 14 14" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8.636 2.364A1 1 0 0 1 10 1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V3.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 2H9a1 1 0 0 1-1.364-1.636zM2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 1 1 2 0v3a3 3 0 0 1-3 3H2a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3h3a1 1 0 1 1 0 2H2z"></path></svg></a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="https://github.com/cytrogen" target="_blank" rel="noopener noreferrer">GitHub<svg class="icon icon-external-link" width="14" height="14" viewBox="0 0 14 14" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8.636 2.364A1 1 0 0 1 10 1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V3.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 2H9a1 1 0 0 1-1.364-1.636zM2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 1 1 2 0v3a3 3 0 0 1-3 3H2a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3h3a1 1 0 1 1 0 2H2z"></path></svg></a></li></ul></div></details></div></div></div></nav></header><main class="container" id="main-content" tabindex="-1"><div class="post"><article class="post-block"><h1 class="post-title">IBM全栈开发【13·上】：全栈应用程序开发者毕业设计</h1><div class="post-info">7/7/2024</div><div class="post-content"><p>近期在学习IBM全栈应用开发微学士课程，故此记录学习笔记。</p>
<span id="more"></span>
<p>恭喜您成功完成 IBM 全栈软件开发人员专业证书的所有前面课程！现在是通过完成期末考试来检验您的新技能的时候了。</p>
<p>您将通过考试，了解自己在 PC 各门课程中学到的知识。现在，您应该已经熟练掌握了以下主题：</p>
<ul>
<li>云计算的核心概念</li>
<li>网页开发语言，包括 HTML、CSS 和 JavaScript</li>
<li>Git 和 GitHub</li>
<li>Node.js、Express 和 React</li>
<li>容器</li>
<li>Python</li>
<li>数据库概念和相关技术，如 SQL 和 Django</li>
<li>微服务和无服务器计算</li>
</ul>
<p>这是 IBM 全栈软件开发人员专业证书的最后一门课程。它将测试您迄今为止所掌握的知识和技能。本课程包含分级期末考试，涵盖 PC 中各种课程的内容。</p>
<p>您将就以下主题接受评估：核心云计算概念；HTML、CSS、JavaScript 和 Python 等语言；Node.js、Express 和 React 等框架；以及 Docker、Kubernetes、OpenShift、SQL、Django、微服务和 Serverless 等后端技术。</p>
<p>在学习本课程之前，请确保您已完成 IBM 全栈开发人员专业证书中的所有先前课程。</p>
<h1 id="通过附加功能丰富汽车经销商门户网站"><a class="markdownIt-Anchor" href="#通过附加功能丰富汽车经销商门户网站"></a> 通过附加功能丰富汽车经销商门户网站</h1>
<p>该课程从模块开始：通过三个实验丰富汽车经销商门户网站的附加功能。</p>
<p>在“全栈应用程序开发项目”（可见<a href="/posts/fa4d.html">文章</a>）中，您创建了一个汽车经销商应用程序，需要开发前端页面、用户管理、构建数据库操作动作、创建后端服务以及配置 CI/CD 管道。前端使用的技术包括 HTML、CSS、JavaScript 和 React，后端使用的技术包括 Django、Node.js、NoSQL（Mongo）、容器化、IBM 代码引擎、Python 和 Kubernetes。</p>
<p>通过汽车经销商应用程序，我们可以根据经销商的 ID 查看所有经销商的详细信息和评论，还可以注册、登录为用户，并在注册或登录后为特定经销商添加新的评论，方法是将 <code>About</code> 和 <code>Contact Us</code> 等静态页面整合到一起。</p>
<p>用户注册和登录功能也是在为端点和 Django 视图配置了 Express-Mongo 后端微服务后实现的。还集成了一个情感分析微服务来分析评论。也实现了各种功能，如显示经销商列表、详细信息和评论，在 Django 应用程序中添加新的经销商评论。最后，将 CI/CD Linting 服务集成到应用程序中，并部署到 Kubernetes 上。</p>
<p>在本课程中，您将从增强同一个汽车经销商应用程序开始。改进的重点是前端方面，然后通过添加新的微服务转移到后端，最后在后续实验中将其与前端集成。</p>
<p>强烈建议先完成全栈应用程序开发项目课程，然后再学习本课程，因为本模块的实验是增强已建应用程序的一部分。虽然这些内容不属于评分标准的一部分，但它们对于增强你的理解和技能仍然很有价值。</p>
<h2 id="概述"><a class="markdownIt-Anchor" href="#概述"></a> 概述</h2>
<p>作为毕业设计项目的一部分，您已经成功创建并测试了 <code>Car Dealerships website</code>，确保其符合预期功能。这包括允许用户查看所有经销商的详细信息、查看对特定经销商的现有评论，以及在作为注册用户登录后发布对特定经销商的新评论。</p>
<p>完成上述工作后，下一步就是增强应用程序的功能。这涉及到应用程序的前端和后端方面。如下所述，您将分三部分实施这些增强功能：</p>
<ol>
<li>
<p>前端改进</p>
<ul>
<li>将 <code>Dealerships</code> 页面上的 <code>States</code> 下拉菜单转换为可搜索文本框，使用户能够通过输入搜索字符串来筛选经销商。</li>
<li>改进应用程序主页上导航栏和经销商按钮的配色方案，以及 <code>Dealerships Review</code> 页面上审查面板和审查图标的颜色。</li>
<li>微调经销商审查面板的视觉元素，对字体大小和字体对齐方式等方面进行调整。</li>
</ul>
</li>
<li>
<p>汽车库存后端服务</p>
<ul>
<li>使用 MongoDB 和 Node.js 服务器建立一个新的后端微型服务，专门用于获取与汽车库存相关的各种详细信息。</li>
<li>将新创建的微服务与 Django 应用程序的后端集成，并验证后端服务器的成功启动。</li>
</ul>
</li>
<li>
<p>汽车库存服务的前端开发</p>
<ul>
<li>开发前端组件，并将其与<a href="#%E7%AC%AC-2-%E9%83%A8%E5%88%86%E6%B1%BD%E8%BD%A6%E5%BA%93%E5%AD%98%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1">第 2 部分：汽车库存后端服务</a>中开发的后端汽车库存微服务集成。</li>
<li>创建一个按<strong>品牌</strong>、<strong>型号</strong>、<strong>年份</strong>、<strong>里程</strong>和<strong>价格</strong>选择汽车的选项。</li>
<li>对 Django 应用程序与集成的汽车库存服务生成的输出进行全面测试。</li>
</ul>
</li>
</ol>
<h2 id="前端改进"><a class="markdownIt-Anchor" href="#前端改进"></a> 前端改进</h2>
<h4 id="将-dealerships-页面上的-states-下拉菜单转换为可搜索文本框"><a class="markdownIt-Anchor" href="#将-dealerships-页面上的-states-下拉菜单转换为可搜索文本框"></a> 将 <code>Dealerships</code> 页面上的 <code>States</code> 下拉菜单转换为可搜索文本框</h4>
<ol>
<li>访问 <code>frontend/src/components/Dealers/Dealers.jsx</code> 文件。</li>
<li>您会注意到，经销商下拉菜单的代码是在 <code>&lt;select&gt;</code> 下拉菜单元素中显示的：<pre><code class="language-jsx">&lt;select name=&quot;state&quot; id=&quot;state&quot; onChange=&#123;(e) =&gt; filterDealers(e.target.value)&#125;&gt;
&lt;/select&gt;</code></pre>
</li>
<li>用包含以下属性的 <code>&lt;input&gt;</code> 字段取代现有的 <code>&lt;select&gt;</code> 元素：
<ul>
<li>用户可在文本框中输入搜索州。</li>
<li>根据输入的搜索查询过滤显示的经销商，并与州匹配。</li>
<li>当输入框失去焦点时，将显示的经销商重置为原始列表。</li>
</ul>
<pre><code class="language-jsx">&lt;input type=&quot;text&quot; placeholder=&quot;Search states...&quot; onChange=&#123;handleInputChange&#125; onBlur=&#123;handleLostFocus&#125; value=&#123;searchQuery&#125; /&gt;</code></pre>
</li>
</ol>
<p>观察输入元素中的函数。现在，让我们创建它们。</p>
<ol>
<li>创建一个名为 <code>handleInputChange</code> 的新函数，用于管理输入更改，并根据输入的状态查询过滤经销商。<pre><code class="language-jsx">const handleInputChange = (event) =&gt; &#123;
  const query = event.target.value;
  setSearchQuery(query);
  const filtered = originalDealers.filter(dealer =&gt;
    dealer.state.toLowerCase().includes(query.toLowerCase())
  );
  setDealersList(filtered);
&#125;;</code></pre>
<ul>
<li>每次输入框内的值发生变化时，都会触发该函数。</li>
<li>它会检索用户在输入框中输入的当前值，并将其作为查询存储在 <code>setSearchQuery</code> 变量中，用于筛选经销商。</li>
<li>系统会生成一个新数组，其中只包含状态与输入的查询相匹配的经销商。</li>
<li>通过将查询和经销商状态转换为小写，使其大小写不敏感，从而确保用户获得更友好的搜索体验。</li>
<li>然后，该函数将显示与输入的状态查询相匹配的经销商。</li>
</ul>
</li>
<li>总之，<code>handleInputChange</code> 函数可根据用户在搜索栏中的输入动态过滤经销商列表。它实时更新显示的经销商列表，为用户提供响应式搜索功能。</li>
<li>创建 <code>handleLostFocus</code> 函数，以确保当用户将搜索输入留空并点击或滑动标签离开时，经销商列表会重置为原始列表。<pre><code class="language-jsx">const handleLostFocus = () =&gt; &#123;
  if (!searchQuery) &#123;
    setDealersList(originalDealers);
  &#125;
&#125;</code></pre>
<ul>
<li>该函数在执行时验证 <code>searchQuery</code> 状态是否为空。</li>
<li>如果 <code>searchQuery</code> 确实为空，它就会将经销商列表恢复到开始搜索前的原始状态。</li>
<li><code>handleLostFocus</code> 函数在用户点击输入框外或标签页离开输入框时调用，由 <code>onBlur</code> 事件触发。</li>
</ul>
</li>
<li>将此代码与之前定义的其他状态变量一起添加：<pre><code class="language-jsx">const [searchQuery, setSearchQuery] = useState(&#x27;&#x27;);</code></pre>
<ul>
<li>这将利用 <code>useState</code> 钩子创建一个名为 <code>searchQuery</code> 的状态变量和一个相应的函数 <code>setSearchQuery</code> 来更新其值。</li>
<li><code>searchQuery</code> 状态变量实时保存用户在搜索输入框中输入的值。当用户在搜索栏中输入时，该状态变量会通过调用 <code>setSearchQuery</code> 进行更新，并触发组件的重新渲染，以反映对搜索查询所做的任何更改。</li>
</ul>
</li>
<li>初始化和设置状态变量，用于管理原始经销商列表。
<ul>
<li>添加以下代码，初始化 <code>dealersList</code>、<code>searchQuery</code> 和 <code>states</code> 变量及其设置函数：<pre><code class="language-jsx">const [originalDealers, setOriginalDealers] = useState([]);</code></pre>
在这段代码中，状态变量 <code>originalDealers</code> 及其设置函数 <code>setOriginalDealers</code> 用于跟踪和更新原始经销商列表。</li>
<li>将下面的代码放在 <code>getDealers</code> 函数中更新其他状态（<code>setStates</code> 和 <code>setDealersList</code>）的地方。<pre><code class="language-jsx">setOriginalDealers(all_dealers);</code></pre>
这一行用从应用程序接口获取的所有经销商数组设置状态变量 <code>originalDealers</code>，用于存储过滤前的原始经销商列表。</li>
</ul>
</li>
<li>确保保存所有更改。</li>
<li>运行以下命令来构建应用程序的客户端：<pre><code class="language-bash">cd /home/project/xrwvm-fullstack_developer_capstone/server/frontend
npm run build</code></pre>
</li>
<li>访问经销商详细信息页面，测试应用程序的输出。</li>
<li>请观察用于经销商搜索的搜索框的外观，它取代了之前的下拉框。</li>
<li>输入搜索查询，例如 <code>Texas</code>，搜索该州来进行测试。</li>
</ol>
<h4 id="更改应用程序的配色方案"><a class="markdownIt-Anchor" href="#更改应用程序的配色方案"></a> 更改应用程序的配色方案</h4>
<p>在本节中，您将了解在以下区域更改应用程序配色方案的步骤：</p>
<ul>
<li>
<p>与应用程序主页有关的方面，包括：</p>
<ol>
<li>更改导航栏的背景颜色。</li>
<li>修改 <code>View Dealerships</code> 按钮的背景颜色。</li>
</ol>
</li>
<li>
<p>与 <code>Dealership Review</code> 页面有关的方面包括：</p>
<ol>
<li>调整与 <code>Review</code> 面板相关的背景颜色。</li>
<li>自定义与 <code>Review</code> 图标相关的悬浮边框。</li>
</ol>
</li>
</ul>
<ol>
<li>
<p><strong>更改导航栏的背景颜色</strong></p>
<ol>
<li>打开文件 <code>frontend/static/Home.html</code>。</li>
<li>您将看到以下代码片段，它将当前的深绿色背景添加到应用程序中的导航栏：<pre><code class="language-html">&lt;nav class=&quot;navbar navbar-expand-lg navbar-light&quot; style=&#123;&#123;backgroundColor:&quot;darkturquoise&quot;,height:&quot;1in&quot;&#125;&#125;&gt;</code></pre>
</li>
<li>用您喜欢的颜色（如 <code>mediumspringgreen</code>）代替它，以修改页眉的背景颜色。<pre><code class="language-html">&lt;nav class=&quot;navbar navbar-expand-lg navbar-light&quot; style=&quot;background-color:mediumspringgreen; height: 1in;&quot;&gt;</code></pre>
</li>
<li>保存更改。</li>
<li>运行提供的命令构建客户端并显示上述更改：<pre><code class="language-bash">npm run build</code></pre>
</li>
<li>刷新应用页面。</li>
<li>观察导航栏背景的变化。</li>
</ol>
</li>
<li>
<p><strong>修改 <code>View Dealerships</code> 按钮的背景颜色</strong></p>
<ol>
<li>以下代码表示应用程序主页上 <code>View Dealerships</code> 按钮的背景颜色：<pre><code class="language-html">&lt;a href=&quot;/dealers&quot; class=&quot;btn&quot; style=&quot;background-color: aqua;margin:10px&quot;&gt;View Dealerships&lt;/a&gt;</code></pre>
</li>
<li>将其调整为您喜欢的颜色（例如，<code>plum</code>，一种紫色）。<pre><code class="language-html">&lt;a href=&quot;/dealers&quot; class=&quot;btn&quot; style=&quot;background-color: plum; margin:10px&quot;&gt;View Dealerships&lt;/a&gt;</code></pre>
</li>
<li>请观察 <code>View Dealerships</code> 按钮的最新配色方案。</li>
</ol>
</li>
<li>
<p><strong>调整与 <code>Review</code> 面板相关的背景颜色</strong></p>
<ol>
<li><code>Dealers.css</code> 文件中的样式是为应用程序中的 <code>Dealerships</code> 和 <code>Reviews</code> 面板定制的。<code>review_panel</code> 类包含用于设计经销商审查面板样式的代码。</li>
<li>请注意，它的边框是纯灰色的。<pre><code class="language-css">border: solid grey;</code></pre>
</li>
<li>调整代码，使其具有纯紫色边框：<pre><code class="language-css">border: solid purple;</code></pre>
</li>
<li>你会发现 <code>Review</code> 面板的边框变成了纯紫色，外观也发生了变化。</li>
</ol>
</li>
<li>
<p><strong>自定义与 <code>Review</code> 图标相连的悬浮边框</strong></p>
<ol>
<li>当用户将鼠标悬停在 <code>Review</code> 图标上时，<code>.review_icon:hover</code> 类将为其应用样式。</li>
<li>请注意，悬停时它的背景是纯浅灰色。<pre><code class="language-css">border: solid lightgray;</code></pre>
</li>
<li>将颜色调整为黑色色调，边框变细（如 2 像素），以便在悬停时呈现出鲜明而纤细的背景外观。<pre><code class="language-css">border: 2px solid #080808;</code></pre>
</li>
<li>观察修改后的图标，它带有细细的黑色边框，悬停时会显示出明显的存在感。</li>
</ol>
</li>
</ol>
<h4 id="更改应用程序的外观和感觉"><a class="markdownIt-Anchor" href="#更改应用程序的外观和感觉"></a> 更改应用程序的外观和感觉</h4>
<p>在本节中，您将学习如何改进应用程序中 <code>Dealer Review</code> 面板的视觉效果。</p>
<p>其中包括：</p>
<ul>
<li>调整字体大小</li>
<li>确保字体对齐正确，以改善整体外观</li>
</ul>
<ol>
<li>
<p><strong>调整字体大小</strong></p>
<ol>
<li><code>.reviewer</code> 类定义了用户评论的样式。</li>
<li>当前字体大小设置为小。</li>
<li>将字体大小调整到特定值（例如 18 像素），以放大 <code>Review</code> 文本，提高可读性。<pre><code class="language-css">font-size: 18px;</code></pre>
</li>
</ol>
</li>
<li>
<p><strong>确保字体对齐正确，改善整体外观</strong></p>
<ol>
<li>文本对齐属性并未被指定。</li>
<li>因此，浏览器的默认文本对齐方式（通常为左对齐）会被应用，从而产生左对齐的 <code>Review</code> 文本。</li>
<li>将文本居中，以确保 <code>User reviews</code> 显示在 <code>Review</code> 窗格的中心。<pre><code class="language-css">text-align: center;</code></pre>
</li>
</ol>
</li>
</ol>
<h2 id="汽车库存后端服务"><a class="markdownIt-Anchor" href="#汽车库存后端服务"></a> 汽车库存后端服务</h2>
<h4 id="使用-mongodb-和-nodejs-开发新的后端汽车库存微服务"><a class="markdownIt-Anchor" href="#使用-mongodb-和-nodejs-开发新的后端汽车库存微服务"></a> 使用 MongoDB 和 Node.js 开发新的后端汽车库存微服务</h4>
<ol>
<li>
<p>打开一个新的终端窗口，导航到 <code>xrwvm-fullstack_developer_capstone/server</code> 目录。<br>
生成一个名为 <code>carsInventory</code> 的新目录。</p>
<pre><code class="language-bash">mkdir carsInventory</code></pre>
</li>
<li>
<p>执行以下命令，初始化一个新的 Node.js 项目，并在 <code>carsInvent</code> 目录下创建 <code>package.json</code> 文件：</p>
<pre><code class="language-bash">npm init</code></pre>
<p>将以下应用程序依赖项添加到 <code>package.json</code> 中：</p>
<pre><code class="language-json"> &quot;cors&quot;: &quot;^2.8.5&quot;,    
&quot;express&quot;: &quot;^4.18.2&quot;,
&quot;mongodb&quot;: &quot;^6.3.0&quot;,
&quot;mongoose&quot;: &quot;^8.0.1&quot;</code></pre>
<p>这些依赖项对于启用 CORS（跨源资源共享）、处理网络应用程序路由和中间件（Express）、与 MongoDB 交互（MongoDB 驱动程序）以及在使用 MongoDB 的 Node.js 应用程序中提供便捷的数据建模方式（Mongoose）至关重要。</p>
<p>每个依赖关系中版本号前的 <code>^</code> 符号允许在运行 <code>npm install</code> 命令时安装兼容的未来更新。</p>
<p>将 <code>name</code> 设置为 <code>carsInventory</code>，将 <code>main</code> 的值设置为 <code>app.js</code>。这样，<code>package.json</code> 文件看起来应该与下面相似：</p>
<pre><code class="language-json"> &#123;
  &quot;name&quot;: &quot;carsInventory&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;main&quot;: &quot;app.js&quot;,
  &quot;scripts&quot;: &#123;
     &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
  &#125;,
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;dependencies&quot;: &#123;
    &quot;cors&quot;: &quot;^2.8.5&quot;,    
    &quot;express&quot;: &quot;^4.18.2&quot;,
    &quot;mongodb&quot;: &quot;^6.3.0&quot;,
    &quot;mongoose&quot;: &quot;^8.0.1&quot;
  &#125;
&#125;</code></pre>
<p>执行命令安装这些依赖项：</p>
<pre><code class="language-bash">npm install</code></pre>
</li>
<li>
<p>在名为 <code>inventory.js</code> 的文件中设置 MongoDB schema。现在，您将使用 <code>mongoose</code> 库为名为 <code>cars</code> 的集合建立 MongoDB schema。<br>
这将用于创建一个与 MongoDB 数据库交互的 <code>mongoose</code> 模型，使应用程序能够以更有条理、更有组织的方式对汽车文档执行 CRUD 操作。<br>
schema 应定义汽车文件的结构，其中应包括以下字段及其数据类型：</p>
<ul>
<li><code>dealer_id</code>：<code>Number</code></li>
<li><code>make</code>：<code>String</code></li>
<li><code>model</code>：<code>String</code></li>
<li><code>bodyType</code>：<code>String</code></li>
<li><code>year</code>：<code>Number</code></li>
<li><code>mileage</code>：<code>Number</code></li>
<li><code>price</code>：<code>Number</code></li>
</ul>
<p>模型将被命名为 <code>cars</code>，与所连接的 MongoDB 数据库中的 <code>cars</code> 集合相对应。MongoDB 模型将以此名称导出。</p>
<pre><code class="language-js">const &#123; Int32 &#125; = require(&#x27;mongodb&#x27;);
const mongoose = require(&#x27;mongoose&#x27;);

const Schema = mongoose.Schema;

const cars = new Schema(&#123;
  dealer_id: &#123;
    type: Number,
    required: true
  &#125;,
  make: &#123;
    type: String,
    required: true
  &#125;,
  model: &#123;
    type: String,
    required: true
  &#125;,
  bodyType: &#123;
    type: String,
    required: true
  &#125;,
  year: &#123;
    type: Number,
    required: true
  &#125;,
  mileage: &#123;
    type: Number,
    required: true
  &#125;,
  price: &#123;
    type: Number,
    required: true
  &#125;
&#125;);

module.exports = mongoose.model(&#x27;cars&#x27;, cars);</code></pre>
</li>
<li>
<p>获取包含汽车库存和相关详细信息的 JSON 数据集。<br>
首先创建一个名为 <code>data</code> 的文件夹并导航进入：</p>
<pre><code class="language-bash">mkdir data
cd data</code></pre>
<p>下载汽车库存数据集：</p>
<pre><code class="language-bash">wget https://cf-courses-data.s3.us.cloud-object-storage.appdomain.cloud/IBM-CD0321EN-SkillsNetwork/labs/v2/m6/car_records.json</code></pre>
<p>检查文件，发现每个汽车对象都有以下字段：</p>
<pre><code class="language-plaintext">make, model, bodyType, year, dealer_id, mileage, price</code></pre>
</li>
<li>
<p>返回 <code>carsInvent</code> 目录，创建更多文件。</p>
<p>建立具有后端端点功能的 Node.JS 服务器。首先创建一个名为 <code>app.js</code> 的文件：</p>
<pre><code class="language-bash">touch app.js</code></pre>
<p>它应具备以下功能：</p>
<ul>
<li>设置与 MongoDB 集成的 Express 服务器</li>
<li>从文件 <code>car_records.json</code> 中读取数据</li>
<li>建立与 MongoDB 的连接</li>
<li>定义根 API 端点 <code>/</code>，当访问根 API 时，它会响应一条欢迎访问 Mongoose API 消息</li>
<li>定义以下六个端点，用于根据各种条件查询汽车：
<ul>
<li><code>cars/:id</code> 端点，可根据指定的经销商 ID 从 MongoDB 集合中检索并返回汽车文档</li>
<li><code>/carsbymake/:id/:make</code> 端点，可根据经销商 ID 和汽车品牌检索并返回汽车文档</li>
<li><code>/carsbymake/:id/:model</code> 端点，可根据经销商 ID 和车型检索并返回汽车文档</li>
<li><code>/carsbymaxmileage/:id/:mileage</code> 端点，可根据经销商 ID 和里程限制检索并返回汽车文件，如下所示：
<ul>
<li>里程数：
<ul>
<li>小于或等于 50000</li>
<li>50000 至 100000</li>
<li>100000 至 150000</li>
<li>150000 至 200000</li>
<li>大于 200000</li>
</ul>
</li>
</ul>
</li>
<li><code>/carsbyprice/:id/:price</code> 端点，可根据经销商ID和价格约束检索并返回汽车文件，如下所示：
<ul>
<li>价格：
<ul>
<li>小于或等于 20000</li>
<li>20000 至 40000</li>
<li>40000 至 60000</li>
<li>60000 至 80000</li>
<li>大于 80000</li>
</ul>
</li>
</ul>
</li>
<li><code>/carsbymake/:id/:year</code> 端点，可根据经销商ID和最低年份约束检索并返回汽车文件</li>
</ul>
</li>
<li>在 <code>3050</code> 端口启动服务器。</li>
</ul>
<pre><code class="language-js">/*jshint esversion: 8 */

const express = require(&#x27;express&#x27;);
const mongoose = require(&#x27;mongoose&#x27;);
const fs = require(&#x27;fs&#x27;);
const cors = require(&#x27;cors&#x27;);

const app = express();
const port = 3050;

app.use(cors());
app.use(express.urlencoded(&#123; extended: false &#125;));

const carsData = JSON.parse(fs.readFileSync(&#x27;car_records.json&#x27;, &#x27;utf8&#x27;));

mongoose.connect(&#x27;mongodb://mongo_db:27017/&#x27;, &#123; dbName: &#x27;dealershipsDB&#x27; &#125;);

const Cars = require(&#x27;./inventory&#x27;);

try &#123;
  Cars.deleteMany(&#123;&#125;).then(() =&gt; &#123;
    Cars.insertMany(carsData.cars);
  &#125;);
&#125; catch (error) &#123;
  console.error(error);
  // Handle errors properly here
&#125;

app.get(&#x27;/&#x27;, async (req, res) =&gt; &#123;
  res.send(&#x27;Welcome to the Mongoose API&#x27;);
&#125;);

app.get(&#x27;/cars/:id&#x27;, async (req, res) =&gt; &#123;
  try &#123;
    const documents = await Cars.find(&#123;dealer_id: req.params.id&#125;);
    res.json(documents);
  &#125; catch (error) &#123;
    res.status(500).json(&#123; error: &#x27;Error fetching reviews&#x27; &#125;);
  &#125;
&#125;);

app.get(&#x27;/carsbymake/:id/:make&#x27;, async (req, res) =&gt; &#123;
  try &#123;
    const documents = await Cars.find(&#123;dealer_id: req.params.id, make: req.params.make&#125;);
    res.json(documents);
  &#125; catch (error) &#123;
    res.status(500).json(&#123; error: &#x27;Error fetching reviews by car make and model&#x27; &#125;);
  &#125;
&#125;);

app.get(&#x27;/carsbymodel/:id/:model&#x27;, async (req, res) =&gt; &#123;
  try &#123;
    const documents = await Cars.find(&#123; dealer_id: req.params.id, model: req.params.model &#125;);
    res.json(documents);
  &#125; catch (error) &#123;
    res.status(500).json(&#123; error: &#x27;Error fetching dealers by ID&#x27; &#125;);
  &#125;
&#125;);

app.get(&#x27;/carsbymaxmileage/:id/:mileage&#x27;, async (req, res) =&gt; &#123;
  try &#123;
    let mileage = parseInt(req.params.mileage)
    let condition = &#123;&#125;
    if(mileage === 50000) &#123;
      condition = &#123; $lte : mileage&#125;
    &#125; else if (mileage === 100000)&#123;
      condition = &#123; $lte : mileage, $gt : 50000&#125;
    &#125; else if (mileage === 150000)&#123;
      condition = &#123; $lte : mileage, $gt : 100000&#125;
    &#125; else if (mileage === 200000)&#123;
      condition = &#123; $lte : mileage, $gt : 150000&#125;
    &#125; else &#123;
      condition = &#123; $gt : 200000&#125;
    &#125;
    const documents = await Cars.find(&#123; dealer_id: req.params.id, mileage : condition &#125;);
    res.json(documents);
  &#125; catch (error) &#123;
    res.status(500).json(&#123; error: &#x27;Error fetching dealers by ID&#x27; &#125;);
  &#125;
&#125;);

app.get(&#x27;/carsbyprice/:id/:price&#x27;, async (req, res) =&gt; &#123;
  try &#123;
    let price = parseInt(req.params.price)
    let condition = &#123;&#125;
    if(price === 20000) &#123;
      condition = &#123; $lte : price&#125;
    &#125; else if (price=== 40000)&#123;
      console.log(&quot;\n \n \n &quot;+ price)  
      condition = &#123; $lte : price, $gt : 20000&#125;
    &#125; else if (price === 60000)&#123;
      condition = &#123; $lte : price, $gt : 40000&#125;
    &#125; else if (price === 80000)&#123;
      condition = &#123; $lte : price, $gt : 60000&#125;
    &#125; else &#123;
      condition = &#123; $gt : 80000&#125;
    &#125;
    const documents = await Cars.find(&#123; dealer_id: req.params.id, price : condition &#125;);
    res.json(documents);
  &#125; catch (error) &#123;
    res.status(500).json(&#123; error: &#x27;Error fetching dealers by ID&#x27; &#125;);
  &#125;
&#125;);

app.get(&#x27;/carsbyyear/:id/:year&#x27;, async (req, res) =&gt; &#123;
  try &#123;
    const documents = await Cars.find(&#123; dealer_id: req.params.id, year : &#123; $gte :req.params.year &#125;&#125;);
    res.json(documents);
  &#125; catch (error) &#123;
    res.status(500).json(&#123; error: &#x27;Error fetching dealers by ID&#x27; &#125;);
  &#125;
&#125;);

app.listen(port, () =&gt; &#123;
  console.log(`Server is running on http://localhost:$&#123;port&#125;`);
&#125;);</code></pre>
</li>
<li>
<p>为 Node.js 应用程序创建 Docker 镜像。首先创建 <code>Dockerfile</code>：</p>
<pre><code class="language-bash">touch Dockerfile</code></pre>
<p>添加以下内容：</p>
<ul>
<li>基础 Docker 镜像：<code>node:18.12.1-bullseye-slim</code></li>
<li>安装 <code>9.1.3</code> 版本的 <code>npm</code></li>
<li>从当前目录内添加 <code>package.json</code>、<code>app.js</code>、<code>car_records.json</code> 到 Docker 镜像的根目录</li>
<li>复制当前目录的所有文件到 Docker 镜像</li>
<li>让容器监听 3050 端口</li>
<li>将容器启动时要运行的默认命令指定为 <code>node app.js</code></li>
</ul>
<pre><code class="language-dockerfile">FROM node:18.12.1-bullseye-slim

RUN npm install -g npm@9.1.3

ADD package.json .
ADD app.js .
ADD data/car_records.json .
COPY . .
RUN npm install

EXPOSE 3050

CMD [ &quot;node&quot;, &quot;app.js&quot; ]</code></pre>
</li>
<li>
<p>为运行两个服务（MongoDB 容器和 Node.js 应用程序）设置 Docker Compose 配置文件。<br>
创建 Docker Compose 配置 YAML 文件（<code>docker-compose.yml</code>）：</p>
<pre><code class="language-bash">touch docker-compose.yml</code></pre>
<p>添加内容：</p>
<pre><code class="language-yaml">version: &#x27;3.9&#x27;

services:
  # Mongodb service
  mongo_db:
    container_name: carsInventory_container
    image: mongo:latest
    ports:
      - 27018:27017
    restart: always
    volumes:
      - mongo_data:/data/db

  # Node api service
  api:
    image: nodeapp
    ports:
      - 3050:3050
    depends_on:
      - mongo_db

volumes:
  mongo_data: &#123;&#125;</code></pre>
<p>构建 Docker 应用：</p>
<pre><code class="language-bash">docker build . -t nodeapp</code></pre>
<p>执行以下命令启动服务器：</p>
<pre><code class="language-bash">docker-compose up</code></pre>
<p>启动服务器并验证汽车库存服务的根端点是否显示了 <code>Welcome to the Mongoose API</code> 的消息。</p>
</li>
</ol>
<h4 id="将微服务与-django-应用程序后端集成并成功启动后端服务器"><a class="markdownIt-Anchor" href="#将微服务与-django-应用程序后端集成并成功启动后端服务器"></a> 将微服务与 Django 应用程序后端集成，并成功启动后端服务器</h4>
<ol>
<li>
<p>导航至 <code>xrwvm-fullstack_developer_capstone/server</code> 目录。如果 Django 服务器已在运行，则停止该服务器。</p>
</li>
<li>
<p>在 <code>.env</code> 文件中插入汽车库存服务端点的 URL（上一节已复制）。</p>
<pre><code class="language-plaintext">searchcars_url=&#x27;your end&#x27;</code></pre>
<blockquote>
<p>不要添加尾端的 <code>\</code>。</p>
</blockquote>
</li>
<li>
<p>在 <code>restapis.py</code> 中加入执行以下功能的代码：</p>
<ol>
<li>
<p>从 <code>.env</code> 文件中获取 URL。</p>
<pre><code class="language-python">searchcars_url = os.getenv(
    &#x27;searchcars_url&#x27;,
    default=&quot;http://localhost:3050/&quot;
)</code></pre>
</li>
<li>
<p>执行一个名为 <code>searchcars_request</code> 的方法，该方法具有以下功能：</p>
<ul>
<li>接受端点和变量关键字参数</li>
<li>利用提供的端点、查询参数和基本 URL 构建一个完整的请求 URL</li>
<li>执行 GET 请求并返回响应的 JSON 内容</li>
<li>处理错误（包括网络异常）并提供成功完成消息</li>
</ul>
<p>代码结构将与您之前在 Capstone 主项目中创建的 <code>get_request</code> 方法非常相似：</p>
<pre><code class="language-python">def searchcars_request(endpoint, **kwargs):
    params = &quot;&quot;
    if (kwargs):
    for key, value in kwargs.items():
        params = params+key + &quot;=&quot; + value + &quot;&amp;&quot;

        request_url = searchcars_url+endpoint+&quot;?&quot;+params

        print(&quot;GET from &#123;&#125; &quot;.format(request_url))
        try:
            # Call get method of requests library with URL and parameters
            response = requests.get(request_url)
            return response.json()
        except:
            # If any error occurs
            print(&quot;Network exception occurred&quot;)
        finally:
            print(&quot;GET request call complete!&quot;)</code></pre>
</li>
</ol>
</li>
<li>
<p>在 <code>djangoapp/views.py</code> 文件中添加名为 <code>get_inventory</code> 的视图，以获取汽车库存。</p>
<ul>
<li>该视图应处理 HTTP 请求，提取查询参数和经销商 ID。</li>
<li>它应使用提供的参数构建一个 API 端点，并调用 <code>restapis.py</code> 中定义的 <code>searchcars_request</code> 函数来检索汽车数据。确保为 <code>searchcars_request</code> 函数加入模块导入。</li>
<li>它应返回状态为 <code>200</code> 的 JSON 响应，如果提供了经销商 ID，则返回获取的汽车。</li>
<li>如果没有经销商 ID，则应返回状态为 <code>400</code> 的 JSON 响应和 <code>Bad Request</code> 消息。</li>
</ul>
<pre><code class="language-python"># Module import
from .restapis import get_request, analyze_review_sentiments, post_review, searchcars_request

# Code for the view
def get_inventory(request, dealer_id):
    data = request.GET
    if (dealer_id):
        if &#x27;year&#x27; in data:
            endpoint = &quot;/carsbyyear/&quot;+str(dealer_id)+&quot;/&quot;+data[&#x27;year&#x27;]
        elif &#x27;make&#x27; in data:
            endpoint = &quot;/carsbymake/&quot;+str(dealer_id)+&quot;/&quot;+data[&#x27;make&#x27;]
        elif &#x27;model&#x27; in data:
            endpoint = &quot;/carsbymodel/&quot;+str(dealer_id)+&quot;/&quot;+data[&#x27;model&#x27;]
        elif &#x27;mileage&#x27; in data:
            endpoint = &quot;/carsbymaxmileage/&quot;+str(dealer_id)+&quot;/&quot;+data[&#x27;mileage&#x27;]
        elif &#x27;price&#x27; in data:
            endpoint = &quot;/carsbyprice/&quot;+str(dealer_id)+&quot;/&quot;+data[&#x27;price&#x27;]
        else:
            endpoint = &quot;/cars/&quot;+str(dealer_id)

        cars = searchcars_request(endpoint)
        return JsonResponse(&#123;&quot;status&quot;: 200, &quot;cars&quot;: cars&#125;)
    else:
        return JsonResponse(&#123;&quot;status&quot;: 400, &quot;message&quot;: &quot;Bad Request&quot;&#125;)
    return JsonResponse(&#123;&quot;status&quot;: 400, &quot;message&quot;: &quot;Bad Request&quot;&#125;)</code></pre>
</li>
<li>
<p>在 <code>djangoapp/urls.py</code> 文件中包含该视图的路由。</p>
<pre><code class="language-python">path(route=&#x27;get_inventory/&lt;int:dealer_id&gt;&#x27;, view=views.get_inventory, name=&#x27;get_inventory&#x27;),</code></pre>
</li>
<li>
<p>导航到 <code>xrwvm-fullstack_developer_capstone/server</code> 目录。<br>
确保 Docker Compose 服务器正在运行。如果没有，请使用 <code>docker-compose up</code> 命令启动它。</p>
</li>
<li>
<p>执行模型迁移并启动服务器。</p>
<pre><code class="language-bash">python3 manage.py makemigrations
python3 manage.py migrate
python3 manage.py runserver</code></pre>
</li>
<li>
<p>确保服务器启动成功且无错误。如果出现任何错误日志，请检查并根据需要处理您的代码。</p>
</li>
</ol>
<h2 id="汽车库存服务的前端开发"><a class="markdownIt-Anchor" href="#汽车库存服务的前端开发"></a> 汽车库存服务的前端开发</h2>
<h4 id="开发并集成与后端汽车库存微服务相对应的前端服务"><a class="markdownIt-Anchor" href="#开发并集成与后端汽车库存微服务相对应的前端服务"></a> 开发并集成与后端汽车库存微服务相对应的前端服务</h4>
<p>这需要创建一个 React 组件，专门用于搜索和显示汽车信息，并为该组件整合相应的路线。</p>
<ol>
<li>
<p>创建一个用于搜索和显示汽车信息的 React 组件。</p>
<ol>
<li>导航至 <code>xrwvm-fullstack_developer_capstone/server/frontend/src/components/Dealers</code> 目录，并添加名为 <code>SearchCars.jsx</code> 的新文件。</li>
<li>在该文件中加入以下内容：<pre><code class="language-jsx">import React, &#123; useState, useEffect &#125; from &#x27;react&#x27;;
import &#123; useParams &#125; from &#x27;react-router-dom&#x27;;
import Header from &#x27;../Header/Header&#x27;;

const SearchCars = () =&gt; &#123;
  const [cars, setCars] = useState([]);
  const [makes, setMakes] = useState([]);
  const [models, setModels] = useState([]);
  const [dealer, setDealer] = useState(&#123;&quot;full_name&quot;:&quot;&quot;&#125;);
  const [message, setMessage] = useState(&quot;Loading Cars....&quot;);
  const &#123; id &#125; = useParams();


  let dealer_url = `/djangoapp/get_inventory/$&#123;id&#125;`;

  let fetch_url = `/djangoapp/dealer/$&#123;id&#125;`;

  const fetchDealer = async ()=&gt;&#123;
    const res = await fetch(fetch_url, &#123;
      method: &quot;GET&quot;
    &#125;);
    const retobj = await res.json();
    if(retobj.status === 200) &#123;
      let dealer = retobj.dealer;
      setDealer(&#123;&quot;full_name&quot;:dealer[0].full_name&#125;)
    &#125;
  &#125;

  const populateMakesAndModels = (cars)=&gt;&#123;
    let tmpmakes = []
    let tmpmodels = []
    cars.forEach((car)=&gt;&#123;
      tmpmakes.push(car.make)
      tmpmodels.push(car.model)
    &#125;)
    setMakes(Array.from(new Set(tmpmakes)));
    setModels(Array.from(new Set(tmpmodels)));
  &#125;


  const fetchCars = async ()=&gt;&#123;
    const res = await fetch(dealer_url, &#123;
      method: &quot;GET&quot;
    &#125;);
    const retobj = await res.json();

    if(retobj.status === 200) &#123;
      let cars = Array.from(retobj.cars)
      setCars(cars);
      populateMakesAndModels(cars);
    &#125;
  &#125;

  const setCarsmatchingCriteria = async(matching_cars)=&gt;&#123;
    let cars = Array.from(matching_cars)
    console.log(&quot;Number of matching cars &quot;+cars.length);

    let makeIdx = document.getElementById(&#x27;make&#x27;).selectedIndex;
    let modelIdx = document.getElementById(&#x27;model&#x27;).selectedIndex;
    let yearIdx = document.getElementById(&#x27;year&#x27;).selectedIndex;
    let mileageIdx = document.getElementById(&#x27;mileage&#x27;).selectedIndex;
    let priceIdx = document.getElementById(&#x27;price&#x27;).selectedIndex;

    if(makeIdx !== 0) &#123;
      let currmake = document.getElementById(&#x27;make&#x27;).value;
      cars = cars.filter(car =&gt; car.make === currmake);
    &#125;
    if(modelIdx !== 0) &#123;
      let currmodel = document.getElementById(&#x27;model&#x27;).value;
      cars = cars.filter(car =&gt; car.model === currmodel);
      if(cars.length !== 0) &#123;
        document.getElementById(&#x27;make&#x27;).value = cars[0].make;
      &#125;
    &#125;

    if(yearIdx !== 0) &#123;
      let curryear = document.getElementById(&#x27;year&#x27;).value;
      cars = cars.filter(car =&gt; car.year &gt;= curryear);
      if(cars.length !== 0) &#123;
        document.getElementById(&#x27;make&#x27;).value = cars[0].make;
      &#125;
    &#125;

    if(mileageIdx !== 0) &#123;
      let currmileage = parseInt(document.getElementById(&#x27;mileage&#x27;).value);
      if(currmileage === 50000) &#123;
        cars = cars.filter(car =&gt; car.mileage &lt;= currmileage);
      &#125; else if (currmileage === 100000)&#123;
        cars = cars.filter(car =&gt; car.mileage &lt;= currmileage &amp;&amp; car.mileage &gt; 50000);
      &#125; else if (currmileage === 150000)&#123;
        cars = cars.filter(car =&gt; car.mileage &lt;= currmileage &amp;&amp; car.mileage &gt; 100000);
      &#125; else if (currmileage === 200000)&#123;
        cars = cars.filter(car =&gt; car.mileage &lt;= currmileage &amp;&amp; car.mileage &gt; 150000);
      &#125; else &#123;
        cars = cars.filter(car =&gt; car.mileage &gt; 200000);
      &#125;
    &#125;

    if(priceIdx !== 0) &#123;
      let currprice = parseInt(document.getElementById(&#x27;price&#x27;).value);
      if(currprice === 20000) &#123;
        cars = cars.filter(car =&gt; car.price &lt;= currprice);
      &#125; else if (currprice === 40000)&#123;
        cars = cars.filter(car =&gt; car.price &lt;= currprice &amp;&amp; car.price &gt; 20000);
      &#125; else if (currprice === 60000)&#123;
        cars = cars.filter(car =&gt; car.price &lt;= currprice &amp;&amp; car.price &gt; 40000);
      &#125; else if (currprice === 80000)&#123;
        cars = cars.filter(car =&gt; car.price &lt;= currprice &amp;&amp; car.price &gt; 60000);
      &#125; else &#123;
        cars = cars.filter(car =&gt; car.price &gt; 80000);
      &#125;
    &#125;

    if(cars.length === 0) &#123;
      setMessage(&quot;No cars found matching criteria&quot;);
    &#125;
    setCars(cars);
  &#125;


  let SearchCarsByMake = async ()=&gt; &#123;
    let make = document.getElementById(&quot;make&quot;).value;
    dealer_url = dealer_url + &quot;?make=&quot;+make;

    const res = await fetch(dealer_url, &#123;
      method: &#x27;GET&#x27;,
      headers: &#123;
        &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,
      &#125;&#125;)

    const retobj = await res.json();

    if(retobj.status === 200) &#123;
      setCarsmatchingCriteria(retobj.cars);
    &#125;
  &#125;

  let SearchCarsByModel = async ()=&gt; &#123;
    let model = document.getElementById(&quot;model&quot;).value;
    dealer_url = dealer_url + &quot;?model=&quot;+model;

    const res = await fetch(dealer_url, &#123;
      method: &#x27;GET&#x27;,
      headers: &#123;
        &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,
      &#125;&#125;)

    const retobj = await res.json();

    if(retobj.status === 200) &#123;
      setCarsmatchingCriteria(retobj.cars);
    &#125;
  &#125;

  let SearchCarsByYear = async ()=&gt; &#123;
    let year = document.getElementById(&quot;year&quot;).value;
    if (year !== &quot;all&quot;) &#123;
      dealer_url = dealer_url + &quot;?year=&quot;+year;
    &#125;

    const res = await fetch(dealer_url, &#123;
      method: &#x27;GET&#x27;,
      headers: &#123;
        &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,
      &#125;&#125;)

    const retobj = await res.json();

    if(retobj.status === 200) &#123;
      setCarsmatchingCriteria(retobj.cars);
    &#125;
  &#125;

  let SearchCarsByMileage = async ()=&gt; &#123;

    let mileage = document.getElementById(&quot;mileage&quot;).value;
    if (mileage !== &quot;all&quot;) &#123;
      dealer_url = dealer_url + &quot;?mileage=&quot;+mileage;
    &#125;

    const res = await fetch(dealer_url, &#123;
      method: &#x27;GET&#x27;,
      headers: &#123;
        &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,
      &#125;&#125;)

    const retobj = await res.json();

    if(retobj.status === 200) &#123;
      setCarsmatchingCriteria(retobj.cars);
    &#125;
  &#125;


  let SearchCarsByPrice = async ()=&gt; &#123;
    let price = document.getElementById(&quot;price&quot;).value;
    if(price !== &quot;all&quot;) &#123;
      dealer_url = dealer_url + &quot;?price=&quot;+price;
    &#125;

    const res = await fetch(dealer_url, &#123;
      method: &#x27;GET&#x27;,
      headers: &#123;
        &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,
      &#125;&#125;)

    const retobj = await res.json();

    if(retobj.status === 200) &#123;
      setCarsmatchingCriteria(retobj.cars);
    &#125;
  &#125;

  const reset = ()=&gt;&#123;
    const selectElements = document.querySelectorAll(&#x27;select&#x27;);

    selectElements.forEach((select) =&gt; &#123;
      select.selectedIndex = 0;
    &#125;);
    fetchCars();
  &#125;


  useEffect(() =&gt; &#123;
    fetchCars();
    fetchDealer();
  &#125;,[]);

  return (
    &lt;div&gt;
      &lt;Header /&gt;
      &lt;h1 style=&#123;&#123; marginBottom: &#x27;20px&#x27;&#125;&#125;&gt;Cars at &#123;dealer.full_name&#125;&lt;/h1&gt;
      &lt;div&gt;
        &lt;span style=&#123;&#123; marginLeft: &#x27;10px&#x27;, paddingLeft: &#x27;10px&#x27;&#125;&#125;&gt;Make&lt;/span&gt;
        &lt;select style=&#123;&#123; marginLeft: &#x27;10px&#x27;, marginRight: &#x27;10px&#x27; ,paddingLeft: &#x27;10px&#x27;, borderRadius :&#x27;10px&#x27;&#125;&#125; name=&quot;make&quot; id=&quot;make&quot; onChange=&#123;SearchCarsByMake&#125;&gt;
          &#123;makes.length === 0 ? (
            &lt;option value=&#x27;&#x27;&gt;No data found&lt;/option&gt;
          ):(
            &lt;&gt;
              &lt;option disabled defaultValue&gt; -- All -- &lt;/option&gt;
              &#123;makes.map((make, index) =&gt; (
                &lt;option key=&#123;index&#125; value=&#123;make&#125;&gt;
                  &#123;make&#125;
                &lt;/option&gt;
              ))&#125;
            &lt;/&gt;
          )
          &#125;
        &lt;/select&gt;
        &lt;span style=&#123;&#123; marginLeft: &#x27;10px&#x27;, paddingLeft: &#x27;10px&#x27;&#125;&#125;&gt;Model&lt;/span&gt;
        &lt;select style=&#123;&#123; marginLeft: &#x27;10px&#x27;, marginRight: &#x27;10px&#x27; ,paddingLeft: &#x27;10px&#x27;, borderRadius :&#x27;10px&#x27;&#125;&#125; name=&quot;model&quot; id=&quot;model&quot; onChange=&#123;SearchCarsByModel&#125;&gt;
          &#123;models.length === 0 ? (
            &lt;option value=&#x27;&#x27;&gt;No data found&lt;/option&gt;
          ) : (
            &lt;&gt;
              &lt;option disabled defaultValue&gt; -- All -- &lt;/option&gt;
              &#123;models.map((model, index) =&gt; (
                &lt;option key=&#123;index&#125; value=&#123;model&#125;&gt;
                  &#123;model&#125;
                &lt;/option&gt;
              ))&#125;
            &lt;/&gt;
          )&#125;
        &lt;/select&gt;
        &lt;span style=&#123;&#123; marginLeft: &#x27;10px&#x27;, paddingLeft: &#x27;10px&#x27;&#125;&#125;&gt;Year&lt;/span&gt;
        &lt;select style=&#123;&#123; marginLeft: &#x27;10px&#x27;, marginRight: &#x27;10px&#x27; ,paddingLeft: &#x27;10px&#x27;, borderRadius :&#x27;10px&#x27;&#125;&#125; name=&quot;year&quot; id=&quot;year&quot; onChange=&#123;SearchCarsByYear&#125;&gt;
          &lt;option selected value=&#x27;all&#x27;&gt; -- All -- &lt;/option&gt;
          &lt;option value=&#x27;2024&#x27;&gt;2024 or newer&lt;/option&gt;
          &lt;option value=&#x27;2023&#x27;&gt;2023 or newer&lt;/option&gt;
          &lt;option value=&#x27;2022&#x27;&gt;2022 or newer&lt;/option&gt;
          &lt;option value=&#x27;2021&#x27;&gt;2021 or newer&lt;/option&gt;
          &lt;option value=&#x27;2020&#x27;&gt;2020 or newer&lt;/option&gt;
        &lt;/select&gt;
        &lt;span style=&#123;&#123; marginLeft: &#x27;10px&#x27;, paddingLeft: &#x27;10px&#x27;&#125;&#125;&gt;Mileage&lt;/span&gt;
        &lt;select style=&#123;&#123; marginLeft: &#x27;10px&#x27;, marginRight: &#x27;10px&#x27; ,paddingLeft: &#x27;10px&#x27;, borderRadius :&#x27;10px&#x27;&#125;&#125; name=&quot;mileage&quot; id=&quot;mileage&quot; onChange=&#123;SearchCarsByMileage&#125;&gt;
          &lt;option selected value=&#x27;all&#x27;&gt; -- All -- &lt;/option&gt;
          &lt;option value=&#x27;50000&#x27;&gt;Under 50000&lt;/option&gt;
          &lt;option value=&#x27;100000&#x27;&gt;50000 - 100000&lt;/option&gt;
          &lt;option value=&#x27;150000&#x27;&gt;100000 - 150000&lt;/option&gt;
          &lt;option value=&#x27;200000&#x27;&gt;150000 - 200000&lt;/option&gt;
          &lt;option value=&#x27;200001&#x27;&gt;Over 200000&lt;/option&gt;
        &lt;/select&gt;
        &lt;span style=&#123;&#123; marginLeft: &#x27;10px&#x27;, paddingLeft: &#x27;10px&#x27;&#125;&#125;&gt;Price&lt;/span&gt;
        &lt;select style=&#123;&#123; marginLeft: &#x27;10px&#x27;, marginRight: &#x27;10px&#x27; ,paddingLeft: &#x27;10px&#x27;, borderRadius :&#x27;10px&#x27;&#125;&#125; name=&quot;price&quot; id=&quot;price&quot; onChange=&#123;SearchCarsByPrice&#125;&gt;
          &lt;option selected value=&#x27;all&#x27;&gt; -- All -- &lt;/option&gt;
          &lt;option value=&#x27;20000&#x27;&gt;Under 20000&lt;/option&gt;
          &lt;option value=&#x27;40000&#x27;&gt;20000 - 40000&lt;/option&gt;
          &lt;option value=&#x27;60000&#x27;&gt;40000 - 60000&lt;/option&gt;
          &lt;option value=&#x27;80000&#x27;&gt;60000 - 80000&lt;/option&gt;
          &lt;option value=&#x27;80001&#x27;&gt;Over 80000&lt;/option&gt;
        &lt;/select&gt;

        &lt;button style=&#123;&#123;marginLeft: &#x27;10px&#x27;, paddingLeft: &#x27;10px&#x27;&#125;&#125; onClick=&#123;reset&#125;&gt;Reset&lt;/button&gt;

      &lt;/div&gt;


      &lt;div style=&#123;&#123; marginLeft: &#x27;10px&#x27;, marginRight: &#x27;10px&#x27; , marginTop: &#x27;20px&#x27;&#125;&#125; &gt;
        &#123;cars.length === 0 ? (
          &lt;p style=&#123;&#123; marginLeft: &#x27;10px&#x27;, marginRight: &#x27;10px&#x27;, marginTop: &#x27;20px&#x27; &#125;&#125;&gt;&#123;message&#125;&lt;/p&gt;
        ) : (
          &lt;div&gt;
            &lt;hr/&gt;
            &#123;cars.map((car) =&gt; (
              &lt;div&gt;
                &lt;div key=&#123;car._id&#125;&gt;
                  &lt;h3&gt;&#123;car.make&#125; &#123;car.model&#125;&lt;/h3&gt;
                  &lt;p&gt;Year: &#123;car.year&#125;&lt;/p&gt;
                  &lt;p&gt;Mileage: &#123;car.mileage&#125;&lt;/p&gt;
                  &lt;p&gt;Price: &#123;car.price&#125;&lt;/p&gt;
                &lt;/div&gt;
                &lt;hr/&gt;
              &lt;/div&gt;
            ))&#125;
          &lt;/div&gt;
        )&#125;
      &lt;/div&gt;
    &lt;/div&gt;
  );
&#125;;

export default SearchCars;</code></pre>
</li>
</ol>
</li>
<li>
<p>为该组件添加路由并构建前端。</p>
<ol>
<li>在 <code>frontend/src/App.js</code> 中为该组件添加导入语句和路由，将搜索路径设为 <code>/searchcars/:id</code>。<pre><code class="language-js">import SearchCars from &quot;./components/Dealers/SearchCars&quot;;	</code></pre>
<pre><code class="language-jsx">&lt;Route path=&quot;/searchcars/:id&quot; element=&#123;&lt;SearchCars /&gt;&#125; /&gt;</code></pre>
</li>
<li>整合锚链接，将用户从特定经销商的评论页面重定向到 <code>Search Cars</code> 页面。
<ul>
<li>转到 <code>frontend/src/components/Dealers/Dealer.jsx</code>，插入一个锚元素。</li>
<li>将其标记为 <code>Search Cars</code>，并设置为点击后导航至 <code>Search Cars</code> 页面。</li>
</ul>
<pre><code class="language-jsx">&lt;a href=&#123;`/searchcars/$&#123;id&#125;`&#125;&gt;SearchCars&lt;/a&gt;	</code></pre>
</li>
<li>构建应用程序的前端，以便部署。<pre><code class="language-bash">npm run build</code></pre>
</li>
<li>在 <code>djangoproj/urls.py</code> 中添加路径为 <code>searchcars/&lt;int:dealer_id&gt;</code> 的动态 URL 模式。<pre><code class="language-python">path(&#x27;searchcars/&lt;int:dealer_id&gt;&#x27;,TemplateView.as_view(template_name=&quot;index.html&quot;)),</code></pre>
</li>
</ol>
</li>
</ol>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="ed32.html">上一篇</a><a class="next" href="49c3.html">下一篇</a></div><div class="copyright"><p>© 2022 - 2025 <a href="https://cytrogen.icu">Cytrogen</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/cytrogen/hexo-theme-ares" target="_blank">hexo-theme-ares</a>.</p></div></footer></div></div><a class="back-to-top" href="#top" aria-label="返回顶部"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M3.293 9.707a1 1 0 010-1.414L9.586 2a2 2 0 012.828 0l6.293 6.293a1 1 0 01-1.414 1.414L11 3.414V17a1 1 0 11-2 0V3.414L2.707 9.707a1 1 0 01-1.414 0z"></path></svg></a><script>document.addEventListener('DOMContentLoaded', function() {
  const codeBlocks = document.querySelectorAll('figure.highlight');
  
  codeBlocks.forEach(block => {
    let caption = block.querySelector('figcaption');
    if (!caption) {
      caption = document.createElement('figcaption');
      block.insertBefore(caption, block.firstChild);
    }

    const info = document.createElement('div');
    info.className = 'info';
    
    const filename = caption.querySelector('span');
    if (filename) {
      filename.className = 'filename';
      info.appendChild(filename);
    }
    
    const lang = block.className.split(' ')[1];
    if (lang) {
      const langSpan = document.createElement('span');
      langSpan.className = 'lang-name';
      langSpan.textContent = lang;
      info.appendChild(langSpan);
    }

    const sourceLink = caption.querySelector('a');
    if (sourceLink) {
      sourceLink.className = 'source-link';
      info.appendChild(sourceLink);
    }

    const actions = document.createElement('div');
    actions.className = 'actions';

    const codeHeight = block.scrollHeight;
    const threshold = 300;

    if (codeHeight > threshold) {
      block.classList.add('folded');
      
      const toggleBtn = document.createElement('button');
      toggleBtn.textContent = '展开';
      toggleBtn.addEventListener('click', () => {
        block.classList.toggle('folded');
        toggleBtn.textContent = block.classList.contains('folded') ? '展开' : '折叠';
      });
      actions.appendChild(toggleBtn);
    }

    const copyBtn = document.createElement('button');
    copyBtn.textContent = '复制';
    copyBtn.addEventListener('click', async () => {
      const codeLines = block.querySelectorAll('.code .line');
      const code = Array.from(codeLines)
        .map(line => line.textContent)
        .join('\n')
        .replace(/\n\n/g, '\n');
      
      try {
        await navigator.clipboard.writeText(code);
        copyBtn.textContent = '已复制';
        copyBtn.classList.add('copied');
        
        setTimeout(() => {
          copyBtn.textContent = '复制';
          copyBtn.classList.remove('copied');
        }, 3000);
      } catch (err) {
        console.error('复制失败:', err);
        copyBtn.textContent = '复制失败';
        
        setTimeout(() => {
          copyBtn.textContent = '复制';
        }, 3000);
      }
    });
    actions.appendChild(copyBtn);

    caption.innerHTML = '';
    caption.appendChild(info);
    caption.appendChild(actions);

    const markedLines = block.getAttribute('data-marked-lines');
    if (markedLines) {
      const lines = markedLines.split(',');
      lines.forEach(range => {
        if (range.includes('-')) {
          const [start, end] = range.split('-').map(Number);
          for (let i = start; i <= end; i++) {
            const line = block.querySelector(`.line-${i}`);
            if (line) line.classList.add('marked');
          }
        } else {
          const line = block.querySelector(`.line-${range}`);
          if (line) line.classList.add('marked');
        }
      });
    }
  });
});</script><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-4PVPZXE0QQ"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-4PVPZXE0QQ');</script><script>(function() {
  // Wait for DOM to be ready
  document.addEventListener('DOMContentLoaded', function() {
    const themeToggle = document.querySelector('.theme-toggle');
    
    if (!themeToggle) return;
    
    // Get current theme
    const getCurrentTheme = () => {
      return document.documentElement.getAttribute('data-theme') || 'light';
    };
    
    // Update UI to match current theme
    const updateUI = (theme) => {
      const isDark = theme === 'dark';
      themeToggle.setAttribute('aria-pressed', isDark.toString());
    };
    
    // Simplified theme setter - CSS handles all animations
    const setTheme = (theme) => {
      document.documentElement.setAttribute('data-theme', theme);
      document.documentElement.style.colorScheme = theme; // Update native UI elements
      
      // Also update page-wrapper for animation support
      const pageWrapper = document.getElementById('page-wrapper');
      if (pageWrapper) {
        pageWrapper.setAttribute('data-theme', theme);
      }
      
      // Find and remove the temporary anti-flicker style tag if it exists.
      // This ensures the main stylesheet takes full control after the initial load.
      const antiFlickerStyle = document.getElementById('anti-flicker-style');
      if (antiFlickerStyle) {
        antiFlickerStyle.remove();
      }
      
      localStorage.setItem('theme', theme);
      updateUI(theme);
    };
    
    // Simple theme toggle - letting CSS handle the smooth transitions
    const toggleTheme = () => {
      const current = getCurrentTheme();
      const newTheme = current === 'light' ? 'dark' : 'light';
      setTheme(newTheme);
    };
    
    // Initialize UI on page load
    updateUI(getCurrentTheme());
    
    // Add click event listener
    themeToggle.addEventListener('click', toggleTheme);
    
    // Listen for system theme changes
    if (window.matchMedia) {
      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
      mediaQuery.addEventListener('change', function(e) {
        // Only update if no manual preference is saved
        if (!localStorage.getItem('theme')) {
          const theme = e.matches ? 'dark' : 'light';
          setTheme(theme);
        }
      });
    }
  });
})();
</script><script>(function() {
  document.addEventListener('DOMContentLoaded', function() {
    const backToTopBtn = document.querySelector('.back-to-top');
    
    if (!backToTopBtn) return;
    
    // Show/hide button based on scroll position
    const toggleButtonVisibility = () => {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const shouldShow = scrollTop > 200; // Show after scrolling 200px
      
      if (shouldShow) {
        backToTopBtn.classList.add('is-visible');
      } else {
        backToTopBtn.classList.remove('is-visible');
      }
    };
    
    // Throttle scroll events for better performance
    let ticking = false;
    const handleScroll = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          toggleButtonVisibility();
          ticking = false;
        });
        ticking = true;
      }
    };
    
    // Smooth scroll to top when clicked
    const scrollToTop = (event) => {
      event.preventDefault();
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    };
    
    // Add event listeners
    window.addEventListener('scroll', handleScroll);
    backToTopBtn.addEventListener('click', scrollToTop);
    
    // Check initial scroll position
    toggleButtonVisibility();
  });
})();</script></body></html>