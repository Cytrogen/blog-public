<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Markdown Rendering in React · Cytrogen 的个人博客</title><meta name="description" content="This article is a practical guide on rendering Markdown in React, using the react-markdown library. It covers adding support for GitHub Flavored Markdown (GFM) with remark-gfm and implementing syntax highlighting for code blocks with react-syntax-highlighter. The tutorial provides a unique workaround for a common issue in newer versions of react-markdown where the inline prop is deprecated, offering a clever solution to correctly style code blocks. This guide is ideal for developers seeking an up-to-date method for creating rich Markdown experiences in their React applications."><link rel="icon" href="../favicon.png"><link rel="preload" href="../fonts/opensans-regular-latin.woff2" as="font" type="font/woff2" crossorigin="anonymous"><style>@font-face {
  font-family: 'Open Sans';
  src: url('../fonts/opensans-regular-latin.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
  size-adjust: 107%;
  ascent-override: 97%;
  descent-override: 25%;
  line-gap-override: 0%;
}
</style><link rel="stylesheet" href="../css/ares.css"><script>(function() {
  const getInitialTheme = () => {
    const saved = localStorage.getItem('theme');
    if (saved && (saved === 'light' || saved === 'dark')) {
      return saved;
    }
    
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
    
    return 'light';
  };
  
  const theme = getInitialTheme();
  document.documentElement.setAttribute('data-theme', theme);
  
  document.documentElement.style.colorScheme = theme;
  
  // Add anti-flicker style for dark mode
  if (theme === 'dark') {
    const style = document.createElement('style');
    style.id = 'anti-flicker-style';
    style.innerHTML = `
      #page-wrapper[data-theme="dark"] {
        background-color: #0f172a;
        color: #f1f5f9;
      }
    `;
    document.head.appendChild(style);
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    const pageWrapper = document.getElementById('page-wrapper');
    if (pageWrapper) {
      pageWrapper.setAttribute('data-theme', theme);
    }
  });
})();

</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="atom.xml" title="Cytrogen 的个人博客" type="application/atom+xml">
</head><body><div id="page-wrapper"><a class="skip-link" href="#main-content">跳到主要内容</a><div class="wrap"><header><a class="logo-link" href="../index.html"><img src="../favicon.png" alt="logo"></a><nav class="site-nav"><div class="nav-main"><div class="nav-primary"><ul class="nav-list hidden-mobile"><li class="nav-item"><a class="nav-link" href="../en/">HOME</a></li></ul><div class="nav-tools"><div class="language-menu"><button class="language-toggle" type="button"><svg class="icon icon-globe" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" focusable="false"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4a9.267 9.267 0 0 1 .64-1.539 6.7 6.7 0 0 1 .597-.933A7.025 7.025 0 0 0 2.255 4H4.09zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a6.958 6.958 0 0 0-.656 2.5h2.49zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5H4.847zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5H4.51zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12c.138.386.295.744.468 1.068.552 1.035 1.218 1.65 1.887 1.855V12H5.145zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11a13.652 13.652 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5H3.82zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855A7.97 7.97 0 0 0 10.855 12H8.5zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5a6.959 6.959 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5h2.49zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4a7.966 7.966 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4h2.355z"></path></svg><span>English</span></button><div class="language-dropdown"><a class="language-option" href="/posts/c0fc.html">中文</a></div></div></div><div class="nav-controls"><div class="more-menu hidden-mobile"><button class="more-toggle" type="button"><span>MORE</span><svg class="icon icon-chevron-down" width="12" height="12" viewBox="0 0 12 12" fill="currentColor" aria-hidden="true" focusable="false"><path d="M6 8.825c-.2 0-.4-.1-.5-.2l-3.3-3.3c-.3-.3-.3-.8 0-1.1s.8-.3 1.1 0l2.7 2.7 2.7-2.7c.3-.3.8-.3 1.1 0s.3.8 0 1.1l-3.3 3.3c-.1.1-.3.2-.5.2z"></path></svg></button><div class="more-dropdown"><ul class="dropdown-list"><li class="dropdown-item"><a class="nav-link" href="../en/archives">ARCHIVE</a></li><li class="dropdown-item"><a class="nav-link" href="../en/categories">CATEGORIES</a></li><li class="dropdown-item"><a class="nav-link" href="../en/tags">TAGS</a></li><li class="dropdown-item"><a class="nav-link" href="../en/about">ABOUT</a></li><li class="dropdown-item"><a class="nav-link" href="../en/friends">BLOGROLL</a></li><li class="dropdown-item"><a class="nav-link" href="../en/atom.xml">RSS</a></li><li class="dropdown-item"><a class="dropdown-link" href="https://portfolio.cytrogen.icu" target="_blank" rel="noopener noreferrer">PORTFOLIO<svg class="icon icon-external-link" width="14" height="14" viewBox="0 0 14 14" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8.636 2.364A1 1 0 0 1 10 1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V3.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 2H9a1 1 0 0 1-1.364-1.636zM2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 1 1 2 0v3a3 3 0 0 1-3 3H2a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3h3a1 1 0 1 1 0 2H2z"></path></svg></a></li><li class="dropdown-item"><a class="dropdown-link" href="https://github.com/cytrogen" target="_blank" rel="noopener noreferrer">GITHUB<svg class="icon icon-external-link" width="14" height="14" viewBox="0 0 14 14" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8.636 2.364A1 1 0 0 1 10 1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V3.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 2H9a1 1 0 0 1-1.364-1.636zM2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 1 1 2 0v3a3 3 0 0 1-3 3H2a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3h3a1 1 0 1 1 0 2H2z"></path></svg></a></li></ul></div></div><div class="theme-switcher"><button class="theme-toggle" type="button" role="switch" aria-pressed="false" aria-label="切换主题"><div class="theme-icon moon-icon"><svg class="icon icon-moon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" focusable="false"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path></svg></div><div class="theme-icon sun-icon"><svg class="icon icon-sun" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></svg></div></button></div><details class="mobile-menu-details hidden-desktop"><summary class="hamburger-menu" aria-label="nav.menu"><svg class="icon icon-bars" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" focusable="false"><path d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"></path></svg><span class="menu-text">nav.menu</span></summary><div class="mobile-menu-dropdown"><ul class="mobile-nav-list"><li class="mobile-nav-item"><a class="mobile-nav-link" href="../en/">HOME</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../en/archives">ARCHIVE</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../en/categories">CATEGORIES</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../en/tags">TAGS</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../en/about">ABOUT</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../en/friends">BLOGROLL</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="../en/atom.xml">RSS</a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="https://portfolio.cytrogen.icu" target="_blank" rel="noopener noreferrer">PORTFOLIO<svg class="icon icon-external-link" width="14" height="14" viewBox="0 0 14 14" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8.636 2.364A1 1 0 0 1 10 1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V3.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 2H9a1 1 0 0 1-1.364-1.636zM2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 1 1 2 0v3a3 3 0 0 1-3 3H2a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3h3a1 1 0 1 1 0 2H2z"></path></svg></a></li><li class="mobile-nav-item"><a class="mobile-nav-link" href="https://github.com/cytrogen" target="_blank" rel="noopener noreferrer">GITHUB<svg class="icon icon-external-link" width="14" height="14" viewBox="0 0 14 14" fill="currentColor" aria-hidden="true" focusable="false"><path d="M8.636 2.364A1 1 0 0 1 10 1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V3.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 2H9a1 1 0 0 1-1.364-1.636zM2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9a1 1 0 1 1 2 0v3a3 3 0 0 1-3 3H2a3 3 0 0 1-3-3V4a3 3 0 0 1 3-3h3a1 1 0 1 1 0 2H2z"></path></svg></a></li></ul></div></details></div></div></div></nav></header><main class="container" id="main-content" tabindex="-1"><div class="post"><article class="post-block"><h1 class="post-title">Markdown Rendering in React</h1><div class="post-info">2/20/2025<a class="post-from" href="/posts/c0fc.html" target="_blank" title="/posts/c0fc.html">Translate · Original Link</a></div><div class="post-content"><p>One of our project requirements was to support Markdown rendering, aiming to replicate effects similar to ChatGPT and Claude.</p>
<p>This article aims to document the problems I encountered and their solutions while implementing this feature.</p>
<span id="more"></span>
<div class="danger">
<p>This is an English translation of an article originally published in Chinese on <strong>February 20, 2024</strong>. The content of the original article may be <strong>outdated or deprecated</strong>. Please verify the current status of any tools, libraries, or methods mentioned before implementing them in your projects.</p>
</div>
<h1 id="react-markdown"><a class="markdownIt-Anchor" href="#react-markdown"></a> <code>react-markdown</code></h1>
<p>First, install <code>react-markdown</code>.</p>
<pre><code class="language-bash">npm install react-markdown</code></pre>
<p>Let's test using the official example text from the <code>react-markdown</code> library:</p>
<pre><code class="language-plaintext"># A demo of `react-markdown`

`react-markdown` is a markdown component for React.

👉 Changes are re-rendered as you type.

👈 Try writing some markdown on the left.

## Overview

* Follows [CommonMark](https://commonmark.org)
* Optionally follows [GitHub Flavored Markdown](https://github.github.com/gfm/)
* Renders actual React elements instead of using `dangerouslySetInnerHTML`
* Lets you define your own components (to render `MyHeading` instead of `&#x27;h1&#x27;`)
* Has a lot of plugins

## Contents

Here is an example of a plugin in action
([`remark-toc`](https://github.com/remarkjs/remark-toc)).
**This section is replaced by an actual table of contents**.

## Syntax highlighting

Here is an example of a plugin to highlight code:
[`rehype-highlight`](https://github.com/rehypejs/rehype-highlight).

```js
import React from &#x27;react&#x27;
import ReactDOM from &#x27;react-dom&#x27;
import Markdown from &#x27;react-markdown&#x27;
import rehypeHighlight from &#x27;rehype-highlight&#x27;

const markdown = `
# Your markdown here
`

ReactDOM.render(
  &lt;Markdown rehypePlugins=&#123;[rehypeHighlight]&#125;&gt;&#123;markdown&#125;&lt;/Markdown&gt;,
  document.querySelector(&#x27;#content&#x27;)
)
\```

&gt; Pretty neat, eh?

## GitHub flavored markdown (GFM)

For GFM, you can *also* use a plugin:
[`remark-gfm`](https://github.com/remarkjs/react-markdown#use).
It adds support for GitHub-specific extensions to the language:
tables, strikethrough, tasklists, and literal URLs.

These features **do not work by default**.
👆 Use the toggle above to add the plugin.

| Feature    | Support              |
| ---------: | :------------------- |
| CommonMark | 100%                 |
| GFM        | 100% w/ `remark-gfm` |

~~strikethrough~~

* [ ] task list
* [x] checked item

https://example.com

## HTML in markdown

⚠️ HTML in markdown is quite unsafe, but if you want to support it, you can
use [`rehype-raw`](https://github.com/rehypejs/rehype-raw).
You should probably combine it with
[`rehype-sanitize`](https://github.com/rehypejs/rehype-sanitize).

&lt;blockquote&gt;
  👆 Use the toggle above to add the plugin.
&lt;/blockquote&gt;

## Components

You can pass components to change things:

```markdown
import React from &#x27;react&#x27;
import ReactDOM from &#x27;react-dom&#x27;
import Markdown from &#x27;react-markdown&#x27;
import MyFancyRule from &#x27;./components/my-fancy-rule.js&#x27;

const markdown = `
# Your markdown here
`

ReactDOM.render(
  &lt;Markdown
    components=&#123;&#123;
      // Use h2s instead of h1s
      h1: &#x27;h2&#x27;,
      // Use a component instead of hrs
      hr(props) &#123;
        const &#123;node, ...rest&#125; = props
        return &lt;MyFancyRule &#123;...rest&#125; /&gt;
      &#125;
    &#125;&#125;
  &gt;
    &#123;markdown&#125;
  &lt;/Markdown&gt;,
  document.querySelector(&#x27;#content&#x27;)
)
/```</code></pre>
<div class="danger">
<p>In the test text, there are also code blocks, but since I'm using Hexo for my blog, these texts that should be in code blocks (as I set) were all rendered as code blocks.</p>
<p>Therefore, I added a backslash after each code block to prevent them from being rendered as code blocks. <strong>You can remove these backslashes when testing</strong>.</p>
</div>
<pre><code class="language-jsx">import ReactMarkdown from &quot;react-markdown&quot;;

function App() &#123;
  const markdownContent = `&#123;The Markdown test text mentioned earlier&#125;`;

  return (
    &lt;&gt;
      &lt;ReactMarkdown&gt;&#123;markdownContent&#125;&lt;/ReactMarkdown&gt;
    &lt;/&gt;
  );
&#125;</code></pre>
<p>The rendered effect (remember to replace the value of <code>markdownContent</code>):</p>
<p><img src="/posts/f27d/1.png" alt="Rendered Markdown without table, task lists, and strikethrough"></p>
<p>As you can see, there are some differences compared to Typora or GitHub's rendering effects. For example, the code blocks and regular text styles are too similar, and we'd prefer code blocks with distinct background colors and syntax highlighting.</p>
<p>Additionally, special styles like tables, task lists, and strikethrough weren't rendered.</p>
<h1 id="remark-gfm"><a class="markdownIt-Anchor" href="#remark-gfm"></a> <code>remark-gfm</code></h1>
<p>Actually, the test text already told us why: these are GFM (GitHub Flavored Markdown) features, and <code>react-markdown</code> doesn't support GFM by default.</p>
<p>So we need to install the <code>remark-gfm</code> plugin to support GFM:</p>
<pre><code class="language-bash">npm install remark-gfm</code></pre>
<p>Using plugins with <code>react-markdown</code> is quite simple:</p>
<pre><code class="language-jsx">import remarkGfm from &quot;remark-gfm&quot;;

// ...

&lt;ReactMarkdown remarkPlugins=&#123;[remarkGfm]&#125;&gt;&#123;markdownContent&#125;&lt;/ReactMarkdown&gt;</code></pre>
<p>The rendered effect:</p>
<p><img src="/posts/f27d/2.png" alt="Rendered Markdown without table borders"></p>
<p>At this point, you're probably wondering: where are the table borders??</p>
<p>If we inspect the table's styles using developer tools, we'll find that the table is indeed rendered as a <code>table</code> tag, but the User Agent Stylesheet has applied some processing to the <code>table</code> tag. So we need to write some styles to override these default styles:</p>
<pre><code class="language-css">table &#123;
  border-spacing: 0 !important;
  border-collapse: collapse !important;
  border-color: inherit !important;
  display: block !important;
  width: max-content !important;
  max-width: 100% !important;
  overflow: auto !important;
&#125;

tbody, td, tfoot, th, thead, tr &#123;
  border-color: inherit !important;
  border-style: solid !important;
  border-width: 2px !important;
&#125;</code></pre>
<p>Add <code>!important</code> to all styles to override the User Agent Stylesheet styles.</p>
<p>The rendered effect now:</p>
<p><img src="/posts/f27d/3.png" alt="Rendered Markdown with bold table border"></p>
<div class="danger">
<p>Due to security considerations, I decided not to use HTML support, so I won't demonstrate it here.</p>
</div>
<p>Now we've completed a simple Markdown rendering feature. However, there's one crucial feature in this requirement: code block highlighting.</p>
<h1 id="code-block-highlighting"><a class="markdownIt-Anchor" href="#code-block-highlighting"></a> Code Block Highlighting</h1>
<p>Due to project requirements, code blocks must be prominent and have syntax highlighting, which applies to inline code blocks as well.</p>
<p>Here we can use <code>react-syntax-highlighter</code>.</p>
<pre><code class="language-bash">npm install react-syntax-highlighter</code></pre>
<p><code>react-syntax-highlighter</code> has two engines: <code>prism</code> and <code>highlight.js</code>. You can search online for their detailed differences.</p>
<p>Here we'll use the <code>prism</code> engine with the <code>oneDark</code> theme:</p>
<pre><code class="language-jsx">import &#123; Prism as SyntaxHighlighter &#125; from &quot;react-syntax-highlighter&quot;;
import &#123; oneDark &#125; from &quot;react-syntax-highlighter/dist/esm/styles/prism&quot;;</code></pre>
<p>In the <code>component</code> prop of <code>ReactMarkdown</code>, we can customize how code blocks are rendered. If you've seen other tutorials online, they almost all write it like this:</p>
<pre><code class="language-jsx">&lt;ReactMarkdown
  remarkPlugins=&#123;[remarkGfm]&#125;
  components=&#123;&#123;
    code(&#123; node, inline, className, children, ...props &#125;) &#123;
      const match = /language-(\w+)/.exec(className || &#x27;&#x27;)
      return !inline &amp;&amp; match ? (
        &lt;SyntaxHighlighter
          style=&#123;nightOwl&#125;
          language=&#123;match[1]&#125;
          PreTag=&quot;div&quot;
          children=&#123;String(children).replace(/\n$/, &#x27;&#x27;)&#125;
          &#123;...props&#125;
        /&gt;
      ) : (
        &lt;code className=&#123;className&#125; &#123;...props&#125; children=&#123;children&#125; /&gt;
      )
    &#125;
  &#125;&#125;
&gt;
    &#123;markdownContent&#125;
&lt;/ReactMarkdown&gt;</code></pre>
<p>Here we customized the rendering behavior of the <code>code</code> component.</p>
<blockquote>
<p>The parameters in <code>code(&#123; node, inline, className, children, ...props &#125;) &#123;&#125;</code> represent:</p>
<ul>
<li><code>node</code>: current node</li>
<li><code>inline</code>: whether it's an inline code block</li>
<li><code>className</code>: class name</li>
<li><code>children</code>: child nodes (content in code block)</li>
<li><code>...props</code>: other properties</li>
</ul>
</blockquote>
<p>Then we use regex to match <code>language-xxx</code> in <code>className</code>, and if there's a match and it's not an inline code block, we use <code>SyntaxHighlighter</code> to render the code block; otherwise, we use the default <code>code</code> tag.</p>
<p><em><strong>But!!!</strong></em></p>
<p>The <code>inline</code> property has been deprecated and won't be passed as a parameter in the new version of <code>react-markdown</code>!!!</p>
<p>This really gave me a headache at the time, and I couldn't find a solution after searching online. I decided to temporarily solve another problem: rendering code blocks without defined languages.</p>
<p>After rendering, the biggest difference between code blocks and inline code blocks is that code blocks have a <code>pre</code> tag wrapper. Since the <code>code</code> tag as a child tag can't get the parent tag's styles from <code>props</code>, but thinking reversely, the <code>pre</code> tag can get the <code>code</code> tag's styles!</p>
<p>So I wrote this wild solution:</p>
<pre><code class="language-jsx">&lt;Markdown
  remarkPlugins=&#123;[remarkGfm]&#125;
  components=&#123;&#123;
    pre(&#123;node, className, children, ...props&#125;) &#123;
      if (children[&quot;type&quot;] === &quot;code&quot;) &#123;
        try &#123;
          const match = children[&quot;props&quot;][&quot;className&quot;].match(/language-(\w+)/)
          return (
            &lt;pre&gt;
              &lt;SyntaxHighlighter
                style=&#123;oneDark&#125;
                language=&#123;match[1]&#125;
                PreTag=&quot;div&quot;
                showLineNumbers
                wrapLongLines
                children=&#123;String(children[&quot;props&quot;][&quot;children&quot;]).replace(/\n$/, &#x27;&#x27;)&#125;
              /&gt;
            &lt;/pre&gt;
          )
        &#125; catch (e) &#123;
          return (
            &lt;pre&gt;
              &lt;SyntaxHighlighter
                style=&#123;oneDark&#125;
                language=&quot;python&quot;
                PreTag=&quot;div&quot;
                showLineNumbers
                wrapLongLines
                children=&#123;String(children[&quot;props&quot;][&quot;children&quot;]).replace(/\n$/, &#x27;&#x27;)&#125;
              /&gt;
            &lt;/pre&gt;
          )
        &#125;
      &#125;
    &#125;
  &#125;&#125;
&gt;
  &#123;markdownContent&#125;
&lt;/Markdown&gt;</code></pre>
<p>Directly check the <code>children</code>'s type in the <code>pre</code> tag - if it's <code>code</code>, then it must be a code block, and then match the language type in <code>className</code>.</p>
<p>If there's no match, it will cause an error, so I temporarily added a <code>try...catch</code> statement - if there's no match, just default to rendering it as a Python language code block.</p>
<p>The effect is not bad:</p>
<p><img src="/posts/f27d/4.png" alt="Rendered Code Block with styles"></p>
<h1 id="afterword"><a class="markdownIt-Anchor" href="#afterword"></a> Afterword</h1>
<p>There are still some issues with this implementation, such as unresolved inline code block rendering, the <code>try...catch</code> statement not being a good solution, and the technical debt of defaulting to Python language for undefined language code blocks is quite messy!</p>
<p>However, due to project time constraints, I didn't delve deeper into these issues. Perhaps when I have more time in the future, I'll revisit and solve these problems. That's for another time.</p>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="5e08.html">PREV POST</a><a class="next" href="6976.html">NEXT POST</a></div><div class="copyright"><p>© 2022 - 2025 <a href="https://cytrogen.icu">Cytrogen</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/cytrogen/hexo-theme-ares" target="_blank">hexo-theme-ares</a>.</p></div></footer></div></div><a class="back-to-top" href="#top" aria-label="返回顶部"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M3.293 9.707a1 1 0 010-1.414L9.586 2a2 2 0 012.828 0l6.293 6.293a1 1 0 01-1.414 1.414L11 3.414V17a1 1 0 11-2 0V3.414L2.707 9.707a1 1 0 01-1.414 0z"></path></svg></a><script>document.addEventListener('DOMContentLoaded', function() {
  const codeBlocks = document.querySelectorAll('figure.highlight');
  
  codeBlocks.forEach(block => {
    let caption = block.querySelector('figcaption');
    if (!caption) {
      caption = document.createElement('figcaption');
      block.insertBefore(caption, block.firstChild);
    }

    const info = document.createElement('div');
    info.className = 'info';
    
    const filename = caption.querySelector('span');
    if (filename) {
      filename.className = 'filename';
      info.appendChild(filename);
    }
    
    const lang = block.className.split(' ')[1];
    if (lang) {
      const langSpan = document.createElement('span');
      langSpan.className = 'lang-name';
      langSpan.textContent = lang;
      info.appendChild(langSpan);
    }

    const sourceLink = caption.querySelector('a');
    if (sourceLink) {
      sourceLink.className = 'source-link';
      info.appendChild(sourceLink);
    }

    const actions = document.createElement('div');
    actions.className = 'actions';

    const codeHeight = block.scrollHeight;
    const threshold = 300;

    if (codeHeight > threshold) {
      block.classList.add('folded');
      
      const toggleBtn = document.createElement('button');
      toggleBtn.textContent = 'Expand';
      toggleBtn.addEventListener('click', () => {
        block.classList.toggle('folded');
        toggleBtn.textContent = block.classList.contains('folded') ? 'Expand' : 'Fold';
      });
      actions.appendChild(toggleBtn);
    }

    const copyBtn = document.createElement('button');
    copyBtn.textContent = 'Copy';
    copyBtn.addEventListener('click', async () => {
      const codeLines = block.querySelectorAll('.code .line');
      const code = Array.from(codeLines)
        .map(line => line.textContent)
        .join('\n')
        .replace(/\n\n/g, '\n');
      
      try {
        await navigator.clipboard.writeText(code);
        copyBtn.textContent = 'Copied';
        copyBtn.classList.add('copied');
        
        setTimeout(() => {
          copyBtn.textContent = 'Copy';
          copyBtn.classList.remove('copied');
        }, 3000);
      } catch (err) {
        console.error('复制失败:', err);
        copyBtn.textContent = 'Copy failed';
        
        setTimeout(() => {
          copyBtn.textContent = 'Copy';
        }, 3000);
      }
    });
    actions.appendChild(copyBtn);

    caption.innerHTML = '';
    caption.appendChild(info);
    caption.appendChild(actions);

    const markedLines = block.getAttribute('data-marked-lines');
    if (markedLines) {
      const lines = markedLines.split(',');
      lines.forEach(range => {
        if (range.includes('-')) {
          const [start, end] = range.split('-').map(Number);
          for (let i = start; i <= end; i++) {
            const line = block.querySelector(`.line-${i}`);
            if (line) line.classList.add('marked');
          }
        } else {
          const line = block.querySelector(`.line-${range}`);
          if (line) line.classList.add('marked');
        }
      });
    }
  });
});</script><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-4PVPZXE0QQ"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-4PVPZXE0QQ');</script><script>(function() {
  // Wait for DOM to be ready
  document.addEventListener('DOMContentLoaded', function() {
    const themeToggle = document.querySelector('.theme-toggle');
    
    if (!themeToggle) return;
    
    // Get current theme
    const getCurrentTheme = () => {
      return document.documentElement.getAttribute('data-theme') || 'light';
    };
    
    // Update UI to match current theme
    const updateUI = (theme) => {
      const isDark = theme === 'dark';
      themeToggle.setAttribute('aria-pressed', isDark.toString());
    };
    
    // Simplified theme setter - CSS handles all animations
    const setTheme = (theme) => {
      document.documentElement.setAttribute('data-theme', theme);
      document.documentElement.style.colorScheme = theme; // Update native UI elements
      
      // Also update page-wrapper for animation support
      const pageWrapper = document.getElementById('page-wrapper');
      if (pageWrapper) {
        pageWrapper.setAttribute('data-theme', theme);
      }
      
      // Find and remove the temporary anti-flicker style tag if it exists.
      // This ensures the main stylesheet takes full control after the initial load.
      const antiFlickerStyle = document.getElementById('anti-flicker-style');
      if (antiFlickerStyle) {
        antiFlickerStyle.remove();
      }
      
      localStorage.setItem('theme', theme);
      updateUI(theme);
    };
    
    // Simple theme toggle - letting CSS handle the smooth transitions
    const toggleTheme = () => {
      const current = getCurrentTheme();
      const newTheme = current === 'light' ? 'dark' : 'light';
      setTheme(newTheme);
    };
    
    // Initialize UI on page load
    updateUI(getCurrentTheme());
    
    // Add click event listener
    themeToggle.addEventListener('click', toggleTheme);
    
    // Listen for system theme changes
    if (window.matchMedia) {
      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
      mediaQuery.addEventListener('change', function(e) {
        // Only update if no manual preference is saved
        if (!localStorage.getItem('theme')) {
          const theme = e.matches ? 'dark' : 'light';
          setTheme(theme);
        }
      });
    }
  });
})();
</script><script>(function() {
  document.addEventListener('DOMContentLoaded', function() {
    const backToTopBtn = document.querySelector('.back-to-top');
    
    if (!backToTopBtn) return;
    
    // Show/hide button based on scroll position
    const toggleButtonVisibility = () => {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const shouldShow = scrollTop > 200; // Show after scrolling 200px
      
      if (shouldShow) {
        backToTopBtn.classList.add('is-visible');
      } else {
        backToTopBtn.classList.remove('is-visible');
      }
    };
    
    // Throttle scroll events for better performance
    let ticking = false;
    const handleScroll = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          toggleButtonVisibility();
          ticking = false;
        });
        ticking = true;
      }
    };
    
    // Smooth scroll to top when clicked
    const scrollToTop = (event) => {
      event.preventDefault();
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    };
    
    // Add event listeners
    window.addEventListener('scroll', handleScroll);
    backToTopBtn.addEventListener('click', scrollToTop);
    
    // Check initial scroll position
    toggleButtonVisibility();
  });
})();</script></body></html>